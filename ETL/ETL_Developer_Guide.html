<!doctype html>
<html>
    <head>
        <title>ETL_Developer_Guide</title>
        <meta charset='utf-8'/>
        <style>
 .ͼ1.cm-focused {outline: 1px dotted #212121;}
.ͼ1 {position: relative !important; box-sizing: border-box; display: flex !important; flex-direction: column;}
.ͼ1 .cm-scroller {display: flex !important; align-items: flex-start !important; font-family: monospace; line-height: 1.4; height: 100%; overflow-x: auto; position: relative; z-index: 0; overflow-anchor: none;}
.ͼ1 .cm-content[contenteditable=true] {-webkit-user-modify: read-write-plaintext-only;}
.ͼ1 .cm-content {margin: 0; flex-grow: 2; flex-shrink: 0; display: block; white-space: pre; word-wrap: normal; box-sizing: border-box; min-height: 100%; padding: 4px 0; outline: none;}
.ͼ1 .cm-lineWrapping {white-space: pre-wrap; white-space: break-spaces; word-break: break-word; overflow-wrap: anywhere; flex-shrink: 1;}
.ͼ2 .cm-content {caret-color: black;}
.ͼ3 .cm-content {caret-color: white;}
.ͼ1 .cm-line {display: block; padding: 0 2px 0 6px;}
.ͼ1 .cm-layer > * {position: absolute;}
.ͼ1 .cm-layer {position: absolute; left: 0; top: 0; contain: size style;}
.ͼ2 .cm-selectionBackground {background: #d9d9d9;}
.ͼ3 .cm-selectionBackground {background: #222;}
.ͼ2.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground {background: #d7d4f0;}
.ͼ3.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground {background: #233;}
.ͼ1 .cm-cursorLayer {pointer-events: none;}
.ͼ1.cm-focused > .cm-scroller > .cm-cursorLayer {animation: steps(1) cm-blink 1.2s infinite;}
@keyframes cm-blink {50% {opacity: 0;}}
@keyframes cm-blink2 {50% {opacity: 0;}}
.ͼ1 .cm-cursor, .ͼ1 .cm-dropCursor {border-left: 1.2px solid black; margin-left: -0.6px; pointer-events: none;}
.ͼ1 .cm-cursor {display: none;}
.ͼ3 .cm-cursor {border-left-color: #ddd;}
.ͼ1 .cm-dropCursor {position: absolute;}
.ͼ1.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor {display: block;}
.ͼ1 .cm-iso {unicode-bidi: isolate;}
.ͼ1 .cm-announced {position: fixed; top: -10000px;}
@media print {.ͼ1 .cm-announced {display: none;}}
.ͼ2 .cm-activeLine {background-color: #cceeff44;}
.ͼ3 .cm-activeLine {background-color: #99eeff33;}
.ͼ2 .cm-specialChar {color: red;}
.ͼ3 .cm-specialChar {color: #f78;}
.ͼ1 .cm-gutters {flex-shrink: 0; display: flex; height: 100%; box-sizing: border-box; z-index: 200;}
.ͼ1 .cm-gutters-before {inset-inline-start: 0;}
.ͼ1 .cm-gutters-after {inset-inline-end: 0;}
.ͼ2 .cm-gutters.cm-gutters-before {border-right-width: 1px;}
.ͼ2 .cm-gutters.cm-gutters-after {border-left-width: 1px;}
.ͼ2 .cm-gutters {background-color: #f5f5f5; color: #6c6c6c; border: 0px solid #ddd;}
.ͼ3 .cm-gutters {background-color: #333338; color: #ccc;}
.ͼ1 .cm-gutter {display: flex !important; flex-direction: column; flex-shrink: 0; box-sizing: border-box; min-height: 100%; overflow: hidden;}
.ͼ1 .cm-gutterElement {box-sizing: border-box;}
.ͼ1 .cm-lineNumbers .cm-gutterElement {padding: 0 3px 0 5px; min-width: 20px; text-align: right; white-space: nowrap;}
.ͼ2 .cm-activeLineGutter {background-color: #e2f2ff;}
.ͼ3 .cm-activeLineGutter {background-color: #222227;}
.ͼ1 .cm-panels {box-sizing: border-box; position: sticky; left: 0; right: 0; z-index: 300;}
.ͼ2 .cm-panels {background-color: #f5f5f5; color: black;}
.ͼ2 .cm-panels-top {border-bottom: 1px solid #ddd;}
.ͼ2 .cm-panels-bottom {border-top: 1px solid #ddd;}
.ͼ3 .cm-panels {background-color: #333338; color: white;}
.ͼ1 .cm-dialog label {font-size: 80%;}
.ͼ1 .cm-dialog {padding: 2px 19px 4px 6px; position: relative;}
.ͼ1 .cm-dialog-close {position: absolute; top: 3px; right: 4px; background-color: inherit; border: none; font: inherit; font-size: 14px; padding: 0;}
.ͼ1 .cm-tab {display: inline-block; overflow: hidden; vertical-align: bottom;}
.ͼ1 .cm-widgetBuffer {vertical-align: text-top; height: 1em; width: 0; display: inline;}
.ͼ1 .cm-placeholder {color: #888; display: inline-block; vertical-align: top; user-select: none;}
.ͼ1 .cm-highlightSpace {background-image: radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%); background-position: center;}
.ͼ1 .cm-highlightTab {background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>'); background-size: auto 100%; background-position: right 90%; background-repeat: no-repeat;}
.ͼ1 .cm-trailingSpace {background-color: #ff332255;}
.ͼ1 .cm-button {vertical-align: middle; color: inherit; font-size: 70%; padding: .2em 1em; border-radius: 1px;}
.ͼ2 .cm-button:active {background-image: linear-gradient(#b4b4b4, #d0d3d6);}
.ͼ2 .cm-button {background-image: linear-gradient(#eff1f5, #d9d9df); border: 1px solid #888;}
.ͼ3 .cm-button:active {background-image: linear-gradient(#111, #333);}
.ͼ3 .cm-button {background-image: linear-gradient(#393939, #111); border: 1px solid #888;}
.ͼ1 .cm-textfield {vertical-align: middle; color: inherit; font-size: 70%; border: 1px solid silver; padding: .2em .5em;}
.ͼ2 .cm-textfield {background-color: white;}
.ͼ3 .cm-textfield {border: 1px solid #555; background-color: inherit;}
.ͼ1 .cm-foldPlaceholder {background-color: #eee; border: 1px solid #ddd; color: #888; border-radius: .2em; margin: 0 1px; padding: 0 1px; cursor: pointer;}
.ͼ1 .cm-foldGutter span {padding: 0 1px; cursor: pointer;}
 /* Sets all the text color to red! */

div.obsidian-local-rest-api-settings div.api-key-display {
  margin-bottom: 20px;
}
div.obsidian-local-rest-api-settings div.api-key-display pre {
  font-size: 0.8em;
  padding: 10px 20px;
  background-color: var(--background-modifier-cover);
  font-family: monospace;
  user-select: all;
}

div.obsidian-local-rest-api-settings div.setting-item-control {
  min-width: 50%;
}

div.obsidian-local-rest-api-settings textarea {
  width: 100%;
}

div.obsidian-local-rest-api-settings div.certificate-expired {
  padding: 10px 20px;
  border: 2px solid #ff0000;
}

div.obsidian-local-rest-api-settings div.certificate-expiring-soon {
  padding: 10px 20px;
  border: 2px solid #ffff00;
}

div.obsidian-local-rest-api-settings div.certificate-regeneration-recommended {
  padding: 10px 20px;
  border: 2px solid #ffff00;
}

div.obsidian-local-rest-api-settings table.api-urls tr {
  width: 100%;
}

div.obsidian-local-rest-api-settings table.api-urls th, div.obsidian-local-rest-api-settings table.api-urls td {
  padding: 5px 25px;
}

div.obsidian-local-rest-api-settings table.api-urls tr.disabled td.name, div.obsidian-local-rest-api-settings table.api-urls tr.disabled td.url {
  text-decoration: line-through;
}
 .setting-item.ex-setting-item{border-top:unset;padding-top:0}*[hidden]{display:none}
 
.pandoc-plugin-error {
    color: red;
}
  #m92f82e7167f4ed81{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m92f82e7167f4ed81 .error-icon{fill:#552222;}#m92f82e7167f4ed81 .error-text{fill:#552222;stroke:#552222;}#m92f82e7167f4ed81 .edge-thickness-normal{stroke-width:1px;}#m92f82e7167f4ed81 .edge-thickness-thick{stroke-width:3.5px;}#m92f82e7167f4ed81 .edge-pattern-solid{stroke-dasharray:0;}#m92f82e7167f4ed81 .edge-thickness-invisible{stroke-width:0;fill:none;}#m92f82e7167f4ed81 .edge-pattern-dashed{stroke-dasharray:3;}#m92f82e7167f4ed81 .edge-pattern-dotted{stroke-dasharray:2;}#m92f82e7167f4ed81 .marker{fill:#333333;stroke:#333333;}#m92f82e7167f4ed81 .marker.cross{stroke:#333333;}#m92f82e7167f4ed81 svg{font-family:var(--font-mermaid);font-size:16px;}#m92f82e7167f4ed81 p{margin:0;}#m92f82e7167f4ed81 .label{font-family:var(--font-mermaid);color:#333;}#m92f82e7167f4ed81 .cluster-label text{fill:#333;}#m92f82e7167f4ed81 .cluster-label span{color:#333;}#m92f82e7167f4ed81 .cluster-label span p{background-color:transparent;}#m92f82e7167f4ed81 .label text,#m92f82e7167f4ed81 span{fill:#333;color:#333;}#m92f82e7167f4ed81 .node rect,#m92f82e7167f4ed81 .node circle,#m92f82e7167f4ed81 .node ellipse,#m92f82e7167f4ed81 .node polygon,#m92f82e7167f4ed81 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#m92f82e7167f4ed81 .rough-node .label text,#m92f82e7167f4ed81 .node .label text,#m92f82e7167f4ed81 .image-shape .label,#m92f82e7167f4ed81 .icon-shape .label{text-anchor:middle;}#m92f82e7167f4ed81 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#m92f82e7167f4ed81 .rough-node .label,#m92f82e7167f4ed81 .node .label,#m92f82e7167f4ed81 .image-shape .label,#m92f82e7167f4ed81 .icon-shape .label{text-align:center;}#m92f82e7167f4ed81 .node.clickable{cursor:pointer;}#m92f82e7167f4ed81 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#m92f82e7167f4ed81 .arrowheadPath{fill:#333333;}#m92f82e7167f4ed81 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#m92f82e7167f4ed81 .flowchart-link{stroke:#333333;fill:none;}#m92f82e7167f4ed81 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#m92f82e7167f4ed81 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#m92f82e7167f4ed81 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m92f82e7167f4ed81 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#m92f82e7167f4ed81 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#m92f82e7167f4ed81 .cluster text{fill:#333;}#m92f82e7167f4ed81 .cluster span{color:#333;}#m92f82e7167f4ed81 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#m92f82e7167f4ed81 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#m92f82e7167f4ed81 rect.text{fill:none;stroke-width:0;}#m92f82e7167f4ed81 .icon-shape,#m92f82e7167f4ed81 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#m92f82e7167f4ed81 .icon-shape p,#m92f82e7167f4ed81 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#m92f82e7167f4ed81 .icon-shape rect,#m92f82e7167f4ed81 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m92f82e7167f4ed81 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
} #me2914b50f8d3e2e3{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#me2914b50f8d3e2e3 .error-icon{fill:#552222;}#me2914b50f8d3e2e3 .error-text{fill:#552222;stroke:#552222;}#me2914b50f8d3e2e3 .edge-thickness-normal{stroke-width:1px;}#me2914b50f8d3e2e3 .edge-thickness-thick{stroke-width:3.5px;}#me2914b50f8d3e2e3 .edge-pattern-solid{stroke-dasharray:0;}#me2914b50f8d3e2e3 .edge-thickness-invisible{stroke-width:0;fill:none;}#me2914b50f8d3e2e3 .edge-pattern-dashed{stroke-dasharray:3;}#me2914b50f8d3e2e3 .edge-pattern-dotted{stroke-dasharray:2;}#me2914b50f8d3e2e3 .marker{fill:#333333;stroke:#333333;}#me2914b50f8d3e2e3 .marker.cross{stroke:#333333;}#me2914b50f8d3e2e3 svg{font-family:var(--font-mermaid);font-size:16px;}#me2914b50f8d3e2e3 p{margin:0;}#me2914b50f8d3e2e3 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#me2914b50f8d3e2e3 text.actor&gt;tspan{fill:black;stroke:none;}#me2914b50f8d3e2e3 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#me2914b50f8d3e2e3 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#me2914b50f8d3e2e3 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#me2914b50f8d3e2e3 #me2914b50f8d3e2e3-arrowhead path{fill:#333;stroke:#333;}#me2914b50f8d3e2e3 .sequenceNumber{fill:white;}#me2914b50f8d3e2e3 #me2914b50f8d3e2e3-sequencenumber{fill:#333;}#me2914b50f8d3e2e3 #me2914b50f8d3e2e3-crosshead path{fill:#333;stroke:#333;}#me2914b50f8d3e2e3 .messageText{fill:#333;stroke:none;}#me2914b50f8d3e2e3 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#me2914b50f8d3e2e3 .labelText,#me2914b50f8d3e2e3 .labelText&gt;tspan{fill:black;stroke:none;}#me2914b50f8d3e2e3 .loopText,#me2914b50f8d3e2e3 .loopText&gt;tspan{fill:black;stroke:none;}#me2914b50f8d3e2e3 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#me2914b50f8d3e2e3 .note{stroke:#aaaa33;fill:#fff5ad;}#me2914b50f8d3e2e3 .noteText,#me2914b50f8d3e2e3 .noteText&gt;tspan{fill:black;stroke:none;}#me2914b50f8d3e2e3 .activation0{fill:#f4f4f4;stroke:#666;}#me2914b50f8d3e2e3 .activation1{fill:#f4f4f4;stroke:#666;}#me2914b50f8d3e2e3 .activation2{fill:#f4f4f4;stroke:#666;}#me2914b50f8d3e2e3 .actorPopupMenu{position:absolute;}#me2914b50f8d3e2e3 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#me2914b50f8d3e2e3 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#me2914b50f8d3e2e3 .actor-man circle,#me2914b50f8d3e2e3 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#me2914b50f8d3e2e3 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #m748e96aa538a678a{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m748e96aa538a678a .error-icon{fill:#552222;}#m748e96aa538a678a .error-text{fill:#552222;stroke:#552222;}#m748e96aa538a678a .edge-thickness-normal{stroke-width:1px;}#m748e96aa538a678a .edge-thickness-thick{stroke-width:3.5px;}#m748e96aa538a678a .edge-pattern-solid{stroke-dasharray:0;}#m748e96aa538a678a .edge-thickness-invisible{stroke-width:0;fill:none;}#m748e96aa538a678a .edge-pattern-dashed{stroke-dasharray:3;}#m748e96aa538a678a .edge-pattern-dotted{stroke-dasharray:2;}#m748e96aa538a678a .marker{fill:#333333;stroke:#333333;}#m748e96aa538a678a .marker.cross{stroke:#333333;}#m748e96aa538a678a svg{font-family:var(--font-mermaid);font-size:16px;}#m748e96aa538a678a p{margin:0;}#m748e96aa538a678a .label{font-family:var(--font-mermaid);color:#333;}#m748e96aa538a678a .cluster-label text{fill:#333;}#m748e96aa538a678a .cluster-label span{color:#333;}#m748e96aa538a678a .cluster-label span p{background-color:transparent;}#m748e96aa538a678a .label text,#m748e96aa538a678a span{fill:#333;color:#333;}#m748e96aa538a678a .node rect,#m748e96aa538a678a .node circle,#m748e96aa538a678a .node ellipse,#m748e96aa538a678a .node polygon,#m748e96aa538a678a .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#m748e96aa538a678a .rough-node .label text,#m748e96aa538a678a .node .label text,#m748e96aa538a678a .image-shape .label,#m748e96aa538a678a .icon-shape .label{text-anchor:middle;}#m748e96aa538a678a .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#m748e96aa538a678a .rough-node .label,#m748e96aa538a678a .node .label,#m748e96aa538a678a .image-shape .label,#m748e96aa538a678a .icon-shape .label{text-align:center;}#m748e96aa538a678a .node.clickable{cursor:pointer;}#m748e96aa538a678a .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#m748e96aa538a678a .arrowheadPath{fill:#333333;}#m748e96aa538a678a .edgePath .path{stroke:#333333;stroke-width:2.0px;}#m748e96aa538a678a .flowchart-link{stroke:#333333;fill:none;}#m748e96aa538a678a .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#m748e96aa538a678a .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#m748e96aa538a678a .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m748e96aa538a678a .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#m748e96aa538a678a .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#m748e96aa538a678a .cluster text{fill:#333;}#m748e96aa538a678a .cluster span{color:#333;}#m748e96aa538a678a div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#m748e96aa538a678a .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#m748e96aa538a678a rect.text{fill:none;stroke-width:0;}#m748e96aa538a678a .icon-shape,#m748e96aa538a678a .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#m748e96aa538a678a .icon-shape p,#m748e96aa538a678a .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#m748e96aa538a678a .icon-shape rect,#m748e96aa538a678a .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m748e96aa538a678a :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #m3a8c73b05a6ed791{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m3a8c73b05a6ed791 .error-icon{fill:#552222;}#m3a8c73b05a6ed791 .error-text{fill:#552222;stroke:#552222;}#m3a8c73b05a6ed791 .edge-thickness-normal{stroke-width:1px;}#m3a8c73b05a6ed791 .edge-thickness-thick{stroke-width:3.5px;}#m3a8c73b05a6ed791 .edge-pattern-solid{stroke-dasharray:0;}#m3a8c73b05a6ed791 .edge-thickness-invisible{stroke-width:0;fill:none;}#m3a8c73b05a6ed791 .edge-pattern-dashed{stroke-dasharray:3;}#m3a8c73b05a6ed791 .edge-pattern-dotted{stroke-dasharray:2;}#m3a8c73b05a6ed791 .marker{fill:#333333;stroke:#333333;}#m3a8c73b05a6ed791 .marker.cross{stroke:#333333;}#m3a8c73b05a6ed791 svg{font-family:var(--font-mermaid);font-size:16px;}#m3a8c73b05a6ed791 p{margin:0;}#m3a8c73b05a6ed791 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m3a8c73b05a6ed791 text.actor&gt;tspan{fill:black;stroke:none;}#m3a8c73b05a6ed791 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m3a8c73b05a6ed791 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#m3a8c73b05a6ed791 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#m3a8c73b05a6ed791 #m3a8c73b05a6ed791-arrowhead path{fill:#333;stroke:#333;}#m3a8c73b05a6ed791 .sequenceNumber{fill:white;}#m3a8c73b05a6ed791 #m3a8c73b05a6ed791-sequencenumber{fill:#333;}#m3a8c73b05a6ed791 #m3a8c73b05a6ed791-crosshead path{fill:#333;stroke:#333;}#m3a8c73b05a6ed791 .messageText{fill:#333;stroke:none;}#m3a8c73b05a6ed791 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m3a8c73b05a6ed791 .labelText,#m3a8c73b05a6ed791 .labelText&gt;tspan{fill:black;stroke:none;}#m3a8c73b05a6ed791 .loopText,#m3a8c73b05a6ed791 .loopText&gt;tspan{fill:black;stroke:none;}#m3a8c73b05a6ed791 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m3a8c73b05a6ed791 .note{stroke:#aaaa33;fill:#fff5ad;}#m3a8c73b05a6ed791 .noteText,#m3a8c73b05a6ed791 .noteText&gt;tspan{fill:black;stroke:none;}#m3a8c73b05a6ed791 .activation0{fill:#f4f4f4;stroke:#666;}#m3a8c73b05a6ed791 .activation1{fill:#f4f4f4;stroke:#666;}#m3a8c73b05a6ed791 .activation2{fill:#f4f4f4;stroke:#666;}#m3a8c73b05a6ed791 .actorPopupMenu{position:absolute;}#m3a8c73b05a6ed791 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#m3a8c73b05a6ed791 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m3a8c73b05a6ed791 .actor-man circle,#m3a8c73b05a6ed791 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#m3a8c73b05a6ed791 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #m6b3dfda854625e5d{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m6b3dfda854625e5d .error-icon{fill:#552222;}#m6b3dfda854625e5d .error-text{fill:#552222;stroke:#552222;}#m6b3dfda854625e5d .edge-thickness-normal{stroke-width:1px;}#m6b3dfda854625e5d .edge-thickness-thick{stroke-width:3.5px;}#m6b3dfda854625e5d .edge-pattern-solid{stroke-dasharray:0;}#m6b3dfda854625e5d .edge-thickness-invisible{stroke-width:0;fill:none;}#m6b3dfda854625e5d .edge-pattern-dashed{stroke-dasharray:3;}#m6b3dfda854625e5d .edge-pattern-dotted{stroke-dasharray:2;}#m6b3dfda854625e5d .marker{fill:#333333;stroke:#333333;}#m6b3dfda854625e5d .marker.cross{stroke:#333333;}#m6b3dfda854625e5d svg{font-family:var(--font-mermaid);font-size:16px;}#m6b3dfda854625e5d p{margin:0;}#m6b3dfda854625e5d .label{font-family:var(--font-mermaid);color:#333;}#m6b3dfda854625e5d .cluster-label text{fill:#333;}#m6b3dfda854625e5d .cluster-label span{color:#333;}#m6b3dfda854625e5d .cluster-label span p{background-color:transparent;}#m6b3dfda854625e5d .label text,#m6b3dfda854625e5d span{fill:#333;color:#333;}#m6b3dfda854625e5d .node rect,#m6b3dfda854625e5d .node circle,#m6b3dfda854625e5d .node ellipse,#m6b3dfda854625e5d .node polygon,#m6b3dfda854625e5d .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#m6b3dfda854625e5d .rough-node .label text,#m6b3dfda854625e5d .node .label text,#m6b3dfda854625e5d .image-shape .label,#m6b3dfda854625e5d .icon-shape .label{text-anchor:middle;}#m6b3dfda854625e5d .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#m6b3dfda854625e5d .rough-node .label,#m6b3dfda854625e5d .node .label,#m6b3dfda854625e5d .image-shape .label,#m6b3dfda854625e5d .icon-shape .label{text-align:center;}#m6b3dfda854625e5d .node.clickable{cursor:pointer;}#m6b3dfda854625e5d .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#m6b3dfda854625e5d .arrowheadPath{fill:#333333;}#m6b3dfda854625e5d .edgePath .path{stroke:#333333;stroke-width:2.0px;}#m6b3dfda854625e5d .flowchart-link{stroke:#333333;fill:none;}#m6b3dfda854625e5d .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#m6b3dfda854625e5d .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#m6b3dfda854625e5d .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m6b3dfda854625e5d .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#m6b3dfda854625e5d .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#m6b3dfda854625e5d .cluster text{fill:#333;}#m6b3dfda854625e5d .cluster span{color:#333;}#m6b3dfda854625e5d div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#m6b3dfda854625e5d .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#m6b3dfda854625e5d rect.text{fill:none;stroke-width:0;}#m6b3dfda854625e5d .icon-shape,#m6b3dfda854625e5d .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#m6b3dfda854625e5d .icon-shape p,#m6b3dfda854625e5d .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#m6b3dfda854625e5d .icon-shape rect,#m6b3dfda854625e5d .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m6b3dfda854625e5d :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #mc7ad6757275da255{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#mc7ad6757275da255 .error-icon{fill:#552222;}#mc7ad6757275da255 .error-text{fill:#552222;stroke:#552222;}#mc7ad6757275da255 .edge-thickness-normal{stroke-width:1px;}#mc7ad6757275da255 .edge-thickness-thick{stroke-width:3.5px;}#mc7ad6757275da255 .edge-pattern-solid{stroke-dasharray:0;}#mc7ad6757275da255 .edge-thickness-invisible{stroke-width:0;fill:none;}#mc7ad6757275da255 .edge-pattern-dashed{stroke-dasharray:3;}#mc7ad6757275da255 .edge-pattern-dotted{stroke-dasharray:2;}#mc7ad6757275da255 .marker{fill:#333333;stroke:#333333;}#mc7ad6757275da255 .marker.cross{stroke:#333333;}#mc7ad6757275da255 svg{font-family:var(--font-mermaid);font-size:16px;}#mc7ad6757275da255 p{margin:0;}#mc7ad6757275da255 .label{font-family:var(--font-mermaid);color:#333;}#mc7ad6757275da255 .cluster-label text{fill:#333;}#mc7ad6757275da255 .cluster-label span{color:#333;}#mc7ad6757275da255 .cluster-label span p{background-color:transparent;}#mc7ad6757275da255 .label text,#mc7ad6757275da255 span{fill:#333;color:#333;}#mc7ad6757275da255 .node rect,#mc7ad6757275da255 .node circle,#mc7ad6757275da255 .node ellipse,#mc7ad6757275da255 .node polygon,#mc7ad6757275da255 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mc7ad6757275da255 .rough-node .label text,#mc7ad6757275da255 .node .label text,#mc7ad6757275da255 .image-shape .label,#mc7ad6757275da255 .icon-shape .label{text-anchor:middle;}#mc7ad6757275da255 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mc7ad6757275da255 .rough-node .label,#mc7ad6757275da255 .node .label,#mc7ad6757275da255 .image-shape .label,#mc7ad6757275da255 .icon-shape .label{text-align:center;}#mc7ad6757275da255 .node.clickable{cursor:pointer;}#mc7ad6757275da255 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mc7ad6757275da255 .arrowheadPath{fill:#333333;}#mc7ad6757275da255 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mc7ad6757275da255 .flowchart-link{stroke:#333333;fill:none;}#mc7ad6757275da255 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mc7ad6757275da255 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mc7ad6757275da255 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mc7ad6757275da255 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mc7ad6757275da255 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mc7ad6757275da255 .cluster text{fill:#333;}#mc7ad6757275da255 .cluster span{color:#333;}#mc7ad6757275da255 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mc7ad6757275da255 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mc7ad6757275da255 rect.text{fill:none;stroke-width:0;}#mc7ad6757275da255 .icon-shape,#mc7ad6757275da255 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mc7ad6757275da255 .icon-shape p,#mc7ad6757275da255 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mc7ad6757275da255 .icon-shape rect,#mc7ad6757275da255 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mc7ad6757275da255 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
} #m328b44ab19e4620b{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m328b44ab19e4620b .error-icon{fill:#552222;}#m328b44ab19e4620b .error-text{fill:#552222;stroke:#552222;}#m328b44ab19e4620b .edge-thickness-normal{stroke-width:1px;}#m328b44ab19e4620b .edge-thickness-thick{stroke-width:3.5px;}#m328b44ab19e4620b .edge-pattern-solid{stroke-dasharray:0;}#m328b44ab19e4620b .edge-thickness-invisible{stroke-width:0;fill:none;}#m328b44ab19e4620b .edge-pattern-dashed{stroke-dasharray:3;}#m328b44ab19e4620b .edge-pattern-dotted{stroke-dasharray:2;}#m328b44ab19e4620b .marker{fill:#333333;stroke:#333333;}#m328b44ab19e4620b .marker.cross{stroke:#333333;}#m328b44ab19e4620b svg{font-family:var(--font-mermaid);font-size:16px;}#m328b44ab19e4620b p{margin:0;}#m328b44ab19e4620b .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m328b44ab19e4620b text.actor&gt;tspan{fill:black;stroke:none;}#m328b44ab19e4620b .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m328b44ab19e4620b .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#m328b44ab19e4620b .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#m328b44ab19e4620b #m328b44ab19e4620b-arrowhead path{fill:#333;stroke:#333;}#m328b44ab19e4620b .sequenceNumber{fill:white;}#m328b44ab19e4620b #m328b44ab19e4620b-sequencenumber{fill:#333;}#m328b44ab19e4620b #m328b44ab19e4620b-crosshead path{fill:#333;stroke:#333;}#m328b44ab19e4620b .messageText{fill:#333;stroke:none;}#m328b44ab19e4620b .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m328b44ab19e4620b .labelText,#m328b44ab19e4620b .labelText&gt;tspan{fill:black;stroke:none;}#m328b44ab19e4620b .loopText,#m328b44ab19e4620b .loopText&gt;tspan{fill:black;stroke:none;}#m328b44ab19e4620b .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m328b44ab19e4620b .note{stroke:#aaaa33;fill:#fff5ad;}#m328b44ab19e4620b .noteText,#m328b44ab19e4620b .noteText&gt;tspan{fill:black;stroke:none;}#m328b44ab19e4620b .activation0{fill:#f4f4f4;stroke:#666;}#m328b44ab19e4620b .activation1{fill:#f4f4f4;stroke:#666;}#m328b44ab19e4620b .activation2{fill:#f4f4f4;stroke:#666;}#m328b44ab19e4620b .actorPopupMenu{position:absolute;}#m328b44ab19e4620b .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#m328b44ab19e4620b .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m328b44ab19e4620b .actor-man circle,#m328b44ab19e4620b line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#m328b44ab19e4620b :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #md25cced2a81ac9f6{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#md25cced2a81ac9f6 .error-icon{fill:#552222;}#md25cced2a81ac9f6 .error-text{fill:#552222;stroke:#552222;}#md25cced2a81ac9f6 .edge-thickness-normal{stroke-width:1px;}#md25cced2a81ac9f6 .edge-thickness-thick{stroke-width:3.5px;}#md25cced2a81ac9f6 .edge-pattern-solid{stroke-dasharray:0;}#md25cced2a81ac9f6 .edge-thickness-invisible{stroke-width:0;fill:none;}#md25cced2a81ac9f6 .edge-pattern-dashed{stroke-dasharray:3;}#md25cced2a81ac9f6 .edge-pattern-dotted{stroke-dasharray:2;}#md25cced2a81ac9f6 .marker{fill:#333333;stroke:#333333;}#md25cced2a81ac9f6 .marker.cross{stroke:#333333;}#md25cced2a81ac9f6 svg{font-family:var(--font-mermaid);font-size:16px;}#md25cced2a81ac9f6 p{margin:0;}#md25cced2a81ac9f6 .label{font-family:var(--font-mermaid);color:#333;}#md25cced2a81ac9f6 .cluster-label text{fill:#333;}#md25cced2a81ac9f6 .cluster-label span{color:#333;}#md25cced2a81ac9f6 .cluster-label span p{background-color:transparent;}#md25cced2a81ac9f6 .label text,#md25cced2a81ac9f6 span{fill:#333;color:#333;}#md25cced2a81ac9f6 .node rect,#md25cced2a81ac9f6 .node circle,#md25cced2a81ac9f6 .node ellipse,#md25cced2a81ac9f6 .node polygon,#md25cced2a81ac9f6 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#md25cced2a81ac9f6 .rough-node .label text,#md25cced2a81ac9f6 .node .label text,#md25cced2a81ac9f6 .image-shape .label,#md25cced2a81ac9f6 .icon-shape .label{text-anchor:middle;}#md25cced2a81ac9f6 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#md25cced2a81ac9f6 .rough-node .label,#md25cced2a81ac9f6 .node .label,#md25cced2a81ac9f6 .image-shape .label,#md25cced2a81ac9f6 .icon-shape .label{text-align:center;}#md25cced2a81ac9f6 .node.clickable{cursor:pointer;}#md25cced2a81ac9f6 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#md25cced2a81ac9f6 .arrowheadPath{fill:#333333;}#md25cced2a81ac9f6 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#md25cced2a81ac9f6 .flowchart-link{stroke:#333333;fill:none;}#md25cced2a81ac9f6 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#md25cced2a81ac9f6 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#md25cced2a81ac9f6 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#md25cced2a81ac9f6 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#md25cced2a81ac9f6 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#md25cced2a81ac9f6 .cluster text{fill:#333;}#md25cced2a81ac9f6 .cluster span{color:#333;}#md25cced2a81ac9f6 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#md25cced2a81ac9f6 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#md25cced2a81ac9f6 rect.text{fill:none;stroke-width:0;}#md25cced2a81ac9f6 .icon-shape,#md25cced2a81ac9f6 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#md25cced2a81ac9f6 .icon-shape p,#md25cced2a81ac9f6 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#md25cced2a81ac9f6 .icon-shape rect,#md25cced2a81ac9f6 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#md25cced2a81ac9f6 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #m6cbd70a11c636dd0{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m6cbd70a11c636dd0 .error-icon{fill:#552222;}#m6cbd70a11c636dd0 .error-text{fill:#552222;stroke:#552222;}#m6cbd70a11c636dd0 .edge-thickness-normal{stroke-width:1px;}#m6cbd70a11c636dd0 .edge-thickness-thick{stroke-width:3.5px;}#m6cbd70a11c636dd0 .edge-pattern-solid{stroke-dasharray:0;}#m6cbd70a11c636dd0 .edge-thickness-invisible{stroke-width:0;fill:none;}#m6cbd70a11c636dd0 .edge-pattern-dashed{stroke-dasharray:3;}#m6cbd70a11c636dd0 .edge-pattern-dotted{stroke-dasharray:2;}#m6cbd70a11c636dd0 .marker{fill:#333333;stroke:#333333;}#m6cbd70a11c636dd0 .marker.cross{stroke:#333333;}#m6cbd70a11c636dd0 svg{font-family:var(--font-mermaid);font-size:16px;}#m6cbd70a11c636dd0 p{margin:0;}#m6cbd70a11c636dd0 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m6cbd70a11c636dd0 text.actor&gt;tspan{fill:black;stroke:none;}#m6cbd70a11c636dd0 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m6cbd70a11c636dd0 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#m6cbd70a11c636dd0 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#m6cbd70a11c636dd0 #m6cbd70a11c636dd0-arrowhead path{fill:#333;stroke:#333;}#m6cbd70a11c636dd0 .sequenceNumber{fill:white;}#m6cbd70a11c636dd0 #m6cbd70a11c636dd0-sequencenumber{fill:#333;}#m6cbd70a11c636dd0 #m6cbd70a11c636dd0-crosshead path{fill:#333;stroke:#333;}#m6cbd70a11c636dd0 .messageText{fill:#333;stroke:none;}#m6cbd70a11c636dd0 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m6cbd70a11c636dd0 .labelText,#m6cbd70a11c636dd0 .labelText&gt;tspan{fill:black;stroke:none;}#m6cbd70a11c636dd0 .loopText,#m6cbd70a11c636dd0 .loopText&gt;tspan{fill:black;stroke:none;}#m6cbd70a11c636dd0 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m6cbd70a11c636dd0 .note{stroke:#aaaa33;fill:#fff5ad;}#m6cbd70a11c636dd0 .noteText,#m6cbd70a11c636dd0 .noteText&gt;tspan{fill:black;stroke:none;}#m6cbd70a11c636dd0 .activation0{fill:#f4f4f4;stroke:#666;}#m6cbd70a11c636dd0 .activation1{fill:#f4f4f4;stroke:#666;}#m6cbd70a11c636dd0 .activation2{fill:#f4f4f4;stroke:#666;}#m6cbd70a11c636dd0 .actorPopupMenu{position:absolute;}#m6cbd70a11c636dd0 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#m6cbd70a11c636dd0 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m6cbd70a11c636dd0 .actor-man circle,#m6cbd70a11c636dd0 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#m6cbd70a11c636dd0 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;} #mf27572cd3a3df5ae{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#mf27572cd3a3df5ae .error-icon{fill:#552222;}#mf27572cd3a3df5ae .error-text{fill:#552222;stroke:#552222;}#mf27572cd3a3df5ae .edge-thickness-normal{stroke-width:1px;}#mf27572cd3a3df5ae .edge-thickness-thick{stroke-width:3.5px;}#mf27572cd3a3df5ae .edge-pattern-solid{stroke-dasharray:0;}#mf27572cd3a3df5ae .edge-thickness-invisible{stroke-width:0;fill:none;}#mf27572cd3a3df5ae .edge-pattern-dashed{stroke-dasharray:3;}#mf27572cd3a3df5ae .edge-pattern-dotted{stroke-dasharray:2;}#mf27572cd3a3df5ae .marker{fill:#333333;stroke:#333333;}#mf27572cd3a3df5ae .marker.cross{stroke:#333333;}#mf27572cd3a3df5ae svg{font-family:var(--font-mermaid);font-size:16px;}#mf27572cd3a3df5ae p{margin:0;}#mf27572cd3a3df5ae .label{font-family:var(--font-mermaid);color:#333;}#mf27572cd3a3df5ae .cluster-label text{fill:#333;}#mf27572cd3a3df5ae .cluster-label span{color:#333;}#mf27572cd3a3df5ae .cluster-label span p{background-color:transparent;}#mf27572cd3a3df5ae .label text,#mf27572cd3a3df5ae span{fill:#333;color:#333;}#mf27572cd3a3df5ae .node rect,#mf27572cd3a3df5ae .node circle,#mf27572cd3a3df5ae .node ellipse,#mf27572cd3a3df5ae .node polygon,#mf27572cd3a3df5ae .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mf27572cd3a3df5ae .rough-node .label text,#mf27572cd3a3df5ae .node .label text,#mf27572cd3a3df5ae .image-shape .label,#mf27572cd3a3df5ae .icon-shape .label{text-anchor:middle;}#mf27572cd3a3df5ae .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mf27572cd3a3df5ae .rough-node .label,#mf27572cd3a3df5ae .node .label,#mf27572cd3a3df5ae .image-shape .label,#mf27572cd3a3df5ae .icon-shape .label{text-align:center;}#mf27572cd3a3df5ae .node.clickable{cursor:pointer;}#mf27572cd3a3df5ae .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mf27572cd3a3df5ae .arrowheadPath{fill:#333333;}#mf27572cd3a3df5ae .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mf27572cd3a3df5ae .flowchart-link{stroke:#333333;fill:none;}#mf27572cd3a3df5ae .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mf27572cd3a3df5ae .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mf27572cd3a3df5ae .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mf27572cd3a3df5ae .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mf27572cd3a3df5ae .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mf27572cd3a3df5ae .cluster text{fill:#333;}#mf27572cd3a3df5ae .cluster span{color:#333;}#mf27572cd3a3df5ae div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mf27572cd3a3df5ae .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mf27572cd3a3df5ae rect.text{fill:none;stroke-width:0;}#mf27572cd3a3df5ae .icon-shape,#mf27572cd3a3df5ae .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mf27572cd3a3df5ae .icon-shape p,#mf27572cd3a3df5ae .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mf27572cd3a3df5ae .icon-shape rect,#mf27572cd3a3df5ae .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mf27572cd3a3df5ae :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}undefined
</style>
    </head>
    <body>
<p dir="auto">[# ETL Developer Guide — OMAP_ETL</p>
<h1 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h1>
<p dir="auto">This document is a developer-focused guide to the OMAP ETL: what it does, how the mapping is represented, the two runtime modes (FastChange and SlowChange), the main files and stored procedures and how to run and debug.</p>
<p dir="auto">The ETL synchronizes data from multiple source schemas/databases into a single unified destination schema (the <code>OMAP</code> DB). It supports near-real-time updates (FastChange) and bulk runs (SlowChange).</p>
<h1 data-heading="**Content**" dir="auto"><strong>Content</strong></h1>
<ol>
<li dir="auto">High-level architecture</li>
<li dir="auto">Mapping </li>
<li dir="auto">FastChange</li>
<li dir="auto">SlowChange</li>
<li dir="auto">Files (quick overview)</li>
<li dir="auto">Stored Procedures</li>
</ol>
<h1 data-heading="**High_Level_Architecture**" dir="auto"><strong>High_Level_Architecture</strong></h1>
<ul>
<li dir="auto"><strong>Mapping definition</strong>: Data team provides an Excel file (4 sheets). The mapping upload tool extracts sheets, copies them into the <code>OMAP_ETL</code> database and runs <code>SP_ETL_Mapping_Tables_Preparation</code> which converts the raw sheets into tables <code>fieldsMapping</code> and <code>valuesMapping</code>.</li>
<li dir="auto"><strong>FastChange</strong>: SQL Agent jobs execute stored procedures at ~10s frequency to sync recent changes from source to destination.</li>
<li dir="auto"><strong>SlowChange</strong>: Insert into <code>ETL_Jobs</code> via UI or scheduled jobs which loops over mapping combinations and calls <code>SP_ETL_SC_Sync_Entity</code> which is responsible for synchronizing the data.</li>
</ul>
<div class="mermaid"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 1231.5078125 578" height="578" class="flowchart" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="1231.5078125" id="me5ac829cafe14ae2"><style>#me5ac829cafe14ae2{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#me5ac829cafe14ae2 .error-icon{fill:#552222;}#me5ac829cafe14ae2 .error-text{fill:#552222;stroke:#552222;}#me5ac829cafe14ae2 .edge-thickness-normal{stroke-width:1px;}#me5ac829cafe14ae2 .edge-thickness-thick{stroke-width:3.5px;}#me5ac829cafe14ae2 .edge-pattern-solid{stroke-dasharray:0;}#me5ac829cafe14ae2 .edge-thickness-invisible{stroke-width:0;fill:none;}#me5ac829cafe14ae2 .edge-pattern-dashed{stroke-dasharray:3;}#me5ac829cafe14ae2 .edge-pattern-dotted{stroke-dasharray:2;}#me5ac829cafe14ae2 .marker{fill:#333333;stroke:#333333;}#me5ac829cafe14ae2 .marker.cross{stroke:#333333;}#me5ac829cafe14ae2 svg{font-family:var(--font-mermaid);font-size:16px;}#me5ac829cafe14ae2 p{margin:0;}#me5ac829cafe14ae2 .label{font-family:var(--font-mermaid);color:#333;}#me5ac829cafe14ae2 .cluster-label text{fill:#333;}#me5ac829cafe14ae2 .cluster-label span{color:#333;}#me5ac829cafe14ae2 .cluster-label span p{background-color:transparent;}#me5ac829cafe14ae2 .label text,#me5ac829cafe14ae2 span{fill:#333;color:#333;}#me5ac829cafe14ae2 .node rect,#me5ac829cafe14ae2 .node circle,#me5ac829cafe14ae2 .node ellipse,#me5ac829cafe14ae2 .node polygon,#me5ac829cafe14ae2 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#me5ac829cafe14ae2 .rough-node .label text,#me5ac829cafe14ae2 .node .label text,#me5ac829cafe14ae2 .image-shape .label,#me5ac829cafe14ae2 .icon-shape .label{text-anchor:middle;}#me5ac829cafe14ae2 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#me5ac829cafe14ae2 .rough-node .label,#me5ac829cafe14ae2 .node .label,#me5ac829cafe14ae2 .image-shape .label,#me5ac829cafe14ae2 .icon-shape .label{text-align:center;}#me5ac829cafe14ae2 .node.clickable{cursor:pointer;}#me5ac829cafe14ae2 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#me5ac829cafe14ae2 .arrowheadPath{fill:#333333;}#me5ac829cafe14ae2 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#me5ac829cafe14ae2 .flowchart-link{stroke:#333333;fill:none;}#me5ac829cafe14ae2 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#me5ac829cafe14ae2 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#me5ac829cafe14ae2 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#me5ac829cafe14ae2 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#me5ac829cafe14ae2 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#me5ac829cafe14ae2 .cluster text{fill:#333;}#me5ac829cafe14ae2 .cluster span{color:#333;}#me5ac829cafe14ae2 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#me5ac829cafe14ae2 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#me5ac829cafe14ae2 rect.text{fill:none;stroke-width:0;}#me5ac829cafe14ae2 .icon-shape,#me5ac829cafe14ae2 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#me5ac829cafe14ae2 .icon-shape p,#me5ac829cafe14ae2 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#me5ac829cafe14ae2 .icon-shape rect,#me5ac829cafe14ae2 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#me5ac829cafe14ae2 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"><g data-look="classic" id="SlowChange" class="cluster"><rect height="385" width="310.015625" y="8" x="913.4921875" style=""></rect><g transform="translate(1022.6796875, 8)" class="cluster-label"><foreignObject height="24" width="91.640625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Slow Change</p></span></div></foreignObject></g></g><g data-look="classic" id="FastChange" class="cluster"><rect height="256" width="310.015625" y="137" x="583.4765625" style=""></rect><g transform="translate(695.5078125, 137)" class="cluster-label"><foreignObject height="24" width="85.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Fast Change</p></span></div></foreignObject></g></g><g data-look="classic" id="Mapping" class="cluster"><rect height="433" width="555.4765625" y="137" x="8" style=""></rect><g transform="translate(253.90234375, 137)" class="cluster-label"><foreignObject height="24" width="63.671875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Mapping</p></span></div></foreignObject></g></g></g><g class="edgePaths"><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_A_B_0" d="M213.758,240L213.758,244.167C213.758,248.333,213.758,256.667,213.758,264.333C213.758,272,213.758,279,213.758,282.5L213.758,286"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_B_D_1" d="M213.758,368L213.758,372.167C213.758,376.333,213.758,384.667,213.758,395C213.758,405.333,213.758,417.667,220.743,429.577C227.727,441.487,241.697,452.973,248.682,458.716L255.667,464.46"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_FJ_FJOP_2" d="M738.484,240L738.484,244.167C738.484,248.333,738.484,256.667,738.484,264.333C738.484,272,738.484,279,738.484,282.5L738.484,286"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_UI_INS_3" d="M1068.5,87L1068.5,91.167C1068.5,95.333,1068.5,103.667,1068.5,112C1068.5,120.333,1068.5,128.667,1068.5,138.333C1068.5,148,1068.5,159,1068.5,164.5L1068.5,170"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_INS_SJOP_4" d="M1068.5,228L1068.5,234.167C1068.5,240.333,1068.5,252.667,1068.5,262.333C1068.5,272,1068.5,279,1068.5,282.5L1068.5,286"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_FJOP_D_5" d="M703.443,368L699.699,372.167C695.955,376.333,688.468,384.667,622.259,395C556.049,405.333,431.118,417.667,368.653,429.333C306.188,441,306.188,452,306.188,457.5L306.188,463"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SJOP_D_6" d="M1033.459,368L1029.715,372.167C1025.971,376.333,1018.484,384.667,924.748,395C831.013,405.333,651.03,417.667,548.267,429.721C445.504,441.775,419.962,453.55,407.19,459.438L394.419,465.325"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_FJOP_DEST_7" d="M779.62,368L784.014,372.167C788.409,376.333,797.199,384.667,801.593,395C805.988,405.333,805.988,417.667,818.772,429.721C831.555,441.776,857.121,453.551,869.905,459.439L882.688,465.327"></path><path marker-end="url(#me5ac829cafe14ae2-me5ac829cafe14ae2_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SJOP_DEST_8" d="M1109.635,368L1114.03,372.167C1118.425,376.333,1127.214,384.667,1131.609,395C1136.004,405.333,1136.004,417.667,1123.221,429.721C1110.437,441.776,1084.871,453.551,1072.088,459.439L1059.304,465.327"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(306.1875, 430)" class="edgeLabel"><g transform="translate(-72.4296875, -12)" class="label"><foreignObject height="24" width="144.859375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>uses mapping tables</p></span></div></foreignObject></g></g><g transform="translate(471.046875, 430)" class="edgeLabel"><g transform="translate(-72.4296875, -12)" class="label"><foreignObject height="24" width="144.859375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>uses mapping tables</p></span></div></foreignObject></g></g><g transform="translate(805.98828125, 430)" class="edgeLabel"><g transform="translate(-30.3828125, -12)" class="label"><foreignObject height="24" width="60.765625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>writes to</p></span></div></foreignObject></g></g><g transform="translate(1136.00390625, 430)" class="edgeLabel"><g transform="translate(-30.3828125, -12)" class="label"><foreignObject height="24" width="60.765625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>writes to</p></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(213.7578125, 201)" id="flowchart-A-294" class="node default"><rect height="78" width="163.125" y="-39" x="-81.5625" style="" class="basic label-container"></rect><g transform="translate(-51.5625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="103.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Mapping Excel<br>4 sheets</p></span></div></foreignObject></g></g><g transform="translate(213.7578125, 329)" id="flowchart-B-295" class="node default"><rect height="78" width="341.515625" y="-39" x="-170.7578125" style="" class="basic label-container"></rect><g transform="translate(-140.7578125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="281.515625"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Upload tool<br>Upload_OMAP_ETL_Mapping_Service.py</p></span></div></foreignObject></g></g><g transform="translate(306.1875, 506)" id="flowchart-D-296" class="node default"><rect height="78" width="260" y="-39" x="-130" style="" class="basic label-container"></rect><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>fieldsMapping / valuesMapping</p></span></div></foreignObject></g></g><g transform="translate(738.484375, 201)" id="flowchart-FJ-300" class="node default"><rect height="78" width="170.734375" y="-39" x="-85.3671875" style="" class="basic label-container"></rect><g transform="translate(-55.3671875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="110.734375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SQL Agent Jobs<br> run every 10s</p></span></div></foreignObject></g></g><g transform="translate(738.484375, 329)" id="flowchart-FJOP-301" class="node default"><rect height="78" width="240.015625" y="-39" x="-120.0078125" style="" class="basic label-container"></rect><g transform="translate(-90.0078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="180.015625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Run necessary operations<br>more details later</p></span></div></foreignObject></g></g><g transform="translate(1068.5, 60)" id="flowchart-UI-304" class="node default"><rect height="54" width="220.96875" y="-27" x="-110.484375" style="" class="basic label-container"></rect><g transform="translate(-80.484375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="160.96875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETL UI / Scheduled Job</p></span></div></foreignObject></g></g><g transform="translate(1068.5, 201)" id="flowchart-INS-305" class="node default"><rect height="54" width="176.375" y="-27" x="-88.1875" style="" class="basic label-container"></rect><g transform="translate(-58.1875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="116.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>INSERT ETL_Jobs</p></span></div></foreignObject></g></g><g transform="translate(1068.5, 329)" id="flowchart-SJOP-306" class="node default"><rect height="78" width="240.015625" y="-39" x="-120.0078125" style="" class="basic label-container"></rect><g transform="translate(-90.0078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="180.015625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Run necessary operations<br>more details later</p></span></div></foreignObject></g></g><g transform="translate(970.99609375, 506)" id="flowchart-DEST-310" class="node default"><rect height="78" width="260" y="-39" x="-130" style="" class="basic label-container"></rect><g transform="translate(-100, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Destination Database OMAP</p></span></div></foreignObject></g></g></g></g></g>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div>
<h1 data-heading="**Mapping**" dir="auto"><strong>Mapping</strong></h1>
<ul>
<li dir="auto">Excel sheets (provided by data team):
<ul>
<li dir="auto"><strong>Object Classes (valuesMapping)</strong>: represents subtypes and their value mappings.</li>
<li dir="auto"><strong>Fields (fieldsMapping)</strong>: represents schema mapping.</li>
<li dir="auto"><strong>Domains (valuesMapping)</strong>: represents domains mapping.</li>
<li dir="auto"><strong>Domains | Subtypes | Values(valuesMapping)</strong>: represents other values mappings text to number, number to text, domain to text or number ... etc.</li>
</ul>
</li>
<li dir="auto">Final tables:<br>
The 4 sheets are converted to the following two tables to be used in the app:
<ul>
<li dir="auto"><code>fieldsMapping</code> — field/entity-level mapping used by sync procedures.</li>
<li dir="auto"><code>valuesMapping</code> — domain/value mapping used to convert coded values.</li>
</ul>
</li>
<li dir="auto">Mapping pipeline:
<ol>
<li dir="auto">Upload Excel via ETL tool (<code>Upload mapping</code> tab): this is a Geoprocessing tool, it's code could be found at <code>Upload_OMAP_ETL_Mapping_Service.py</code>.</li>
<li dir="auto">Sheets extracted to a temporary geodatabase and then copied into <code>OMAP_ETL</code> raw tables.</li>
<li dir="auto">The script runs <code>SP_ETL_Mapping_Tables_Preparation</code> to populate <code>fieldsMapping</code> and <code>valuesMapping</code>.</li>
</ol>
</li>
</ul>
<h1 data-heading="**Fast_Change**" dir="auto"><strong>Fast_Change</strong></h1>
<p dir="auto">Purpose: capture and apply source edits quickly (two pipelines run in parallel to meet time limitation).</p>
<ul>
<li dir="auto"><strong>Jobs &amp; procedures</strong>:
<ul>
<li dir="auto"><code>FastChange_Plot_Duqm_Job</code> → <code>SP_ETL_FastChange_Duqm</code></li>
<li dir="auto"><code>FastChange_Plots_Other_Than_Duqm_Job</code> → <code>SP_ETL_FastChange_Plots_Other_Than_Duqm</code></li>
</ul>
</li>
<li dir="auto">Why two jobs: Duqm and non-Duqm zones have different worst-case run times and must both complete within ~10s; running them in parallel avoids missing the time window.</li>
</ul>
<h2 data-heading="**FastChange flow (per job):**" dir="auto"><strong>FastChange flow (per job):</strong></h2>
<ol>
<li dir="auto">Confirm node is primary replica (AG check).</li>
<li dir="auto">Run <code>SP_ETL_Plot_Pre_Sync</code> — adds RowHash/meta fields, creates archives, statistics table and supporting views.</li>
<li dir="auto">Run <code>SP_ETL_FC_Sync_Entity</code> — core sync (select, compute RowHash, compare, delete/insert rows).</li>
<li dir="auto">Sync deletions via <code>SP_ETL_CppLotWGS84_Cpplotpoint_Sync_Delete</code>.</li>
<li dir="auto">Project results to WGS84 via <code>SP_ETL_Plot_Projection</code> + <code>projectionScript.py</code>.</li>
<li dir="auto">Finalize via <code>SP_ETL_Plot_Post_Sync</code> (load cpplotPoint, recalc stats).</li>
</ol>
<div class="mermaid"><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-78 -10 3064.5 1727" height="1727" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="3064.5" id="m79b97fe8881a22cb"><g><rect class="actor actor-bottom" ry="3" rx="3" name="DB" height="65" width="563" stroke="#666" fill="#eaeaea" y="1641" x="2373.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="2655"><tspan dy="-8" x="2655">OMAP Database Tables </tspan></text><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="2655"><tspan dy="8" x="2655"> (cpplot39/40/WGS84, cpplot39/40_Archive, cpplotpointWGS84 and statistics)</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Post" height="65" width="178" stroke="#666" fill="#eaeaea" y="1641" x="2145.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="2234.5"><tspan dy="0" x="2234.5">SP_ETL_Plot_Post_Sync</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="PyScript" height="65" width="153" stroke="#666" fill="#eaeaea" y="1641" x="1942.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="2019"><tspan dy="0" x="2019">projectionScript.py</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Proj" height="65" width="180" stroke="#666" fill="#eaeaea" y="1641" x="1696"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="1786"><tspan dy="0" x="1786">SP_ETL_Plot_Projection</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Del" height="65" width="411" stroke="#666" fill="#eaeaea" y="1641" x="1235"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="1440.5"><tspan dy="0" x="1440.5">SP_ETL_CppLotWGS84_CpplotpointWGS84_Sync_Delete</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Sync" height="65" width="178" stroke="#666" fill="#eaeaea" y="1641" x="1007"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="1096"><tspan dy="0" x="1096">SP_ETL_FC_Sync_Entity</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Pre" height="65" width="171" stroke="#666" fill="#eaeaea" y="1641" x="786"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="871.5"><tspan dy="0" x="871.5">SP_ETL_Plot_Pre_Sync</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="AG" height="65" width="150" stroke="#666" fill="#eaeaea" y="1641" x="586"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="661"><tspan dy="0" x="661">Availability Group</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Job" height="65" width="336" stroke="#666" fill="#eaeaea" y="1641" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="368"><tspan dy="-8" x="368">SP_ETL_FastChange_Duqm </tspan></text><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="368"><tspan dy="8" x="368"> SP_ETL_FastChange_Plots_Other_Than_Duqm</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Agt" height="65" width="150" stroke="#666" fill="#eaeaea" y="1641" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="1673.5" x="75"><tspan dy="0" x="75">SQL Agent Job</tspan></text></g><g><line name="DB" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="2655" y1="65" x1="2655" id="actor107"></line><g id="root-107"><rect class="actor actor-top" ry="3" rx="3" name="DB" height="65" width="563" stroke="#666" fill="#eaeaea" y="0" x="2373.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="2655"><tspan dy="-8" x="2655">OMAP Database Tables </tspan></text><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="2655"><tspan dy="8" x="2655"> (cpplot39/40/WGS84, cpplot39/40_Archive, cpplotpointWGS84 and statistics)</tspan></text></g></g><g><line name="Post" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="2234.5" y1="65" x1="2234.5" id="actor106"></line><g id="root-106"><rect class="actor actor-top" ry="3" rx="3" name="Post" height="65" width="178" stroke="#666" fill="#eaeaea" y="0" x="2145.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="2234.5"><tspan dy="0" x="2234.5">SP_ETL_Plot_Post_Sync</tspan></text></g></g><g><line name="PyScript" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="2019" y1="65" x1="2019" id="actor105"></line><g id="root-105"><rect class="actor actor-top" ry="3" rx="3" name="PyScript" height="65" width="153" stroke="#666" fill="#eaeaea" y="0" x="1942.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="2019"><tspan dy="0" x="2019">projectionScript.py</tspan></text></g></g><g><line name="Proj" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="1786" y1="65" x1="1786" id="actor104"></line><g id="root-104"><rect class="actor actor-top" ry="3" rx="3" name="Proj" height="65" width="180" stroke="#666" fill="#eaeaea" y="0" x="1696"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="1786"><tspan dy="0" x="1786">SP_ETL_Plot_Projection</tspan></text></g></g><g><line name="Del" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="1440.5" y1="65" x1="1440.5" id="actor103"></line><g id="root-103"><rect class="actor actor-top" ry="3" rx="3" name="Del" height="65" width="411" stroke="#666" fill="#eaeaea" y="0" x="1235"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="1440.5"><tspan dy="0" x="1440.5">SP_ETL_CppLotWGS84_CpplotpointWGS84_Sync_Delete</tspan></text></g></g><g><line name="Sync" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="1096" y1="65" x1="1096" id="actor102"></line><g id="root-102"><rect class="actor actor-top" ry="3" rx="3" name="Sync" height="65" width="178" stroke="#666" fill="#eaeaea" y="0" x="1007"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="1096"><tspan dy="0" x="1096">SP_ETL_FC_Sync_Entity</tspan></text></g></g><g><line name="Pre" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="871.5" y1="65" x1="871.5" id="actor101"></line><g id="root-101"><rect class="actor actor-top" ry="3" rx="3" name="Pre" height="65" width="171" stroke="#666" fill="#eaeaea" y="0" x="786"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="871.5"><tspan dy="0" x="871.5">SP_ETL_Plot_Pre_Sync</tspan></text></g></g><g><line name="AG" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="661" y1="65" x1="661" id="actor100"></line><g id="root-100"><rect class="actor actor-top" ry="3" rx="3" name="AG" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="586"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="661"><tspan dy="0" x="661">Availability Group</tspan></text></g></g><g><line name="Job" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="368" y1="65" x1="368" id="actor99"></line><g id="root-99"><rect class="actor actor-top" ry="3" rx="3" name="Job" height="65" width="336" stroke="#666" fill="#eaeaea" y="0" x="200"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="368"><tspan dy="-8" x="368">SP_ETL_FastChange_Duqm </tspan></text><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="368"><tspan dy="8" x="368"> SP_ETL_FastChange_Plots_Other_Than_Duqm</tspan></text></g></g><g><line name="Agt" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="1641" x2="75" y1="65" x1="75" id="actor98"></line><g id="root-98"><rect class="actor actor-top" ry="3" rx="3" name="Agt" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">SQL Agent Job</tspan></text></g></g><style>#m79b97fe8881a22cb{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m79b97fe8881a22cb .error-icon{fill:#552222;}#m79b97fe8881a22cb .error-text{fill:#552222;stroke:#552222;}#m79b97fe8881a22cb .edge-thickness-normal{stroke-width:1px;}#m79b97fe8881a22cb .edge-thickness-thick{stroke-width:3.5px;}#m79b97fe8881a22cb .edge-pattern-solid{stroke-dasharray:0;}#m79b97fe8881a22cb .edge-thickness-invisible{stroke-width:0;fill:none;}#m79b97fe8881a22cb .edge-pattern-dashed{stroke-dasharray:3;}#m79b97fe8881a22cb .edge-pattern-dotted{stroke-dasharray:2;}#m79b97fe8881a22cb .marker{fill:#333333;stroke:#333333;}#m79b97fe8881a22cb .marker.cross{stroke:#333333;}#m79b97fe8881a22cb svg{font-family:var(--font-mermaid);font-size:16px;}#m79b97fe8881a22cb p{margin:0;}#m79b97fe8881a22cb .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m79b97fe8881a22cb text.actor&gt;tspan{fill:black;stroke:none;}#m79b97fe8881a22cb .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m79b97fe8881a22cb .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#m79b97fe8881a22cb .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#m79b97fe8881a22cb #m79b97fe8881a22cb-arrowhead path{fill:#333;stroke:#333;}#m79b97fe8881a22cb .sequenceNumber{fill:white;}#m79b97fe8881a22cb #m79b97fe8881a22cb-sequencenumber{fill:#333;}#m79b97fe8881a22cb #m79b97fe8881a22cb-crosshead path{fill:#333;stroke:#333;}#m79b97fe8881a22cb .messageText{fill:#333;stroke:none;}#m79b97fe8881a22cb .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m79b97fe8881a22cb .labelText,#m79b97fe8881a22cb .labelText&gt;tspan{fill:black;stroke:none;}#m79b97fe8881a22cb .loopText,#m79b97fe8881a22cb .loopText&gt;tspan{fill:black;stroke:none;}#m79b97fe8881a22cb .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#m79b97fe8881a22cb .note{stroke:#aaaa33;fill:#fff5ad;}#m79b97fe8881a22cb .noteText,#m79b97fe8881a22cb .noteText&gt;tspan{fill:black;stroke:none;}#m79b97fe8881a22cb .activation0{fill:#f4f4f4;stroke:#666;}#m79b97fe8881a22cb .activation1{fill:#f4f4f4;stroke:#666;}#m79b97fe8881a22cb .activation2{fill:#f4f4f4;stroke:#666;}#m79b97fe8881a22cb .actorPopupMenu{position:absolute;}#m79b97fe8881a22cb .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#m79b97fe8881a22cb .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#m79b97fe8881a22cb .actor-man circle,#m79b97fe8881a22cb line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#m79b97fe8881a22cb :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="m79b97fe8881a22cb-arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="m79b97fe8881a22cb-crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="m79b97fe8881a22cb-filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="m79b97fe8881a22cb-sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect class="note" height="104" width="204" stroke="#666" fill="#EDF2AE" y="283" x="769.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="288" x="872"><tspan x="872">Add RowHash/meta fields</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="309" x="872"><tspan x="872">Create archives</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="330" x="872"><tspan x="872">Create statistics table</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="351" x="872"><tspan x="872">Create supporting views</tspan></text></g><g><rect class="note" height="125" width="207" stroke="#666" fill="#EDF2AE" y="553" x="992.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="558" x="1096"><tspan x="1096">SELECT source data</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="579" x="1096"><tspan x="1096">Compute RowHash</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="600" x="1096"><tspan x="1096">Compare with target</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="621" x="1096"><tspan x="1096">DELETE changed rows</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="642" x="1096"><tspan x="1096">INSERT new/updated rows</tspan></text></g><g><rect class="note" height="62" width="411" stroke="#666" fill="#EDF2AE" y="844" x="1235"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="849" x="1441"><tspan x="1441">Sync deletions between</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="870" x="1441"><tspan x="1441">cpplotWGS84 and cpplotPoint</tspan></text></g><g><rect class="note" height="62" width="241" stroke="#666" fill="#EDF2AE" y="1124" x="1898.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1129" x="2019"><tspan x="2019">Copy new and updated records </tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1150" x="2019"><tspan x="2019"> from cpplot39/40 to WGS84</tspan></text></g><g><rect class="note" height="62" width="178" stroke="#666" fill="#EDF2AE" y="1352" x="2145.5"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1357" x="2235"><tspan x="2235">Load cpplotPoint</tspan></text><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1378" x="2235"><tspan x="2235">Recalculate statistics</tspan></text></g><g><rect class="note" height="41" width="206" stroke="#666" fill="#EDF2AE" y="1580" x="-28"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1585" x="75"><tspan x="75">FastChange flow complete</tspan></text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="220">Run the stored procedure</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="117" x2="364" y1="117" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="132" x="513">Check if primary replica</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="169" x2="657" y1="169" x1="369"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="184" x="516">Confirmed primary</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="221" x2="372" y1="221" x1="660"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="236" x="618">Execute SP_ETL_Plot_Pre_Sync</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="273" x2="867.5" y1="273" x1="369"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="402" x="1762">Update destination tables</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="439" x2="2651" y1="439" x1="872.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="454" x="621">Pre-sync complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="491" x2="372" y1="491" x1="870.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="506" x="731">Execute SP_ETL_FC_Sync_Entity</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="543" x2="1092" y1="543" x1="369"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="693" x="1874">Update target tables</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="730" x2="2651" y1="730" x1="1097"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="745" x="734">Sync complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="782" x2="372" y1="782" x1="1095"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="797" x="903">Execute SP_ETL_CppLotWGS84_CpplotpointWGS84_Sync_Delete</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="834" x2="1436.5" y1="834" x1="369"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="921" x="2046">Apply deletions</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="958" x2="2651" y1="958" x1="1441.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="973" x="906">Deletion sync complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="1010" x2="372" y1="1010" x1="1439.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1025" x="1076">Execute SP_ETL_Plot_Projection</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1062" x2="1782" y1="1062" x1="369"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1077" x="1901">Call projectionScript.py</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1114" x2="2015" y1="1114" x1="1787"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1201" x="2219">Update cpplotWGS84 table</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="1238" x2="2651" y1="1238" x1="1787"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1253" x="1079">Projection complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="1290" x2="372" y1="1290" x1="1785"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1305" x="1300">Execute SP_ETL_Plot_Post_Sync</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1342" x2="2230.5" y1="1342" x1="369"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1429" x="2443">Finalize updates</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="1466" x2="2651" y1="1466" x1="2235.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1481" x="1303">Post-sync complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="1518" x2="372" y1="1518" x1="2233.5"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="1533" x="223">Job is finished</text><line style="fill: none;" marker-end="url(#m79b97fe8881a22cb-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="1570" x2="79" y1="1570" x1="367"></line>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div>
<h1 data-heading="**Slow_Change**" dir="auto"><strong>Slow_Change</strong></h1>
<p dir="auto"><strong>Purpose</strong>: Run full or filtered synchronizations initiated via UI or scheduled job.<br>
The SlowChange ETL process synchronizes data from multiple source databases to a centralized OMAP DB through a <strong>multi-phase daily</strong> orchestration involving <strong>backup, restore, validation, and synchronization.</strong></p>
<h2 data-heading="**Daily Orchestration Process**" dir="auto"><strong>Daily Orchestration Process</strong></h2>
<p dir="auto">We have two servers in a cluster PGISMSSQLDB01 and PGISMSSQLDB02, only one of them run the whole process and this one is the <strong>current primary</strong> one.</p>
<h3 data-heading="**Phase 1: Database Backup (Step 1)**" dir="auto"><strong>Phase 1: Database Backup (Step 1)</strong></h3>
<p dir="auto"><strong>Purpose:</strong> Create full backups of source databases from remote zones.<br>
Sequential backup jobs extract data from source systems with 15-minute intervals between each database:</p>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">Backup Schedule</div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Job Name</th>
<th>Source Database</th>
<th>Source Server</th>
<th>Start Time (DB01)</th>
<th>Start Time (DB02)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ETLStep1_Backup_SEZAD2016_Full_From_DUQM</td>
<td>SEZAD2016</td>
<td>DUQM</td>
<td>12:00 AM</td>
<td>1:00 AM</td>
</tr>
<tr>
<td>ETLStep1_Backup_SIPCGISUP_Full_From_Sohar</td>
<td>SIPCGISUP</td>
<td>Sohar</td>
<td>12:15 AM</td>
<td>1:15 AM</td>
</tr>
<tr>
<td>ETLStep1_Backup_GISDB_Full_From_Salalah</td>
<td>GISDB</td>
<td>Salalah</td>
<td>12:30 AM</td>
<td>1:30 AM</td>
</tr>
<tr>
<td>ETLStep1_Backup_Madayn_Full_From_Madayn</td>
<td>Madayn</td>
<td>Madayn</td>
<td>12:45 AM</td>
<td>1:45 AM</td>
</tr>
</tbody>
</table>
</div></div>
<p dir="auto"><strong>Prerequisite:</strong> None (initiates daily cycle)</p>
<hr>
<h3 data-heading="**Phase 2: Database Restore (Step 2)**" dir="auto"><strong>Phase 2: Database Restore (Step 2)</strong></h3>
<p dir="auto"><strong>Purpose:</strong> Restore backed-up databases to local ETL server databases.<br>
Sequential restore jobs load backups into local databases with 15-minute intervals:</p>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">Restore Schedule</div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Job Name</th>
<th>Destination Database</th>
<th>Start Time (DB01)</th>
<th>Start Time (DB02)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ETLStep2_Restore_SEZAD2016_Full_From_DUQM</td>
<td>SEZAD2016</td>
<td>1:00 AM</td>
<td>2:00 AM</td>
</tr>
<tr>
<td>ETLStep2_Restore_SIPCGISUP_Full_From_Sohar</td>
<td>SIPCGISUP</td>
<td>1:15 AM</td>
<td>2:15 AM</td>
</tr>
<tr>
<td>ETLStep2_Restore_GISDB_Full_From_Salalah</td>
<td>SALALAH_GISDB</td>
<td>1:30 AM</td>
<td>2:30 AM</td>
</tr>
<tr>
<td>ETLStep2_Restore_Madayn_Full_From_Madayn</td>
<td>Madayn</td>
<td>1:45 AM</td>
<td>2:45 AM</td>
</tr>
</tbody>
</table>
</div></div>
<p dir="auto"><strong>Prerequisite:</strong> Completion of corresponding backup jobs.</p>
<hr>
<h3 data-heading="**Phase 3: Restore Validation &amp; View Creation (Step 3)**" dir="auto"><strong>Phase 3: Restore Validation &amp; View Creation (Step 3)</strong></h3>
<p dir="auto"><strong>Purpose:</strong> Verify restore integrity and prepare versioned database views.</p>
<h4 data-heading="**3A. Restore Status Check**" dir="auto"><strong>3A. Restore Status Check</strong></h4>
<ul>
<li dir="auto"><strong>Job:</strong> <code>ETLStep3_Restore_Status_Check</code></li>
<li dir="auto"><strong>Procedure:</strong> <code>SP_ETL_SC_Check_Restore_Status</code></li>
<li dir="auto"><strong>Start Time:</strong> 2:00 AM (DB01) / 3:00 AM (DB02)</li>
<li dir="auto"><strong>Validation Logic:</strong>
<ul>
<li dir="auto">Checks for presence of a dump table in each restored database</li>
<li dir="auto"><strong>Success:</strong> Dump table does not exist → inserts dump table marker</li>
<li dir="auto"><strong>Failure:</strong> Dump table exists → restore failed or incomplete</li>
</ul>
</li>
</ul>
<h4 data-heading="**3B. Versioned View Creation**" dir="auto"><strong>3B. Versioned View Creation</strong></h4>
<ul>
<li dir="auto"><strong>Task:</strong> Windows Scheduled Task - "Run ArcGIS Create Versioned Views on Restored Databases From Zones"</li>
<li dir="auto"><strong>Script:</strong> <code>run_arcgis_CreateVersionedView.bat</code></li>
<li dir="auto"><strong>Start Time:</strong> 2:00 AM (DB01) / 3:00 AM (DB02)</li>
<li dir="auto"><strong>Purpose:</strong> Creates versioned views for tables with versioning or archiving enabled</li>
<li dir="auto"><strong>Note:</strong> Runs concurrently with restore status check (not dependent)</li>
</ul>
<p dir="auto"><strong>Prerequisite:</strong> Completion of all restore jobs</p>
<hr>
<h3 data-heading="**Phase 4: Full Synchronization (Step 4)**" dir="auto"><strong>Phase 4: Full Synchronization (Step 4)</strong></h3>
<p dir="auto"><strong>Purpose:</strong> Execute full SlowChange sync from restored databases to OMAP destination entities.<br>
Sequential sync jobs run with 30-minute intervals between databases:</p>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">Full Sync Schedule</div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Job Name</th>
<th>Source Database</th>
<th>Start Time (DB01)</th>
<th>Start Time (DB02)</th>
</tr>
</thead>
<tbody>
<tr>
<td>ETLStep4_Run_SEZAD2016_FULL_SC_Sync_Job</td>
<td>SEZAD2016</td>
<td>3:00 AM</td>
<td>4:00 AM</td>
</tr>
<tr>
<td>ETLStep4_Run_SIPCGISUP_FULL_SC_Sync_Job</td>
<td>SIPCGISUP</td>
<td>3:30 AM</td>
<td>4:30 AM</td>
</tr>
<tr>
<td>ETLStep4_Run_GISDB_FULL_SC_Sync_Job</td>
<td>SALALAH_GISDB</td>
<td>4:00 AM</td>
<td>5:00 AM</td>
</tr>
<tr>
<td>ETLStep4_Run_Madayn_FULL_SC_Sync_Job</td>
<td>Madayn</td>
<td>4:30 AM</td>
<td>5:30 AM</td>
</tr>
<tr>
<td>ETLStep4_Run_Khazaen_FULL_SC_Sync_Job</td>
<td>Khazaen</td>
<td>5:00 AM</td>
<td>6:00 AM</td>
</tr>
<tr>
<td>ETLStep4_Run_MuscatAirport_FULL_SC_Sync_Job</td>
<td>MuscatAirport</td>
<td>5:30 AM</td>
<td>6:30 AM</td>
</tr>
</tbody>
</table>
</div></div>
<p dir="auto"><strong>Prerequisite:</strong> Successful completion of restore validation (Step 3)</p>
<hr>
<h2 data-heading="**Process Flow Diagram**" dir="auto"><strong>Process Flow Diagram</strong></h2>
<div class="mermaid"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 671.359375 2659.828125" height="2659.828125" class="flowchart" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="671.359375" id="mee96ae5cca4be2d8"><style>#mee96ae5cca4be2d8{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#mee96ae5cca4be2d8 .error-icon{fill:#552222;}#mee96ae5cca4be2d8 .error-text{fill:#552222;stroke:#552222;}#mee96ae5cca4be2d8 .edge-thickness-normal{stroke-width:1px;}#mee96ae5cca4be2d8 .edge-thickness-thick{stroke-width:3.5px;}#mee96ae5cca4be2d8 .edge-pattern-solid{stroke-dasharray:0;}#mee96ae5cca4be2d8 .edge-thickness-invisible{stroke-width:0;fill:none;}#mee96ae5cca4be2d8 .edge-pattern-dashed{stroke-dasharray:3;}#mee96ae5cca4be2d8 .edge-pattern-dotted{stroke-dasharray:2;}#mee96ae5cca4be2d8 .marker{fill:#333333;stroke:#333333;}#mee96ae5cca4be2d8 .marker.cross{stroke:#333333;}#mee96ae5cca4be2d8 svg{font-family:var(--font-mermaid);font-size:16px;}#mee96ae5cca4be2d8 p{margin:0;}#mee96ae5cca4be2d8 .label{font-family:var(--font-mermaid);color:#333;}#mee96ae5cca4be2d8 .cluster-label text{fill:#333;}#mee96ae5cca4be2d8 .cluster-label span{color:#333;}#mee96ae5cca4be2d8 .cluster-label span p{background-color:transparent;}#mee96ae5cca4be2d8 .label text,#mee96ae5cca4be2d8 span{fill:#333;color:#333;}#mee96ae5cca4be2d8 .node rect,#mee96ae5cca4be2d8 .node circle,#mee96ae5cca4be2d8 .node ellipse,#mee96ae5cca4be2d8 .node polygon,#mee96ae5cca4be2d8 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mee96ae5cca4be2d8 .rough-node .label text,#mee96ae5cca4be2d8 .node .label text,#mee96ae5cca4be2d8 .image-shape .label,#mee96ae5cca4be2d8 .icon-shape .label{text-anchor:middle;}#mee96ae5cca4be2d8 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mee96ae5cca4be2d8 .rough-node .label,#mee96ae5cca4be2d8 .node .label,#mee96ae5cca4be2d8 .image-shape .label,#mee96ae5cca4be2d8 .icon-shape .label{text-align:center;}#mee96ae5cca4be2d8 .node.clickable{cursor:pointer;}#mee96ae5cca4be2d8 .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#mee96ae5cca4be2d8 .arrowheadPath{fill:#333333;}#mee96ae5cca4be2d8 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mee96ae5cca4be2d8 .flowchart-link{stroke:#333333;fill:none;}#mee96ae5cca4be2d8 .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#mee96ae5cca4be2d8 .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#mee96ae5cca4be2d8 .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mee96ae5cca4be2d8 .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#mee96ae5cca4be2d8 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mee96ae5cca4be2d8 .cluster text{fill:#333;}#mee96ae5cca4be2d8 .cluster span{color:#333;}#mee96ae5cca4be2d8 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mee96ae5cca4be2d8 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mee96ae5cca4be2d8 rect.text{fill:none;stroke-width:0;}#mee96ae5cca4be2d8 .icon-shape,#mee96ae5cca4be2d8 .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#mee96ae5cca4be2d8 .icon-shape p,#mee96ae5cca4be2d8 .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#mee96ae5cca4be2d8 .icon-shape rect,#mee96ae5cca4be2d8 .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#mee96ae5cca4be2d8 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Start_Backup1_0" d="M330.113,95L330.113,99.167C330.113,103.333,330.113,111.667,330.113,119.333C330.113,127,330.113,134,330.113,137.5L330.113,141"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Backup1_Backup2_1" d="M330.113,223L330.113,229.167C330.113,235.333,330.113,247.667,330.113,259.333C330.113,271,330.113,282,330.113,287.5L330.113,293"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Backup2_Backup3_2" d="M330.113,375L330.113,381.167C330.113,387.333,330.113,399.667,330.113,411.333C330.113,423,330.113,434,330.113,439.5L330.113,445"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Backup3_Backup4_3" d="M330.113,527L330.113,533.167C330.113,539.333,330.113,551.667,330.113,563.333C330.113,575,330.113,586,330.113,591.5L330.113,597"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Backup4_Restore1_4" d="M330.113,679L330.113,683.167C330.113,687.333,330.113,695.667,330.113,703.333C330.113,711,330.113,718,330.113,721.5L330.113,725"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Restore1_Restore2_5" d="M330.113,807L330.113,813.167C330.113,819.333,330.113,831.667,330.113,843.333C330.113,855,330.113,866,330.113,871.5L330.113,877"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Restore2_Restore3_6" d="M330.113,959L330.113,965.167C330.113,971.333,330.113,983.667,330.113,995.333C330.113,1007,330.113,1018,330.113,1023.5L330.113,1029"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Restore3_Restore4_7" d="M330.113,1111L330.113,1117.167C330.113,1123.333,330.113,1135.667,330.113,1147.333C330.113,1159,330.113,1170,330.113,1175.5L330.113,1181"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Restore4_Phase3_8" d="M330.113,1263L330.113,1267.167C330.113,1271.333,330.113,1279.667,330.184,1287.417C330.254,1295.167,330.394,1302.334,330.465,1305.917L330.535,1309.501"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Phase3_Check_9" d="M270.204,1462.919L250.799,1477.071C231.394,1491.222,192.584,1519.525,173.179,1539.177C153.773,1558.828,153.773,1569.828,153.773,1575.328L153.773,1580.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Phase3_Views_10" d="M391.022,1462.919L410.261,1477.071C429.499,1491.222,467.976,1519.525,487.215,1537.177C506.453,1554.828,506.453,1561.828,506.453,1565.328L506.453,1568.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Check_Sync1_11" d="M153.773,1662.828L153.773,1668.995C153.773,1675.161,153.773,1687.495,164.627,1697.601C175.481,1707.707,197.189,1715.585,208.042,1719.524L218.896,1723.463"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Views_Sync1_12" d="M506.453,1674.828L506.453,1678.995C506.453,1683.161,506.453,1691.495,495.599,1699.601C484.746,1707.707,463.038,1715.585,452.184,1719.524L441.33,1723.463"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Sync1_Sync2_13" d="M330.113,1802.828L330.113,1808.995C330.113,1815.161,330.113,1827.495,330.113,1839.161C330.113,1850.828,330.113,1861.828,330.113,1867.328L330.113,1872.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Sync2_Sync3_14" d="M330.113,1954.828L330.113,1960.995C330.113,1967.161,330.113,1979.495,330.113,1991.161C330.113,2002.828,330.113,2013.828,330.113,2019.328L330.113,2024.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Sync3_Sync4_15" d="M330.113,2106.828L330.113,2112.995C330.113,2119.161,330.113,2131.495,330.113,2143.161C330.113,2154.828,330.113,2165.828,330.113,2171.328L330.113,2176.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Sync4_Sync5_16" d="M330.113,2258.828L330.113,2264.995C330.113,2271.161,330.113,2283.495,330.113,2295.161C330.113,2306.828,330.113,2317.828,330.113,2323.328L330.113,2328.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Sync5_Sync6_17" d="M330.113,2410.828L330.113,2416.995C330.113,2423.161,330.113,2435.495,330.113,2447.161C330.113,2458.828,330.113,2469.828,330.113,2475.328L330.113,2480.828"></path><path marker-end="url(#mee96ae5cca4be2d8-mee96ae5cca4be2d8_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Sync6_Complete_18" d="M330.113,2562.828L330.113,2566.995C330.113,2571.161,330.113,2579.495,330.113,2587.161C330.113,2594.828,330.113,2601.828,330.113,2605.328L330.113,2608.828"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(330.11328125, 260)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+15 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 412)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+15 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 564)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+15 min</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(330.11328125, 844)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+15 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 996)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+15 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1148)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+15 min</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1839.828125)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+30 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1991.828125)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+30 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2143.828125)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+30 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2295.828125)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+30 min</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2447.828125)" class="edgeLabel"><g transform="translate(-29.6484375, -12)" class="label"><foreignObject height="24" width="59.296875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>+30 min</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(330.11328125, 51.5)" id="flowchart-Start-319" class="node default"><rect height="87" width="236.75" y="-43.5" x="-118.375" ry="43.5" rx="43.5" style="fill:#e1f5e1 !important" class="basic label-container"></rect><g transform="translate(-100, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Daily ETL Cycle Start<br>12:00 AM DB01 / 1:00 AM DB02</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 184)" id="flowchart-Backup1-320" class="node default"><rect height="78" width="269.96875" y="-39" x="-134.984375" style="" class="basic label-container"></rect><g transform="translate(-104.984375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="209.96875"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep1_Backup_SEZAD2016<br>12:00 AM / 1:00 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 336)" id="flowchart-Backup2-322" class="node default"><rect height="78" width="263.09375" y="-39" x="-131.546875" style="" class="basic label-container"></rect><g transform="translate(-101.546875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="203.09375"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep1_Backup_SIPCGISUP<br>12:15 AM / 1:15 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 488)" id="flowchart-Backup3-324" class="node default"><rect height="78" width="232.34375" y="-39" x="-116.171875" style="" class="basic label-container"></rect><g transform="translate(-86.171875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="172.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep1_Backup_GISDB<br>12:30 AM / 1:30 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 640)" id="flowchart-Backup4-326" class="node default"><rect height="78" width="245.078125" y="-39" x="-122.5390625" style="" class="basic label-container"></rect><g transform="translate(-92.5390625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="185.078125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep1_Backup_Madayn<br>12:45 AM / 1:45 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 768)" id="flowchart-Restore1-328" class="node default"><rect height="78" width="271.84375" y="-39" x="-135.921875" style="" class="basic label-container"></rect><g transform="translate(-105.921875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="211.84375"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep2_Restore_SEZAD2016<br>1:00 AM / 2:00 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 920)" id="flowchart-Restore2-330" class="node default"><rect height="78" width="264.96875" y="-39" x="-132.484375" style="" class="basic label-container"></rect><g transform="translate(-102.484375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="204.96875"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep2_Restore_SIPCGISUP<br>1:15 AM / 2:15 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1072)" id="flowchart-Restore3-332" class="node default"><rect height="78" width="234.203125" y="-39" x="-117.1015625" style="" class="basic label-container"></rect><g transform="translate(-87.1015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="174.203125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep2_Restore_GISDB<br>1:30 AM / 2:30 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1224)" id="flowchart-Restore4-334" class="node default"><rect height="78" width="246.953125" y="-39" x="-123.4765625" style="" class="basic label-container"></rect><g transform="translate(-93.4765625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="186.953125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep2_Restore_Madayn<br>1:45 AM / 2:45 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1417.9140625)" id="flowchart-Phase3-336" class="node default"><polygon style="fill:#fff4e1 !important" transform="translate(-104.9140625,104.9140625)" class="label-container" points="104.9140625,0 209.828125,-104.9140625 104.9140625,-209.828125 0,-104.9140625"></polygon><g transform="translate(-65.9140625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="131.828125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Phase 3<br>2:00 AM / 3:00 AM</p></span></div></foreignObject></g></g><g transform="translate(153.7734375, 1623.828125)" id="flowchart-Check-338" class="node default"><rect height="78" width="291.546875" y="-39" x="-145.7734375" style="" class="basic label-container"></rect><g transform="translate(-115.7734375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="231.546875"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep3_Restore_Status_Check<br>SP_ETL_SC_Check_Restore_Status</p></span></div></foreignObject></g></g><g transform="translate(506.453125, 1623.828125)" id="flowchart-Views-340" class="node default"><rect height="102" width="313.8125" y="-51" x="-156.90625" style="" class="basic label-container"></rect><g transform="translate(-126.90625, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="253.8125"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Windows Task: Create Versioned Views<br>run_arcgis_CreateVersionedView.bat</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1763.828125)" id="flowchart-Sync1-342" class="node default"><rect height="78" width="382.078125" y="-39" x="-191.0390625" style="" class="basic label-container"></rect><g transform="translate(-161.0390625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="322.078125"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep4_Run_SEZAD2016_FULL_SC_Sync_Job<br>3:00 AM / 4:00 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 1915.828125)" id="flowchart-Sync2-346" class="node default"><rect height="78" width="375.203125" y="-39" x="-187.6015625" style="" class="basic label-container"></rect><g transform="translate(-157.6015625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="315.203125"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep4_Run_SIPCGISUP_FULL_SC_Sync_Job<br>3:30 AM / 4:30 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2067.828125)" id="flowchart-Sync3-348" class="node default"><rect height="78" width="344.453125" y="-39" x="-172.2265625" style="" class="basic label-container"></rect><g transform="translate(-142.2265625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="284.453125"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep4_Run_GISDB_FULL_SC_Sync_Job<br>4:00 AM / 5:00 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2219.828125)" id="flowchart-Sync4-350" class="node default"><rect height="78" width="357.1875" y="-39" x="-178.59375" style="" class="basic label-container"></rect><g transform="translate(-148.59375, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="297.1875"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep4_Run_Madayn_FULL_SC_Sync_Job<br>4:30 AM / 5:30 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2371.828125)" id="flowchart-Sync5-352" class="node default"><rect height="78" width="359.59375" y="-39" x="-179.796875" style="" class="basic label-container"></rect><g transform="translate(-149.796875, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="299.59375"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep4_Run_Khazaen_FULL_SC_Sync_Job<br>5:00 AM / 6:00 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2523.828125)" id="flowchart-Sync6-354" class="node default"><rect height="78" width="401.015625" y="-39" x="-200.5078125" style="" class="basic label-container"></rect><g transform="translate(-170.5078125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="341.015625"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>ETLStep4_Run_MuscatAirport_FULL_SC_Sync_Job<br>5:30 AM / 6:30 AM</p></span></div></foreignObject></g></g><g transform="translate(330.11328125, 2632.328125)" id="flowchart-Complete-356" class="node default"><rect height="39" width="174.15625" y="-19.5" x="-87.078125" ry="19.5" rx="19.5" style="fill:#e1f5e1 !important" class="basic label-container"></rect><g transform="translate(-74.703125, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="149.40625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Daily Cycle Complete</p></span></div></foreignObject></g></g></g></g></g>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div>
<hr>
<h2 data-heading="**Slow Change Sync Execution (Phase 4 Detail)**" dir="auto"><strong>Slow Change Sync Execution (Phase 4 Detail)</strong></h2>
<h3 data-heading="**Initiation &amp; orchestration**:" dir="auto"><strong>Initiation &amp; orchestration</strong>:</h3>
<ul>
<li dir="auto"><strong>Job Insertion:</strong> Scheduled Step 4 jobs or ETL_tool User insert a row into <code>OMAP_ETL.dbo.ETL_Jobs</code>
<ul>
<li dir="auto">Fields: <code>DestEntity</code>, <code>SourceDB</code>, <code>SourceEntityGroup</code> (all optional; unspecified = full sync)</li>
</ul>
</li>
<li dir="auto"><strong>Trigger Activation:</strong> <code>TRGR_ETL_JOBS_After_Insert</code> fires and starts SQL Agent job <code>ETL_SC_RUN_NotExecuted_Job</code>
<ul>
<li dir="auto">This decouples the trigger transaction from dynamic SQL execution</li>
</ul>
</li>
<li dir="auto"><strong>Job Execution:</strong> <code>ETL_SC_RUN_NotExecuted_Job</code> picks the not-executed job and calls <code>SP_ETL_SC_Run_Job</code></li>
<li dir="auto"><strong>Entity Processing:</strong> <code>SP_ETL_SC_Run_Job</code> calls <code>SP_ETL_SC_Prepare_Job</code>, then loops over distinct mapping combinations and calls <code>SP_ETL_SC_Sync_Entity</code> for each</li>
</ul>
<div class="mermaid"><svg aria-roledescription="sequence" role="graphics-document document" viewBox="-50 -10 2215.5 798" height="798" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="2215.5" id="mbd065a264df9cf97"><g><rect class="actor actor-bottom" ry="3" rx="3" name="Sync" height="65" width="179" stroke="#666" fill="#eaeaea" y="712" x="1936.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="2026"><tspan dy="0" x="2026">SP_ETL_SC_Sync_Entity</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Prep" height="65" width="185" stroke="#666" fill="#eaeaea" y="712" x="1701.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="1794"><tspan dy="0" x="1794">SP_ETL_SC_Prepare_Job</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Runner" height="65" width="159" stroke="#666" fill="#eaeaea" y="712" x="1449.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="1529"><tspan dy="0" x="1529">SP_ETL_SC_Run_Job</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="Agent" height="65" width="150" stroke="#666" fill="#eaeaea" y="712" x="1213"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="1288"><tspan dy="0" x="1288">SQL Agent Job</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="TR" height="65" width="150" stroke="#666" fill="#eaeaea" y="712" x="832"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="907"><tspan dy="0" x="907">Trigger</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="DB" height="65" width="150" stroke="#666" fill="#eaeaea" y="712" x="529"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="604"><tspan dy="0" x="604">OMAP_ETL DB</tspan></text></g><g><rect class="actor actor-bottom" ry="3" rx="3" name="UI" height="65" width="150" stroke="#666" fill="#eaeaea" y="712" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="744.5" x="75"><tspan dy="0" x="75">ETL UI / User</tspan></text></g><g><line name="Sync" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="2026" y1="65" x1="2026" id="actor114"></line><g id="root-114"><rect class="actor actor-top" ry="3" rx="3" name="Sync" height="65" width="179" stroke="#666" fill="#eaeaea" y="0" x="1936.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="2026"><tspan dy="0" x="2026">SP_ETL_SC_Sync_Entity</tspan></text></g></g><g><line name="Prep" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="1794" y1="65" x1="1794" id="actor113"></line><g id="root-113"><rect class="actor actor-top" ry="3" rx="3" name="Prep" height="65" width="185" stroke="#666" fill="#eaeaea" y="0" x="1701.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="1794"><tspan dy="0" x="1794">SP_ETL_SC_Prepare_Job</tspan></text></g></g><g><line name="Runner" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="1529" y1="65" x1="1529" id="actor112"></line><g id="root-112"><rect class="actor actor-top" ry="3" rx="3" name="Runner" height="65" width="159" stroke="#666" fill="#eaeaea" y="0" x="1449.5"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="1529"><tspan dy="0" x="1529">SP_ETL_SC_Run_Job</tspan></text></g></g><g><line name="Agent" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="1288" y1="65" x1="1288" id="actor111"></line><g id="root-111"><rect class="actor actor-top" ry="3" rx="3" name="Agent" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="1213"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="1288"><tspan dy="0" x="1288">SQL Agent Job</tspan></text></g></g><g><line name="TR" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="907" y1="65" x1="907" id="actor110"></line><g id="root-110"><rect class="actor actor-top" ry="3" rx="3" name="TR" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="832"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="907"><tspan dy="0" x="907">Trigger</tspan></text></g></g><g><line name="DB" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="604" y1="65" x1="604" id="actor109"></line><g id="root-109"><rect class="actor actor-top" ry="3" rx="3" name="DB" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="529"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="604"><tspan dy="0" x="604">OMAP_ETL DB</tspan></text></g></g><g><line name="UI" stroke="#999" stroke-width="0.5px" class="actor-line 200" y2="712" x2="75" y1="65" x1="75" id="actor108"></line><g id="root-108"><rect class="actor actor-top" ry="3" rx="3" name="UI" height="65" width="150" stroke="#666" fill="#eaeaea" y="0" x="0"></rect><text style="text-anchor: middle; font-size: 16px; font-weight: 400;" class="actor actor-box" alignment-baseline="central" dominant-baseline="central" y="32.5" x="75"><tspan dy="0" x="75">ETL UI / User</tspan></text></g></g><style>#mbd065a264df9cf97{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#mbd065a264df9cf97 .error-icon{fill:#552222;}#mbd065a264df9cf97 .error-text{fill:#552222;stroke:#552222;}#mbd065a264df9cf97 .edge-thickness-normal{stroke-width:1px;}#mbd065a264df9cf97 .edge-thickness-thick{stroke-width:3.5px;}#mbd065a264df9cf97 .edge-pattern-solid{stroke-dasharray:0;}#mbd065a264df9cf97 .edge-thickness-invisible{stroke-width:0;fill:none;}#mbd065a264df9cf97 .edge-pattern-dashed{stroke-dasharray:3;}#mbd065a264df9cf97 .edge-pattern-dotted{stroke-dasharray:2;}#mbd065a264df9cf97 .marker{fill:#333333;stroke:#333333;}#mbd065a264df9cf97 .marker.cross{stroke:#333333;}#mbd065a264df9cf97 svg{font-family:var(--font-mermaid);font-size:16px;}#mbd065a264df9cf97 p{margin:0;}#mbd065a264df9cf97 .actor{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mbd065a264df9cf97 text.actor&gt;tspan{fill:black;stroke:none;}#mbd065a264df9cf97 .actor-line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mbd065a264df9cf97 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:#333;}#mbd065a264df9cf97 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:#333;}#mbd065a264df9cf97 #mbd065a264df9cf97-arrowhead path{fill:#333;stroke:#333;}#mbd065a264df9cf97 .sequenceNumber{fill:white;}#mbd065a264df9cf97 #mbd065a264df9cf97-sequencenumber{fill:#333;}#mbd065a264df9cf97 #mbd065a264df9cf97-crosshead path{fill:#333;stroke:#333;}#mbd065a264df9cf97 .messageText{fill:#333;stroke:none;}#mbd065a264df9cf97 .labelBox{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mbd065a264df9cf97 .labelText,#mbd065a264df9cf97 .labelText&gt;tspan{fill:black;stroke:none;}#mbd065a264df9cf97 .loopText,#mbd065a264df9cf97 .loopText&gt;tspan{fill:black;stroke:none;}#mbd065a264df9cf97 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);}#mbd065a264df9cf97 .note{stroke:#aaaa33;fill:#fff5ad;}#mbd065a264df9cf97 .noteText,#mbd065a264df9cf97 .noteText&gt;tspan{fill:black;stroke:none;}#mbd065a264df9cf97 .activation0{fill:#f4f4f4;stroke:#666;}#mbd065a264df9cf97 .activation1{fill:#f4f4f4;stroke:#666;}#mbd065a264df9cf97 .activation2{fill:#f4f4f4;stroke:#666;}#mbd065a264df9cf97 .actorPopupMenu{position:absolute;}#mbd065a264df9cf97 .actorPopupMenuPanel{position:absolute;fill:#ECECFF;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mbd065a264df9cf97 .actor-man line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;}#mbd065a264df9cf97 .actor-man circle,#mbd065a264df9cf97 line{stroke:hsl(259.6261682243, 59.7765363128%, 87.9019607843%);fill:#ECECFF;stroke-width:2px;}#mbd065a264df9cf97 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style><g></g><defs><symbol height="24" width="24" id="computer"><path d="M2 2v13h20v-13h-20zm18 11h-16v-9h16v9zm-10.228 6l.466-1h3.524l.467 1h-4.457zm14.228 3h-24l2-6h2.104l-1.33 4h18.45l-1.297-4h2.073l2 6zm-5-10h-14v-7h14v7z" transform="scale(.5)"></path></symbol></defs><defs><symbol clip-rule="evenodd" fill-rule="evenodd" id="database"><path d="M12.258.001l.256.004.255.005.253.008.251.01.249.012.247.015.246.016.242.019.241.02.239.023.236.024.233.027.231.028.229.031.225.032.223.034.22.036.217.038.214.04.211.041.208.043.205.045.201.046.198.048.194.05.191.051.187.053.183.054.18.056.175.057.172.059.168.06.163.061.16.063.155.064.15.066.074.033.073.033.071.034.07.034.069.035.068.035.067.035.066.035.064.036.064.036.062.036.06.036.06.037.058.037.058.037.055.038.055.038.053.038.052.038.051.039.05.039.048.039.047.039.045.04.044.04.043.04.041.04.04.041.039.041.037.041.036.041.034.041.033.042.032.042.03.042.029.042.027.042.026.043.024.043.023.043.021.043.02.043.018.044.017.043.015.044.013.044.012.044.011.045.009.044.007.045.006.045.004.045.002.045.001.045v17l-.001.045-.002.045-.004.045-.006.045-.007.045-.009.044-.011.045-.012.044-.013.044-.015.044-.017.043-.018.044-.02.043-.021.043-.023.043-.024.043-.026.043-.027.042-.029.042-.03.042-.032.042-.033.042-.034.041-.036.041-.037.041-.039.041-.04.041-.041.04-.043.04-.044.04-.045.04-.047.039-.048.039-.05.039-.051.039-.052.038-.053.038-.055.038-.055.038-.058.037-.058.037-.06.037-.06.036-.062.036-.064.036-.064.036-.066.035-.067.035-.068.035-.069.035-.07.034-.071.034-.073.033-.074.033-.15.066-.155.064-.16.063-.163.061-.168.06-.172.059-.175.057-.18.056-.183.054-.187.053-.191.051-.194.05-.198.048-.201.046-.205.045-.208.043-.211.041-.214.04-.217.038-.22.036-.223.034-.225.032-.229.031-.231.028-.233.027-.236.024-.239.023-.241.02-.242.019-.246.016-.247.015-.249.012-.251.01-.253.008-.255.005-.256.004-.258.001-.258-.001-.256-.004-.255-.005-.253-.008-.251-.01-.249-.012-.247-.015-.245-.016-.243-.019-.241-.02-.238-.023-.236-.024-.234-.027-.231-.028-.228-.031-.226-.032-.223-.034-.22-.036-.217-.038-.214-.04-.211-.041-.208-.043-.204-.045-.201-.046-.198-.048-.195-.05-.19-.051-.187-.053-.184-.054-.179-.056-.176-.057-.172-.059-.167-.06-.164-.061-.159-.063-.155-.064-.151-.066-.074-.033-.072-.033-.072-.034-.07-.034-.069-.035-.068-.035-.067-.035-.066-.035-.064-.036-.063-.036-.062-.036-.061-.036-.06-.037-.058-.037-.057-.037-.056-.038-.055-.038-.053-.038-.052-.038-.051-.039-.049-.039-.049-.039-.046-.039-.046-.04-.044-.04-.043-.04-.041-.04-.04-.041-.039-.041-.037-.041-.036-.041-.034-.041-.033-.042-.032-.042-.03-.042-.029-.042-.027-.042-.026-.043-.024-.043-.023-.043-.021-.043-.02-.043-.018-.044-.017-.043-.015-.044-.013-.044-.012-.044-.011-.045-.009-.044-.007-.045-.006-.045-.004-.045-.002-.045-.001-.045v-17l.001-.045.002-.045.004-.045.006-.045.007-.045.009-.044.011-.045.012-.044.013-.044.015-.044.017-.043.018-.044.02-.043.021-.043.023-.043.024-.043.026-.043.027-.042.029-.042.03-.042.032-.042.033-.042.034-.041.036-.041.037-.041.039-.041.04-.041.041-.04.043-.04.044-.04.046-.04.046-.039.049-.039.049-.039.051-.039.052-.038.053-.038.055-.038.056-.038.057-.037.058-.037.06-.037.061-.036.062-.036.063-.036.064-.036.066-.035.067-.035.068-.035.069-.035.07-.034.072-.034.072-.033.074-.033.151-.066.155-.064.159-.063.164-.061.167-.06.172-.059.176-.057.179-.056.184-.054.187-.053.19-.051.195-.05.198-.048.201-.046.204-.045.208-.043.211-.041.214-.04.217-.038.22-.036.223-.034.226-.032.228-.031.231-.028.234-.027.236-.024.238-.023.241-.02.243-.019.245-.016.247-.015.249-.012.251-.01.253-.008.255-.005.256-.004.258-.001.258.001zm-9.258 20.499v.01l.001.021.003.021.004.022.005.021.006.022.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.023.018.024.019.024.021.024.022.025.023.024.024.025.052.049.056.05.061.051.066.051.07.051.075.051.079.052.084.052.088.052.092.052.097.052.102.051.105.052.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.048.144.049.147.047.152.047.155.047.16.045.163.045.167.043.171.043.176.041.178.041.183.039.187.039.19.037.194.035.197.035.202.033.204.031.209.03.212.029.216.027.219.025.222.024.226.021.23.02.233.018.236.016.24.015.243.012.246.01.249.008.253.005.256.004.259.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.021.224-.024.22-.026.216-.027.212-.028.21-.031.205-.031.202-.034.198-.034.194-.036.191-.037.187-.039.183-.04.179-.04.175-.042.172-.043.168-.044.163-.045.16-.046.155-.046.152-.047.148-.048.143-.049.139-.049.136-.05.131-.05.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.053.083-.051.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.05.023-.024.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.023.01-.022.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.127l-.077.055-.08.053-.083.054-.085.053-.087.052-.09.052-.093.051-.095.05-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.045-.118.044-.12.043-.122.042-.124.042-.126.041-.128.04-.13.04-.132.038-.134.038-.135.037-.138.037-.139.035-.142.035-.143.034-.144.033-.147.032-.148.031-.15.03-.151.03-.153.029-.154.027-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.01-.179.008-.179.008-.181.006-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.006-.179-.008-.179-.008-.178-.01-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.027-.153-.029-.151-.03-.15-.03-.148-.031-.146-.032-.145-.033-.143-.034-.141-.035-.14-.035-.137-.037-.136-.037-.134-.038-.132-.038-.13-.04-.128-.04-.126-.041-.124-.042-.122-.042-.12-.044-.117-.043-.116-.045-.113-.045-.112-.046-.109-.047-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.05-.093-.052-.09-.051-.087-.052-.085-.053-.083-.054-.08-.054-.077-.054v4.127zm0-5.654v.011l.001.021.003.021.004.021.005.022.006.022.007.022.009.022.01.022.011.023.012.023.013.023.015.024.016.023.017.024.018.024.019.024.021.024.022.024.023.025.024.024.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.052.11.051.114.051.119.052.123.05.127.051.131.05.135.049.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.044.171.042.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.022.23.02.233.018.236.016.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.012.241-.015.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.048.139-.05.136-.049.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.051.051-.049.023-.025.023-.024.021-.025.02-.024.019-.024.018-.024.017-.024.015-.023.014-.023.013-.024.012-.022.01-.023.01-.023.008-.022.006-.022.006-.022.004-.021.004-.022.001-.021.001-.021v-4.139l-.077.054-.08.054-.083.054-.085.052-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.049-.105.048-.106.047-.109.047-.111.046-.114.045-.115.044-.118.044-.12.044-.122.042-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.035-.143.033-.144.033-.147.033-.148.031-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.025-.161.024-.162.023-.163.022-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.011-.178.009-.179.009-.179.007-.181.007-.182.005-.182.004-.184.003-.184.002h-.37l-.184-.002-.184-.003-.182-.004-.182-.005-.181-.007-.179-.007-.179-.009-.178-.009-.176-.011-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.022-.162-.023-.161-.024-.159-.025-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.031-.146-.033-.145-.033-.143-.033-.141-.035-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.04-.126-.041-.124-.042-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.047-.105-.048-.102-.049-.1-.049-.097-.05-.095-.051-.093-.051-.09-.051-.087-.053-.085-.052-.083-.054-.08-.054-.077-.054v4.139zm0-5.666v.011l.001.02.003.022.004.021.005.022.006.021.007.022.009.023.01.022.011.023.012.023.013.023.015.023.016.024.017.024.018.023.019.024.021.025.022.024.023.024.024.025.052.05.056.05.061.05.066.051.07.051.075.052.079.051.084.052.088.052.092.052.097.052.102.052.105.051.11.052.114.051.119.051.123.051.127.05.131.05.135.05.139.049.144.048.147.048.152.047.155.046.16.045.163.045.167.043.171.043.176.042.178.04.183.04.187.038.19.037.194.036.197.034.202.033.204.032.209.03.212.028.216.027.219.025.222.024.226.021.23.02.233.018.236.017.24.014.243.012.246.01.249.008.253.006.256.003.259.001.26-.001.257-.003.254-.006.25-.008.247-.01.244-.013.241-.014.237-.016.233-.018.231-.02.226-.022.224-.024.22-.025.216-.027.212-.029.21-.03.205-.032.202-.033.198-.035.194-.036.191-.037.187-.039.183-.039.179-.041.175-.042.172-.043.168-.044.163-.045.16-.045.155-.047.152-.047.148-.048.143-.049.139-.049.136-.049.131-.051.126-.05.123-.051.118-.052.114-.051.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.052.07-.051.065-.051.06-.051.056-.05.051-.049.023-.025.023-.025.021-.024.02-.024.019-.024.018-.024.017-.024.015-.023.014-.024.013-.023.012-.023.01-.022.01-.023.008-.022.006-.022.006-.022.004-.022.004-.021.001-.021.001-.021v-4.153l-.077.054-.08.054-.083.053-.085.053-.087.053-.09.051-.093.051-.095.051-.097.05-.1.049-.102.048-.105.048-.106.048-.109.046-.111.046-.114.046-.115.044-.118.044-.12.043-.122.043-.124.042-.126.041-.128.04-.13.039-.132.039-.134.038-.135.037-.138.036-.139.036-.142.034-.143.034-.144.033-.147.032-.148.032-.15.03-.151.03-.153.028-.154.028-.156.027-.158.026-.159.024-.161.024-.162.023-.163.023-.165.021-.166.02-.167.019-.169.018-.169.017-.171.016-.173.015-.173.014-.175.013-.175.012-.177.01-.178.01-.179.009-.179.007-.181.006-.182.006-.182.004-.184.003-.184.001-.185.001-.185-.001-.184-.001-.184-.003-.182-.004-.182-.006-.181-.006-.179-.007-.179-.009-.178-.01-.176-.01-.176-.012-.175-.013-.173-.014-.172-.015-.171-.016-.17-.017-.169-.018-.167-.019-.166-.02-.165-.021-.163-.023-.162-.023-.161-.024-.159-.024-.157-.026-.156-.027-.155-.028-.153-.028-.151-.03-.15-.03-.148-.032-.146-.032-.145-.033-.143-.034-.141-.034-.14-.036-.137-.036-.136-.037-.134-.038-.132-.039-.13-.039-.128-.041-.126-.041-.124-.041-.122-.043-.12-.043-.117-.044-.116-.044-.113-.046-.112-.046-.109-.046-.106-.048-.105-.048-.102-.048-.1-.05-.097-.049-.095-.051-.093-.051-.09-.052-.087-.052-.085-.053-.083-.053-.08-.054-.077-.054v4.153zm8.74-8.179l-.257.004-.254.005-.25.008-.247.011-.244.012-.241.014-.237.016-.233.018-.231.021-.226.022-.224.023-.22.026-.216.027-.212.028-.21.031-.205.032-.202.033-.198.034-.194.036-.191.038-.187.038-.183.04-.179.041-.175.042-.172.043-.168.043-.163.045-.16.046-.155.046-.152.048-.148.048-.143.048-.139.049-.136.05-.131.05-.126.051-.123.051-.118.051-.114.052-.11.052-.106.052-.101.052-.096.052-.092.052-.088.052-.083.052-.079.052-.074.051-.07.052-.065.051-.06.05-.056.05-.051.05-.023.025-.023.024-.021.024-.02.025-.019.024-.018.024-.017.023-.015.024-.014.023-.013.023-.012.023-.01.023-.01.022-.008.022-.006.023-.006.021-.004.022-.004.021-.001.021-.001.021.001.021.001.021.004.021.004.022.006.021.006.023.008.022.01.022.01.023.012.023.013.023.014.023.015.024.017.023.018.024.019.024.02.025.021.024.023.024.023.025.051.05.056.05.06.05.065.051.07.052.074.051.079.052.083.052.088.052.092.052.096.052.101.052.106.052.11.052.114.052.118.051.123.051.126.051.131.05.136.05.139.049.143.048.148.048.152.048.155.046.16.046.163.045.168.043.172.043.175.042.179.041.183.04.187.038.191.038.194.036.198.034.202.033.205.032.21.031.212.028.216.027.22.026.224.023.226.022.231.021.233.018.237.016.241.014.244.012.247.011.25.008.254.005.257.004.26.001.26-.001.257-.004.254-.005.25-.008.247-.011.244-.012.241-.014.237-.016.233-.018.231-.021.226-.022.224-.023.22-.026.216-.027.212-.028.21-.031.205-.032.202-.033.198-.034.194-.036.191-.038.187-.038.183-.04.179-.041.175-.042.172-.043.168-.043.163-.045.16-.046.155-.046.152-.048.148-.048.143-.048.139-.049.136-.05.131-.05.126-.051.123-.051.118-.051.114-.052.11-.052.106-.052.101-.052.096-.052.092-.052.088-.052.083-.052.079-.052.074-.051.07-.052.065-.051.06-.05.056-.05.051-.05.023-.025.023-.024.021-.024.02-.025.019-.024.018-.024.017-.023.015-.024.014-.023.013-.023.012-.023.01-.023.01-.022.008-.022.006-.023.006-.021.004-.022.004-.021.001-.021.001-.021-.001-.021-.001-.021-.004-.021-.004-.022-.006-.021-.006-.023-.008-.022-.01-.022-.01-.023-.012-.023-.013-.023-.014-.023-.015-.024-.017-.023-.018-.024-.019-.024-.02-.025-.021-.024-.023-.024-.023-.025-.051-.05-.056-.05-.06-.05-.065-.051-.07-.052-.074-.051-.079-.052-.083-.052-.088-.052-.092-.052-.096-.052-.101-.052-.106-.052-.11-.052-.114-.052-.118-.051-.123-.051-.126-.051-.131-.05-.136-.05-.139-.049-.143-.048-.148-.048-.152-.048-.155-.046-.16-.046-.163-.045-.168-.043-.172-.043-.175-.042-.179-.041-.183-.04-.187-.038-.191-.038-.194-.036-.198-.034-.202-.033-.205-.032-.21-.031-.212-.028-.216-.027-.22-.026-.224-.023-.226-.022-.231-.021-.233-.018-.237-.016-.241-.014-.244-.012-.247-.011-.25-.008-.254-.005-.257-.004-.26-.001-.26.001z" transform="scale(.5)"></path></symbol></defs><defs><symbol height="24" width="24" id="clock"><path d="M12 2c5.514 0 10 4.486 10 10s-4.486 10-10 10-10-4.486-10-10 4.486-10 10-10zm0-2c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm5.848 12.459c.202.038.202.333.001.372-1.907.361-6.045 1.111-6.547 1.111-.719 0-1.301-.582-1.301-1.301 0-.512.77-5.447 1.125-7.445.034-.192.312-.181.343.014l.985 6.238 5.394 1.011z" transform="scale(.5)"></path></symbol></defs><defs><marker orient="auto-start-reverse" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="7.9" id="mbd065a264df9cf97-arrowhead"><path d="M -1 0 L 10 5 L 0 10 z"></path></marker></defs><defs><marker refY="4.5" refX="4" orient="auto" markerHeight="8" markerWidth="15" id="mbd065a264df9cf97-crosshead"><path style="stroke-dasharray: 0, 0;" d="M 1,2 L 6,7 M 6,2 L 1,7" stroke-width="1pt" stroke="#000000" fill="none"></path></marker></defs><defs><marker orient="auto" markerHeight="28" markerWidth="20" refY="7" refX="15.5" id="mbd065a264df9cf97-filled-head"><path d="M 18,7 L9,13 L14,7 L9,1 Z"></path></marker></defs><defs><marker orient="auto" markerHeight="40" markerWidth="60" refY="15" refX="15" id="mbd065a264df9cf97-sequencenumber"><circle r="6" cy="15" cx="15"></circle></marker></defs><g><rect class="note" height="41" width="253" stroke="#666" fill="#EDF2AE" y="127" x="629"></rect><text style="font-size: 16px; font-weight: 400;" dy="1em" class="noteText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="132" x="756"><tspan x="756">TRGR_ETL_JOBS_After_Insert fires</tspan></text></g><g><line class="loopLine" y2="438" x2="2037" y1="438" x1="593"></line><line class="loopLine" y2="588" x2="2037" y1="438" x1="2037"></line><line class="loopLine" y2="588" x2="2037" y1="588" x1="593"></line><line class="loopLine" y2="588" x2="593" y1="438" x1="593"></line><polygon class="labelBox" points="593,438 643,438 643,451 634.6,458 593,458"></polygon><text style="font-size: 16px; font-weight: 400;" class="labelText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="451" x="618">loop</text><text style="font-size: 16px; font-weight: 400;" class="loopText" text-anchor="middle" y="456" x="1340"><tspan x="1340">[For each mapping combination]</tspan></text></g><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="80" x="338">INSERT INTO ETL_Jobs (DestEntity, SourceDB, SourceEntityGroup)</text><line style="fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="117" x2="600" y1="117" x1="76"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="183" x="754">trigger fires</text><line style="fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="220" x2="903" y1="220" x1="605"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="235" x="1096">sp_start_job 'ETL_SC_RUN_NotExecuted_Job'</text><line style="fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="272" x2="1284" y1="272" x1="908"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="287" x="1407">Run SP_ETL_SC_Run_Job</text><line style="fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="324" x2="1525" y1="324" x1="1289"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="339" x="1660">Call SP_ETL_SC_Prepare_Job</text><line style="fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="376" x2="1790" y1="376" x1="1530"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="391" x="1663">prepare complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="428" x2="1533" y1="428" x1="1793"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="489" x="1776">call SP_ETL_SC_Sync_Entity</text><line style="fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine0" y2="526" x2="2022" y1="526" x1="1530"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="541" x="1317">success / failure logged</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="578" x2="608" y1="578" x1="2025"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="603" x="1410">overall run complete</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="640" x2="1292" y1="640" x1="1528"></line><text style="font-size: 16px; font-weight: 400;" dy="1em" class="messageText" alignment-baseline="middle" dominant-baseline="middle" text-anchor="middle" y="655" x="948">updates ETL_Jobs.IsExecuted</text><line style="stroke-dasharray: 3, 3; fill: none;" marker-end="url(#mbd065a264df9cf97-arrowhead)" stroke="none" stroke-width="2" class="messageLine1" y2="692" x2="608" y1="692" x1="1287"></line>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div>
<h1 data-heading="**Files**" dir="auto"><strong>Files</strong></h1>
<ul>
<li dir="auto"><code>Upload_OMAP_ETL_Mapping_Service.py</code> — GP (Geoprocessing) tool that extracts mapping Excel to temp gdb and uploads raw tables to <code>OMAP_ETL</code> then run the <code>SP_ETL_Mapping_Tables_Preparation</code> to prepare <code>fieldsMapping</code> and <code>valuesMapping</code> tables.</li>
<li dir="auto"><code>SP_ETL_Mapping_Tables_Preparation.sql</code> — converts raw mapping sheets into <code>fieldsMapping</code> and <code>valuesMapping</code> tables.</li>
<li dir="auto"><code>SP_ETL_FastChange_Duqm.sql</code> — FastChange pipeline for Duqm.</li>
<li dir="auto"><code>SP_ETL_FastChange_Plots_Other_Than_Duqm.sql</code> — FastChange pipeline for other zones.</li>
<li dir="auto"><code>SP_ETL_Plot_Pre_Sync.sql</code> — Add ETL meta fields to destination tables, create archives, views and statistics.</li>
<li dir="auto"><code>SP_ETL_FC_Sync_Entity.sql</code> — Fast-change entity sync logic.</li>
<li dir="auto"><code>SP_ETL_CppLotWGS84_Cpplotpoint_Sync_Delete.sql</code> — Sync deletes.</li>
<li dir="auto"><code>projectionScript.py</code> &amp; <code>SP_ETL_Plot_Projection.sql</code> — Projection and loader to <code>cpplotWGS84</code>.</li>
<li dir="auto"><code>SP_ETL_Plot_Post_Sync.sql</code> — Finalize sync, load cpplotPoint and statistics.</li>
<li dir="auto"><code>SP_ETL_SC_Prepare_Job.sql</code> — Prepare mapping views and trim/normalize mapping tables.</li>
<li dir="auto"><code>TRGR_ETL_JOBS_After_Insert.sql</code> — Trigger to start job after insertion in <code>ETL_Jobs</code> table. </li>
<li dir="auto"><code>ETL_SC_Run_NotExecuted_Job.sql</code> — Agent job wrapper to run <code>SP_ETL_SC_Run_Job</code>.</li>
<li dir="auto"><code>SP_ETL_SC_Run_Job.sql</code> — Loop orchestration for slow-change jobs.</li>
<li dir="auto"><code>SP_ETL_SC_Sync_Entity.sql</code> — Main slow-change sync SP (validation, dynamic SQL, rowhash compare, logging).</li>
<li dir="auto"><code>fn_ExtractDigitsAsFloat.sql</code> — Extract numeric value from text helper.</li>
<li dir="auto"><code>fn_Get_Mapped_Field_Value.sql</code> —  Function for mapping values/codes.</li>
</ul>
<hr>
<h1 data-heading="**Stored_Procedures**" dir="auto"><strong>Stored_Procedures</strong></h1>
<h2 data-heading="**`SP_ETL_FC_Sync_Entity`**" dir="auto"><strong><code>SP_ETL_FC_Sync_Entity</code></strong></h2>
<h3 data-heading="**Overview**" dir="auto"><strong>Overview</strong></h3>
<p dir="auto"><code>SP_ETL_FC_Sync_Entity</code> is a Fast Change ETL stored procedure that synchronizes spatial entity data from a remote source database to the OMAP destination database via a linked server connection. It handles field mapping, data transformation, hash-based change detection, and maintains data integrity through archival before deletion, keep in mind this SP is only for Plot feature class.</p>
<h3 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h3>
<p dir="auto">This procedure performs incremental data synchronization for spatial entities (Plot) that change frequently, ensuring the destination database reflects the current state of the source data while preserving historical records(Archiving) .</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@SourceDB</code></td>
<td>NVARCHAR(128)</td>
<td>Source database identifier used for mapping lookups</td>
</tr>
<tr>
<td><code>@SourceEntityGroup</code></td>
<td>NVARCHAR(255)</td>
<td>Logical grouping of related source entities/tables</td>
</tr>
<tr>
<td><code>@DestEntity</code></td>
<td>NVARCHAR(128)</td>
<td>Target entity/table name in the destination database</td>
</tr>
<tr>
<td><code>@JobID</code></td>
<td>BIGINT</td>
<td>Unique identifier for the ETL job execution</td>
</tr>
<tr>
<td><code>@LinkedServerName</code></td>
<td>NVARCHAR(128)</td>
<td>Name of the SQL Server linked server</td>
</tr>
<tr>
<td><code>@LinkedServerSourceDB</code></td>
<td>NVARCHAR(128)</td>
<td>Database name on the linked server</td>
</tr>
</tbody>
</table>
<h3 data-heading="**Process Flow**" dir="auto"><strong>Process Flow</strong></h3>
<h4 data-heading="**Phase 1: Preparation &amp; Validation**" dir="auto"><strong>Phase 1: Preparation &amp; Validation</strong></h4>
<h5 data-heading="1. Retrieve Configuration Metadata" dir="auto">1. Retrieve Configuration Metadata</h5>
<ul>
<li dir="auto">Fetches schema name, SDE database name, entity suffix, and OPAZ Zone ID from <code>DBMappingMetaData</code></li>
<li dir="auto">Validates linked server existence</li>
<li dir="auto">Configures debugging mode</li>
</ul>
<h5 data-heading="2. Identify Source Tables" dir="auto">2. Identify Source Tables</h5>
<ul>
<li dir="auto">Queries <code>FieldsMapping</code> table to get all source entities involved in the synchronization</li>
<li dir="auto">Identifies the primary table (one without a primary key reference)</li>
<li dir="auto">Handles multi-table scenarios by cleaning up duplicates</li>
<li dir="auto">Creates temporary table <code>#sourceTables</code> with source entities, primary keys, and foreign keys</li>
</ul>
<h5 data-heading="3. Build Field Mapping table" dir="auto">3. Build Field Mapping table</h5>
<ul>
<li dir="auto">Extracts field mappings from <code>FieldsMapping</code> table</li>
<li dir="auto">Creates <code>#EntityFieldsMapping</code> temporary table containing:
<ul>
<li dir="auto">Source and destination field names</li>
<li dir="auto">Field types and data types</li>
<li dir="auto">Coded value indicators</li>
<li dir="auto">Reference relationships</li>
<li dir="auto">UTM zone information</li>
</ul>
</li>
</ul>
<h4 data-heading="**Phase 2: Data Extraction**" dir="auto"><strong>Phase 2: Data Extraction</strong></h4>
<p dir="auto">###%# 1. Construct Dynamic OPENQUERY Statement</p>
<p dir="auto"><strong>1. Add Essential Spatial Fields</strong></p>
<ul>
<li dir="auto">Checks for <code>GlobalID</code> field existence in source</li>
<li dir="auto">Adds <code>GlobalID</code>, <code>OBJECTID</code>, and <code>Shape</code> fields to field mapping</li>
<li dir="auto">Generates new GUID if source lacks GlobalID</li>
</ul>
<p dir="auto"><strong>2. Build SELECT Clause</strong></p>
<ul>
<li dir="auto">Dynamically constructs SELECT statement from mapped fields</li>
<li dir="auto">Handles calculated fields (e.g., <code>NEWID()</code> for GlobalID)</li>
</ul>
<p dir="auto"><strong>3. Build FROM Clause with JOINs</strong></p>
<ul>
<li dir="auto">Creates base FROM clause with primary table</li>
<li dir="auto">Adds LEFT JOINs for related tables using primary/foreign key relationships</li>
<li dir="auto">Applies entity name suffix (e.g., <code>_evw</code> for enterprise views)</li>
<li dir="auto">Adds <code>WHERE Shape IS NOT NULL</code> filter</li>
</ul>
<p dir="auto"><strong>4. Execute OPENQUERY</strong></p>
<ul>
<li dir="auto">Pulls data from linked server into <code>##sourceDataBeforeHash</code> global temp table</li>
</ul>
<h4 data-heading="**Phase 3: Data Transformation**" dir="auto"><strong>Phase 3: Data Transformation</strong></h4>
<h5 data-heading="1. Apply Field Transformations" dir="auto">1. Apply Field Transformations</h5>
<p dir="auto"><strong>1. Update Field References</strong></p>
<ul>
<li dir="auto">Updates <code>sourceFieldFullName</code> to reference temp table columns</li>
</ul>
<p dir="auto"><strong>2. Handle Coded Values</strong></p>
<ul>
<li dir="auto">Applies <code>fn_Get_Mapped_Field_Value()</code> function for fields with domain/coded values mapping.</li>
<li dir="auto">Maps source coded values to destination domain values</li>
</ul>
<p dir="auto"><strong>3. Generate ID Fields</strong></p>
<ul>
<li dir="auto">Concatenates OPAZ Zone ID with UTM zone and field value</li>
<li dir="auto">Format: <code>CONCAT('ZoneID + UTM', fieldValue)</code>, concatenation to ensure uniqeness over different zones.</li>
<li dir="auto">Applies to ID fields and reference destination IDs to maintain relations in the destination</li>
</ul>
<p dir="auto"><strong>4. Handle Type Conversions</strong></p>
<ul>
<li dir="auto">Uses <code>fn_ExtractDigitsAsFloat()</code> for string-to-numeric conversions</li>
<li dir="auto">Converts between incompatible field types</li>
</ul>
<p dir="auto"><strong>5. Add System Fields</strong></p>
<ul>
<li dir="auto"><strong>OBJECTID</strong>: Generates sequential IDs starting from max existing + 1</li>
<li dir="auto"><strong>OPAZZoneID</strong>: Adds zone identifier</li>
<li dir="auto"><strong>RowHash</strong>: Placeholder for change detection hash</li>
<li dir="auto"><strong>sourceEntityGroup</strong>: Adds source entity group identifier</li>
</ul>
<p dir="auto"><strong>6. Finalize Field Mapping</strong></p>
<ul>
<li dir="auto">Adds <code>AS</code> aliases to all field expressions</li>
<li dir="auto">Creates complete SELECT statement from transformed fields</li>
</ul>
<h5 data-heading="2 Create Final Source Dataset" dir="auto">2 Create Final Source Dataset</h5>
<ul>
<li dir="auto">Executes dynamic SQL to create <code>##sourceData</code> temp table</li>
<li dir="auto">Applies all transformations in a single SELECT INTO operation</li>
</ul>
<h5 data-heading="3. Calculate Row Hash" dir="auto">3. Calculate Row Hash</h5>
<ul>
<li dir="auto">Generates SHA2_256 hash from all fields (excluding Shape, OBJECTID, GlobalID, RowHash)</li>
<li dir="auto">Concatenates all field values as strings</li>
<li dir="auto">Used for change detection by comparing source vs destination hashes</li>
<li dir="auto">The fields order during concatenation is important to ensure <code>RowHash</code> value consistency over  <code>SP_ETL_FC_Sync_Entity</code> and <code>SP_ETL_SC_Sync_Entity</code></li>
</ul>
<h4 data-heading="**Phase 4: Data Synchronization**" dir="auto"><strong>Phase 4: Data Synchronization</strong></h4>
<h5 data-heading="1. Archive Changed/Deleted Records" dir="auto">1. Archive Changed/Deleted Records</h5>
<ul>
<li dir="auto">Identifies destination rows that no longer match source data</li>
<li dir="auto">Criteria for archiving:
<ul>
<li dir="auto">RowHash differs OR Shape geometry differs</li>
<li dir="auto">Matching OPAZZoneID and sourceEntityGroup</li>
</ul>
</li>
<li dir="auto">Inserts archived rows into <code>{DestEntity}_Archive</code> table</li>
<li dir="auto">Preserves historical data before deletion</li>
</ul>
<h5 data-heading="2. Delete Obsolete Records" dir="auto">2. Delete Obsolete Records</h5>
<ul>
<li dir="auto">Removes destination rows that don't exist in source</li>
<li dir="auto">Uses same criteria as archival:
<ul>
<li dir="auto">No matching RowHash in source</li>
<li dir="auto">No matching Shape geometry</li>
<li dir="auto">Filters by OPAZZoneID and sourceEntityGroup</li>
</ul>
</li>
<li dir="auto">Ensures only relevant zone/group data is affected</li>
</ul>
<h5 data-heading="3. Insert New Records" dir="auto">3. Insert New Records</h5>
<ul>
<li dir="auto">Inserts rows from source that don't exist in destination</li>
<li dir="auto">Identifies new records by RowHash not present in destination</li>
<li dir="auto">Filters by OPAZZoneID and sourceEntityGroup</li>
<li dir="auto">Includes all transformed and calculated fields</li>
</ul>
<h5 data-heading="4. Validate Coded Value Mappings" dir="auto">4. Validate Coded Value Mappings</h5>
<ul>
<li dir="auto">Checks for unmapped values (represented as -1)</li>
<li dir="auto">Iterates through all coded value fields</li>
<li dir="auto">Generates warning message listing any unmapped fields</li>
<li dir="auto">Helps identify missing domain mappings</li>
</ul>
<h4 data-heading="**Phase 5: Logging &amp; Cleanup**" dir="auto"><strong>Phase 5: Logging &amp; Cleanup</strong></h4>
<h5 data-heading="Success Logging" dir="auto">Success Logging</h5>
<ul>
<li dir="auto">Inserts execution record into <code>ETL_Logs</code> table</li>
<li dir="auto">Captures:
<ul>
<li dir="auto">All dynamic SQL statements (SELECT, FROM, RowHash, DELETE, INSERT)</li>
<li dir="auto">Success status</li>
<li dir="auto">Unmapped value warnings</li>
</ul>
</li>
</ul>
<h5 data-heading="Error Handling" dir="auto">Error Handling</h5>
<ul>
<li dir="auto">Wraps entire process in TRY-CATCH with transaction</li>
<li dir="auto">On error:
<ul>
<li dir="auto">Rolls back all changes</li>
<li dir="auto">Logs error details (message, severity, state, line number)</li>
<li dir="auto">Records failed SQL statements (until failure) for debugging</li>
</ul>
</li>
</ul>
<h3 data-heading="**Usage Example**" dir="auto"><strong>Usage Example</strong></h3>
<pre class="language-sql"><code class="language-sql is-loaded"><span class="token keyword">EXEC</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>SP_ETL_FC_Sync_Entity<span class="token punctuation">]</span>
    <span class="token variable">@SourceDB</span> <span class="token operator">=</span> <span class="token string">'Special Economic Zone at Duqm'</span><span class="token punctuation">,</span>
    <span class="token variable">@SourceEntityGroup</span> <span class="token operator">=</span> <span class="token string">'Plot'</span><span class="token punctuation">,</span>
    <span class="token variable">@DestEntity</span> <span class="token operator">=</span> <span class="token string">'cpPlot40'</span><span class="token punctuation">,</span>
    <span class="token variable">@JobID</span> <span class="token operator">=</span> <span class="token number">12345</span><span class="token punctuation">,</span>
    <span class="token variable">@LinkedServerName</span> <span class="token operator">=</span> <span class="token string">'SQLDBGISCLUSTER\SQLDBGIS,1434'</span><span class="token punctuation">,</span>
    <span class="token variable">@LinkedServerSourceDB</span> <span class="token operator">=</span> <span class="token string">'SEZAD2016'</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></button></pre>
<h3 data-heading="**Output**" dir="auto"><strong>Output</strong></h3>
<ul>
<li dir="auto">Prints unmapped value warnings to console</li>
<li dir="auto">Returns execution status in <code>ETL_Logs</code> table</li>
<li dir="auto">Updates destination entity with synchronized data</li>
<li dir="auto">Archives changed/deleted records.</li>
</ul>
<hr>
<h2 data-heading="**`SP_ETL_SC_Sync_Entity`**" dir="auto"><strong><code>SP_ETL_SC_Sync_Entity</code></strong></h2>
<h3 data-heading="**Overview**" dir="auto"><strong>Overview</strong></h3>
<p dir="auto"><code>SP_ETL_SC_Sync_Entity</code> is a Slow Change ETL stored procedure that synchronizes spatial entity data from a local backup source database to the OMAP destination database. It includes validation checks, handles field mappings different cases, and performs hash-based change detection for incremental updates. Unlike the Fast Change procedure, this operates on local database copies rather than linked servers.</p>
<h3 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h3>
<p dir="auto">This procedure performs full data synchronization for entities that change infrequently, with extensive pre-validation to ensure data integrity before any modifications occur. </p>
<h3 data-heading="**Parameters**" dir="auto"><strong>Parameters</strong></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@SourceDB</code></td>
<td>NVARCHAR(128)</td>
<td>Source database identifier used for mapping lookups</td>
</tr>
<tr>
<td><code>@SourceEntityGroup</code></td>
<td>NVARCHAR(255)</td>
<td>Logical grouping of related source entities/tables</td>
</tr>
<tr>
<td><code>@DestEntity</code></td>
<td>NVARCHAR(128)</td>
<td>Target entity/table name in the destination database</td>
</tr>
<tr>
<td><code>@JobID</code></td>
<td>BIGINT</td>
<td>Unique identifier for the ETL job execution</td>
</tr>
</tbody>
</table>
<h3 data-heading="**Process Flow**" dir="auto"><strong>Process Flow</strong></h3>
<h4 data-heading="**Phase 1:  Validation (9 Steps)**" dir="auto"><strong>Phase 1:  Validation (9 Steps)</strong></h4>
<h4 data-heading="1. Verify Mapping Configuration Exists" dir="auto">1. Verify Mapping Configuration Exists</h4>
<ul>
<li dir="auto">Checks if mapping exists in <code>FieldsMapping</code> table for the specified source DB, entity group, and destination entity</li>
<li dir="auto"><strong>Fails early</strong> if no mapping configuration is found</li>
<li dir="auto">Ensures the ETL job has valid metadata to proceed</li>
</ul>
<h4 data-heading="2. Validate Source Tables Existence" dir="auto">2. Validate Source Tables Existence</h4>
<ul>
<li dir="auto">Extracts all source entities involved in the synchronization from <code>FieldsMapping</code></li>
<li dir="auto">Creates <code>#sourceTables</code> temporary table with:
<ul>
<li dir="auto">Source entity names</li>
<li dir="auto">Primary key relationships</li>
<li dir="auto">Foreign key relationships</li>
</ul>
</li>
<li dir="auto">Removes duplicate entries for tables without primary keys</li>
<li dir="auto"><strong>Fails</strong> if no source tables are identified</li>
<li dir="auto">Identifies the primary table (the one without a primary key reference)</li>
</ul>
<h4 data-heading="3. Check for Duplicate Field Mappings" dir="auto">3. Check for Duplicate Field Mappings</h4>
<ul>
<li dir="auto">Identifies any destination fields that are mapped from multiple source fields</li>
<li dir="auto">Creates <code>#DuplicateFields</code> temporary table</li>
<li dir="auto">Aggregates duplicate fields into a comma-separated error message</li>
<li dir="auto"><strong>Fails</strong> if duplicate mappings are detected</li>
<li dir="auto">Prevents data conflicts and ambiguous field assignments</li>
</ul>
<h4 data-heading="4. Verify Destination Entity Exists" dir="auto">4. Verify Destination Entity Exists</h4>
<ul>
<li dir="auto">Checks physical existence of destination table in OMAP database</li>
<li dir="auto">Validates table exists in the correct schema</li>
<li dir="auto"><strong>Fails</strong> if destination table is not found</li>
<li dir="auto">Ensures target table is ready to receive data</li>
</ul>
<h4 data-heading="5. Validate Destination Fields Exist" dir="auto">5. Validate Destination Fields Exist</h4>
<ul>
<li dir="auto">Compares all mapped destination fields against actual table columns</li>
<li dir="auto">Creates <code>#EntityFieldsMapping</code> temporary table containing:
<ul>
<li dir="auto">Source and destination field names</li>
<li dir="auto">Field types and data types</li>
<li dir="auto">Coded value indicators</li>
<li dir="auto">Reference relationships</li>
<li dir="auto">UTM zone information</li>
</ul>
</li>
<li dir="auto">Identifies missing destination fields</li>
<li dir="auto"><strong>Fails</strong> if any mapped fields don't exist in destination table</li>
<li dir="auto">Prevents runtime errors during INSERT operations</li>
</ul>
<h4 data-heading="6. Check for Empty or Null Mappings" dir="auto">6. Check for Empty or Null Mappings</h4>
<ul>
<li dir="auto">Validates that all field mappings have non-null, non-empty source and destination fields</li>
<li dir="auto"><strong>Fails</strong> if any mapping has missing field names</li>
<li dir="auto">Ensures data integrity of mapping configuration</li>
</ul>
<h4 data-heading="7. Validate WHERE Condition Uniqueness" dir="auto">7. Validate WHERE Condition Uniqueness</h4>
<ul>
<li dir="auto">Extracts all WHERE conditions from field mappings</li>
<li dir="auto">Creates <code>#whereConditions</code> temporary table</li>
<li dir="auto"><strong>Fails</strong> if multiple different WHERE conditions are defined</li>
<li dir="auto">Ensures consistent filtering logic across the entity group</li>
<li dir="auto">Sets <code>@whereCondition</code> variable for later use</li>
</ul>
<h4 data-heading="8. Check for Multiple Primary Tables" dir="auto">8. Check for Multiple Primary Tables</h4>
<ul>
<li dir="auto">Validates that only one primary table exists in the source entity group</li>
<li dir="auto"><strong>Fails</strong> if multiple primary tables (<code>relatedPrimaryEntity</code>) are detected</li>
<li dir="auto">Prevents ambiguous JOIN relationships</li>
<li dir="auto">Lists conflicting primary tables in error message</li>
</ul>
<h4 data-heading="9. Confirm Primary Table is Defined" dir="auto">9. Confirm Primary Table is Defined</h4>
<ul>
<li dir="auto">Ensures at least one table without a primary key reference exists</li>
<li dir="auto">Sets <code>@PrimaryTable</code> variable</li>
<li dir="auto"><strong>Fails</strong> if no primary table is identified</li>
<li dir="auto">Prevents orphaned JOIN chains</li>
</ul>
<h4 data-heading="**Phase 2: Destination Table Preparation**" dir="auto"><strong>Phase 2: Destination Table Preparation</strong></h4>
<h4 data-heading="1. Add Required System Columns" dir="auto">1. Add Required System Columns</h4>
<p dir="auto">Dynamically alters the destination table to add tracking columns if they don't exist:</p>
<p dir="auto"><strong>Columns Added:</strong></p>
<ul>
<li dir="auto"><strong>RowHash</strong> (VARCHAR(64)): SHA2_256 hash for change detection</li>
<li dir="auto"><strong>source_objectid</strong> (INT): Original OBJECTID from source</li>
<li dir="auto"><strong>source_globalID</strong> (UNIQUEIDENTIFIER): Original GlobalID from source</li>
<li dir="auto"><strong>sourceEntityGroup</strong> (NVARCHAR(255)): Source entity group identifier</li>
<li dir="auto"><strong>LastSyncAt</strong> (DATETIME2): Timestamp of last synchronization (default: current date/time)</li>
</ul>
<h4 data-heading="2. Add GlobalID Column" dir="auto">2. Add GlobalID Column</h4>
<ul>
<li dir="auto">Checks for GlobalID column existence</li>
<li dir="auto">Adds GlobalID (UNIQUEIDENTIFIER) if missing</li>
<li dir="auto">Ensures compatibility with ArcGIS enterprise geodatabase standards</li>
</ul>
<h4 data-heading="**Phase 3: Data Extraction &amp; Transformation**" dir="auto"><strong>Phase 3: Data Extraction &amp; Transformation</strong></h4>
<h4 data-heading="1. Build Dynamic SELECT Statement" dir="auto">1. Build Dynamic SELECT Statement</h4>
<p dir="auto"><strong>Step 1: Prefix Fields with Table Names</strong></p>
<ul>
<li dir="auto">Updates <code>sourceFieldFullName</code> to include table prefix</li>
<li dir="auto">Format: <code>TableName.FieldName</code></li>
<li dir="auto">Skips fields already in formula format (containing parentheses)</li>
</ul>
<p dir="auto"><strong>Step 2: Handle Coded Domain Values</strong></p>
<ul>
<li dir="auto">Applies <code>fn_Get_Mapped_Field_Value()</code> function for fields with domains</li>
<li dir="auto">Maps source coded values to destination domain values</li>
<li dir="auto">Handles subtype-dependent domains using <code>sourceSubtypeField</code></li>
<li dir="auto">Example: Status codes (1='Active', 2='Inactive') mapped to destination domains</li>
</ul>
<p dir="auto"><strong>Step 3: Generate ID and Reference Fields</strong></p>
<ul>
<li dir="auto">Concatenates OPAZ Zone ID + UTM Zone + field value</li>
<li dir="auto">Format: <code>CONCAT('ZoneID', fieldValue)</code></li>
<li dir="auto">Applies to:
<ul>
<li dir="auto">ID fields (primary identifiers)</li>
<li dir="auto">Fields referencing destination IDs (foreign keys)</li>
</ul>
</li>
<li dir="auto">Creates globally unique identifiers across zones</li>
</ul>
<p dir="auto"><strong>Step 4: Handle Data Type Conversions</strong></p>
<ul>
<li dir="auto">Uses <code>fn_ExtractDigitsAsFloat()</code> for string-to-numeric conversions</li>
<li dir="auto">Converts between incompatible field types:
<ul>
<li dir="auto">String → Integer, SmallInteger, Double, BigInteger</li>
</ul>
</li>
<li dir="auto">Extracts numeric values from mixed-content strings</li>
</ul>
<p dir="auto"><strong>Step 5: Add Shape Geometry Field</strong></p>
<ul>
<li dir="auto">Checks if Shape field exists in both source and destination</li>
<li dir="auto">Verifies column existence in:
<ul>
<li dir="auto">Destination table (OMAP database)</li>
<li dir="auto">Primary source table (SDE database)</li>
</ul>
</li>
<li dir="auto">Adds Shape field to mapping if present in both</li>
<li dir="auto">Sets <code>@ShapeFieldExists</code> flag for later use</li>
</ul>
<p dir="auto"><strong>Step 6: Add GlobalID Field</strong></p>
<ul>
<li dir="auto">Checks for GlobalID existence in source primary table</li>
<li dir="auto">If exists:
<ul>
<li dir="auto">Maps source GlobalID to <code>source_globalID</code> in destination</li>
<li dir="auto">Maps source GlobalID to destination <code>GlobalID</code> field (if not already mapped)</li>
</ul>
</li>
<li dir="auto">If missing:
<ul>
<li dir="auto">Generates new GUID using <code>NEWID()</code> function</li>
</ul>
</li>
</ul>
<p dir="auto"><strong>Step 7: Add OBJECTID Field</strong></p>
<ul>
<li dir="auto">Retrieves maximum existing OBJECTID from destination table</li>
<li dir="auto">Generates sequential IDs: <code>@MaxObjectID + ROW_NUMBER()</code></li>
<li dir="auto">Maps source OBJECTID to <code>source_objectID</code> (if not already mapped)</li>
<li dir="auto">Ensures unique OBJECTID values in destination</li>
</ul>
<p dir="auto"><strong>Step 8: Add OPAZZoneID Field</strong></p>
<ul>
<li dir="auto">Inserts zone identifier from metadata</li>
<li dir="auto">Enables zone-based data partitioning</li>
</ul>
<p dir="auto"><strong>Step 9: Add RowHash Placeholder</strong></p>
<ul>
<li dir="auto">Inserts NULL placeholder for hash calculation</li>
<li dir="auto">Will be populated in step 11</li>
</ul>
<p dir="auto"><strong>Step 10: Add Source Entity Group</strong></p>
<ul>
<li dir="auto">Inserts source entity group identifier</li>
<li dir="auto">Enables filtering by entity group during sync</li>
</ul>
<p dir="auto"><strong>Step 11: Apply Default Aliasing</strong></p>
<ul>
<li dir="auto">Adds <code>AS destination_field</code> to all source field expressions</li>
<li dir="auto">Completes the SELECT clause construction</li>
</ul>
<h4 data-heading="2. Build Dynamic FROM Clause with JOINs" dir="auto">2. Build Dynamic FROM Clause with JOINs</h4>
<p dir="auto"><strong>Step 1: Construct FROM Statement</strong></p>
<ul>
<li dir="auto">Creates base FROM clause with primary table</li>
<li dir="auto">Adds LEFT JOINs for related tables using primary/foreign key relationships</li>
<li dir="auto">Format:</li>
</ul>
<pre class="language-sql"><code class="language-sql is-loaded">  <span class="token keyword">FROM</span> <span class="token punctuation">[</span>SDE_DB<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token keyword">Schema</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PrimaryTable<span class="token punctuation">]</span>
  <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> <span class="token punctuation">[</span>SDE_DB<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span><span class="token keyword">Schema</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>RelatedTable<span class="token punctuation">]</span> 
    <span class="token keyword">ON</span> <span class="token punctuation">[</span>PrimaryTable<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>PK<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>RelatedTable<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>FK<span class="token punctuation">]</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></button></pre>
<p dir="auto"><strong>Step 2: Execute Data Extraction</strong></p>
<ul>
<li dir="auto">Combines SELECT and FROM clauses</li>
<li dir="auto">Adds WHERE condition if defined in validation phase</li>
<li dir="auto">Applies entity name suffix (e.g., <code>_evw</code> for enterprise views)</li>
<li dir="auto">Replaces all table references with suffixed versions</li>
<li dir="auto">Creates <code>##sourceData</code> global temporary table with transformed data</li>
<li dir="auto">Executes dynamic SQL to populate temp table</li>
</ul>
<h4 data-heading="3. Calculate Row Hash for Change Detection" dir="auto">3. Calculate Row Hash for Change Detection</h4>
<ul>
<li dir="auto">Generates SHA2_256 hash from all relevant fields</li>
<li dir="auto">Concatenates field values (excluding: RowHash, Shape, OBJECTID, GlobalID)</li>
<li dir="auto">Converts all values to NVARCHAR(1000), uses empty string for NULLs</li>
<li dir="auto">Orders fields consistently for reproducible hashes</li>
<li dir="auto">Updates RowHash column in <code>##sourceData</code></li>
<li dir="auto">Enables efficient change detection by comparing hashes</li>
</ul>
<h4 data-heading="**Phase 4: Data Synchronization**" dir="auto"><strong>Phase 4: Data Synchronization</strong></h4>
<h4 data-heading="1. Delete Obsolete Records" dir="auto">1. Delete Obsolete Records</h4>
<p dir="auto"><strong>Without Shape Field:</strong></p>
<ul>
<li dir="auto">Simple hash comparison</li>
<li dir="auto">Deletes destination rows where RowHash doesn't exist in source</li>
<li dir="auto">Filters by OPAZZoneID and sourceEntityGroup</li>
</ul>
<p dir="auto"><strong>With Shape Field:</strong></p>
<ul>
<li dir="auto">Complex comparison with geometry validation</li>
<li dir="auto">Performs LEFT JOIN between destination and source</li>
<li dir="auto">Matches on both:
<ul>
<li dir="auto">RowHash (with collation: Arabic_100_CI_AS)</li>
<li dir="auto">Shape geometry equality (<code>STEquals()</code> = 1)</li>
</ul>
</li>
<li dir="auto">Deletes rows where no match is found</li>
<li dir="auto">Filters by OPAZZoneID and sourceEntityGroup</li>
<li dir="auto">Handles spatial data changes more precisely</li>
</ul>
<h4 data-heading="2. Insert New Records" dir="auto">2. Insert New Records</h4>
<ul>
<li dir="auto">Identifies new rows by comparing RowHash values</li>
<li dir="auto">Selects all rows from <code>##sourceData</code> where RowHash doesn't exist in destination</li>
<li dir="auto">Filters by OPAZZoneID and sourceEntityGroup</li>
<li dir="auto">Inserts all mapped fields including:
<ul>
<li dir="auto">Transformed data fields</li>
<li dir="auto">Generated system fields (OBJECTID, GlobalID, RowHash)</li>
<li dir="auto">Metadata fields (OPAZZoneID, sourceEntityGroup)</li>
</ul>
</li>
</ul>
<h4 data-heading="3. Validate Coded Value Mappings" dir="auto">3. Validate Coded Value Mappings</h4>
<ul>
<li dir="auto">Iterates through all fields with coded values using CURSOR</li>
<li dir="auto">Checks destination table for any <code>-1</code> values (unmapped indicator)</li>
<li dir="auto">Filters by OPAZZoneID and sourceEntityGroup</li>
<li dir="auto">Builds warning message listing:
<ul>
<li dir="auto">Source field name</li>
<li dir="auto">Destination field name</li>
</ul>
</li>
<li dir="auto">Prints warning message to console</li>
<li dir="auto">Helps identify missing domain mappings in <code>ValuesMapping</code> table</li>
</ul>
<hr>
<h4 data-heading="**Phase 5: Logging &amp; Cleanup**" dir="auto"><strong>Phase 5: Logging &amp; Cleanup</strong></h4>
<h4 data-heading="Success Path" dir="auto">Success Path</h4>
<ul>
<li dir="auto">Inserts execution record into <code>ETL_Logs</code> table</li>
<li dir="auto">Captures:
<ul>
<li dir="auto">All dynamic SQL statements (SELECT, FROM, RowHash, DELETE, INSERT)</li>
<li dir="auto">Success status</li>
<li dir="auto">Unmapped value warnings (if any)</li>
</ul>
</li>
<li dir="auto">Drops temporary tables:
<ul>
<li dir="auto"><code>#EntityFieldsMapping</code></li>
<li dir="auto"><code>#sourceTables</code></li>
<li dir="auto"><code>##sourceData</code></li>
</ul>
</li>
<li dir="auto">Commits transaction</li>
</ul>
<h4 data-heading="Error Handling" dir="auto">Error Handling</h4>
<ul>
<li dir="auto">Wraps entire procedure in TRY-CATCH with transaction</li>
<li dir="auto">On error:
<ul>
<li dir="auto">Rolls back all changes</li>
<li dir="auto">Captures error details:
<ul>
<li dir="auto">Error message</li>
<li dir="auto">Error severity</li>
<li dir="auto">Error state</li>
<li dir="auto">Error line number</li>
</ul>
</li>
<li dir="auto">Logs error to <code>ETL_Logs</code> table with:
<ul>
<li dir="auto">All constructed SQL statements (for debugging)</li>
<li dir="auto">Failure status</li>
</ul>
</li>
<li dir="auto">Prints error message and line number</li>
<li dir="auto">Returns control to caller</li>
</ul>
</li>
</ul>
<h3 data-heading="**Usage Example**" dir="auto"><strong>Usage Example</strong></h3>
<pre class="language-sql"><code class="language-sql is-loaded"><span class="token keyword">EXEC</span> <span class="token punctuation">[</span>dbo<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>SP_ETL_SC_Sync_Entity<span class="token punctuation">]</span>
    <span class="token variable">@SourceDB</span> <span class="token operator">=</span> <span class="token string">'Special Economic Zone at Duqm'</span><span class="token punctuation">,</span>
    <span class="token variable">@SourceEntityGroup</span> <span class="token operator">=</span> <span class="token string">'Plot'</span><span class="token punctuation">,</span>
    <span class="token variable">@DestEntity</span> <span class="token operator">=</span> <span class="token string">'cpPlot40'</span><span class="token punctuation">,</span>
    <span class="token variable">@JobID</span> <span class="token operator">=</span> <span class="token number">12345</span><span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></button></pre>
<h3 data-heading="**Output**" dir="auto"><strong>Output</strong></h3>
<ul>
<li dir="auto">Prints validation results for each step</li>
<li dir="auto">Prints unmapped value warnings (if any)</li>
<li dir="auto">Returns execution status in <code>ETL_Logs</code> table</li>
<li dir="auto">Updates destination entity with synchronized data</li>
</ul>
<hr>
<h2 data-heading="**`SP_ETL_Mapping_Tables_Preparation`**" dir="auto"><strong><code>SP_ETL_Mapping_Tables_Preparation</code></strong></h2>
<h3 data-heading="**Overview**" dir="auto"><strong>Overview</strong></h3>
<p dir="auto"><strong>SP_ETL_Mapping_Tables_Preparation</strong>&nbsp;is a stored procedure that prepares mapping tables for data transformation processes. It processes source-to-destination field mappings, value mappings, and maintains backup history.</p>
<h3 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h3>
<p dir="auto">This procedure transforms raw mapping data from source tables (<code>FIELDS</code>,&nbsp;<code>Mappings</code>,&nbsp;<code>domains</code>,&nbsp;<code>objectClasses</code>) into structured mapping tables (<code>fieldsMapping</code>,&nbsp;<code>valuesMapping</code>) used for ETL processes, with additional business logic for spatial references and entity grouping.</p>
<h3 data-heading="**Process Flow**" dir="auto"><strong>Process Flow</strong></h3>
<h4 data-heading="**Phase 1: Fields Mapping Preparation**" dir="auto"><strong>Phase 1: Fields Mapping Preparation</strong></h4>
<p dir="auto"><strong>Source Table</strong>:&nbsp;<code>dbo.FIELDS</code><br>
<strong>Destination Table</strong>:&nbsp;<code>dbo.fieldsMapping</code></p>
<h5 data-heading="Key Transformations:" dir="auto">Key Transformations:</h5>
<ul>
<li dir="auto"><strong>Data Cleaning</strong>: Trims whitespace characters (CHAR(10), CHAR(13), CHAR(9)) from all text fields</li>
<li dir="auto"><strong>Filtering</strong>: Only includes records where:
<ul>
<li dir="auto"><code>is_In_Design = 'Yes'</code>&nbsp;OR</li>
<li dir="auto"><code>RelationshipOriginPrimaryKey IS NOT NULL</code><br>
</li>
</ul>
</li>
<li dir="auto"><strong>Column Mapping</strong>:
<ul>
<li dir="auto">Relationship fields (relatedPrimaryKey, relatedPrimaryEntity)</li>
<li dir="auto">Additional metadata fields:
<ul>
<li dir="auto"><strong>hasCodedValue</strong>: to identify if there is value mapping for this field or not.</li>
<li dir="auto"><strong>foreignKey</strong>: to specify the table foreign key if any.</li>
<li dir="auto"><strong>hasArchive</strong>: for future features (Not considered in this version yet).</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 data-heading="Special Handling:" dir="auto">Special Handling:</h5>
<ul>
<li dir="auto">Replaces 'NA', 'N/A' values with NULL in dataset fields</li>
<li dir="auto">Handles table creation if not exists, otherwise truncates and repopulates</li>
</ul>
<h4 data-heading="**Phase 2: Spatial Reference Assignment**" dir="auto"><strong>Phase 2: Spatial Reference Assignment</strong></h4>
<p dir="auto">Sets&nbsp;<code>source_SR_WKID</code>&nbsp;based on source database:</p>
<ul>
<li dir="auto"><strong>32639</strong>: Salalah Free Zone, Industrial Estates (MADAYN) with datasets ending in '_39'</li>
<li dir="auto"><strong>32640</strong>: Sohar Free Zone, Special Economic Zone at Duqm, Industrial Estates (MADAYN) with datasets ending in '_40'</li>
</ul>
<h4 data-heading="**Phase 3: Destination Entity Zone Suffixing" dir="auto">**Phase 3: Destination Entity Zone Suffixing</h4>
<p dir="auto">Appends zone prefix to destination entities to match the destination database schema:</p>
<ul>
<li dir="auto"><strong>Zone 39</strong>: Appends '39' to&nbsp;<code>destEntity</code>&nbsp;(except 'cpPlot<strong>ATTACH' becomes 'cpPlot39</strong>ATTACH')</li>
<li dir="auto"><strong>Zone 40</strong>: Appends '40' to&nbsp;<code>destEntity</code>&nbsp;(except 'cpPlot<strong>ATTACH' becomes 'cpPlot40</strong>ATTACH')</li>
</ul>
<h4 data-heading="**Phase 4: Values Mapping Preparation" dir="auto">**Phase 4: Values Mapping Preparation</h4>
<p dir="auto"><strong>Source Tables</strong>:&nbsp;<code>dbo.Mappings</code>,&nbsp;<code>dbo.domains</code>,&nbsp;<code>dbo.objectClasses</code><br>
<strong>Destination Table</strong>:&nbsp;<code>dbo.valuesMapping</code></p>
<h5 data-heading="Three Data Sources:" dir="auto">Three Data Sources:</h5>
<ol>
<li dir="auto"><strong>Main Mappings</strong>: Direct field value mappings from&nbsp;<code>Mappings</code>&nbsp;table</li>
<li dir="auto"><strong>Domain Values</strong>: Coded value domains from&nbsp;<code>domains</code>&nbsp;table (joined with fieldsMapping to populate other fields in fieldsMapping)</li>
<li dir="auto"><strong>Subtype Mappings</strong>: Subtype code mappings from&nbsp;<code>objectClasses</code>&nbsp;table</li>
</ol>
<h4 data-heading="**Phase 5: Relationship and Grouping Logic**" dir="auto"><strong>Phase 5: Relationship and Grouping Logic</strong></h4>
<ul>
<li dir="auto"><strong>Foreign Key Identification</strong>: Sets&nbsp;<code>foreignKey = sourceField</code>&nbsp;where&nbsp;<code>relatedPrimaryKey IS NOT NULL</code></li>
<li dir="auto"><strong>Entity Grouping</strong>:
<ul>
<li dir="auto">Initial grouping:&nbsp;<code>sourceEntityGroup = sourceEntity</code></li>
<li dir="auto">Updates with related primary entities where relationships exist</li>
<li dir="auto">Custom grouping via&nbsp;<code>CustomSourceEntityGroup</code>&nbsp;concatenation when grouping is provided from the mapping sheet.</li>
</ul>
</li>
<li dir="auto"><strong>Primary Key Cleanup</strong>: Nullifies relationship fields when source entity is the primary table</li>
</ul>
<h4 data-heading="**Phase 6: Define the fields with value mapping**" dir="auto"><strong>Phase 6: Define the fields with value mapping</strong></h4>
<p dir="auto">Set <code>hasCodedValue = 1</code> where the field has mapping in the <code>valuesMapping</code> table </p>
<h4 data-heading="**Phase 7: Domain Tables Creation**" dir="auto"><strong>Phase 7: Domain Tables Creation</strong></h4>
<p dir="auto">Creates distinct value domains for:</p>
<ul>
<li dir="auto"><code>DomainSourceDB</code>: Unique source databases</li>
<li dir="auto"><code>DomainDestEntity</code>: Unique destination entities</li>
<li dir="auto"><code>DomainSourceEntityGroup</code>: Unique source entity group.<br>
To be used in ETL tool interface.</li>
</ul>
<h4 data-heading="**Phase 8: Backup Management" dir="auto">**Phase 8: Backup Management</h4>
<ul>
<li dir="auto">Takes backup of the uploaded version into <code>fieldsMapping_backups</code>&nbsp;and&nbsp;<code>valuesMapping_backups</code></li>
<li dir="auto">Deletes unnecessary backups of&nbsp;<code>fieldsMapping</code>&nbsp;and&nbsp;<code>valuesMapping</code></li>
<li dir="auto">Keeps only the last 10 backups using DENSE_RANK()</li>
<li dir="auto">Includes timestamp for backup identification</li>
</ul>
<hr>
<h2 data-heading="`SP_ETL_SC_Run_Job`" dir="auto"><code>SP_ETL_SC_Run_Job</code></h2>
<h3 data-heading="**Overview**" dir="auto"><strong>Overview</strong></h3>
<p dir="auto"><strong>SP_ETL_SC_Run_Job</strong> is the main orchestrator stored procedure for SlowChange ETL synchronization jobs. It validates restore status, prepares the ETL environment, generates a list of entity combinations to synchronize, and executes synchronization for each combination sequentially.</p>
<h3 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h3>
<p dir="auto">This procedure coordinates the execution of SlowChange sync operations by ensuring data prerequisites are met (successful database restores), preparing the job environment, and iterating through all required source-destination entity mappings to perform synchronization via <code>SP_ETL_SC_Sync_Entity</code>.</p>
<h3 data-heading="**Parameters**" dir="auto"><strong>Parameters</strong></h3>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner">Tip</div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>@SourceDB</code></td>
<td>NVARCHAR(255)</td>
<td>Source database name (NULL = all databases)</td>
</tr>
<tr>
<td><code>@SourceEntityGroup</code></td>
<td>NVARCHAR(255)</td>
<td>Source entity group for filtering (NULL = all groups)</td>
</tr>
<tr>
<td><code>@DestEntity</code></td>
<td>NVARCHAR(255)</td>
<td>Destination entity name (NULL = all entities)</td>
</tr>
<tr>
<td><code>@JobID</code></td>
<td>INT</td>
<td>Unique identifier for the ETL job execution</td>
</tr>
</tbody>
</table>
</div></div>
<p dir="auto"><strong>Note</strong>: When parameters are NULL or empty string, the procedure processes all applicable records.</p>
<hr>
<h3 data-heading="**Process Flow**" dir="auto"><strong>Process Flow</strong></h3>
<h4 data-heading="**Phase 1: Restore Status Validation**" dir="auto"><strong>Phase 1: Restore Status Validation</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Ensure source databases have been successfully restored today before proceeding with ETL operations.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Identify Current Server</strong>: Captures <code>@@SERVERNAME</code> to filter restore logs by server instance</li>
<li dir="auto"><strong>Query Restore Logs</strong>: Retrieves the most recent restore record for each database from today
<ul>
<li dir="auto">Source: <code>OMAP_ETL.dbo.ETL_Backup_Restore_Log</code></li>
<li dir="auto">Filters: <code>Type = 'Restore'</code>, <code>CAST(Date AS DATE) = today</code>, <code>DBInstance = current server</code></li>
<li dir="auto">Uses <code>ROW_NUMBER()</code> partitioned by <code>DBName</code> to get the newest restore attempt</li>
</ul>
</li>
<li dir="auto"><strong>Build Allowed Database List</strong>: Creates <code>#AllowedSourceDBs</code> temp table containing:
<ul>
<li dir="auto">Only databases with <code>Status = 'Success'</code> in their most recent restore</li>
<li dir="auto">Joined with <code>DBMappingMetaData</code> to map SDE database names to mapping database names</li>
<li dir="auto">Filtered by <code>@SourceDB</code> parameter if specified</li>
</ul>
</li>
<li dir="auto"><strong>Log Restoration Failures</strong>:
<ul>
<li dir="auto">Identifies databases requested in <code>@SourceDB</code> parameter that failed restoration or weren't restored today</li>
<li dir="auto">Inserts failure records into <code>OMAP_ETL.dbo.ETL_Logs</code>:
<ul>
<li dir="auto"><code>ErrorMessage</code>: "Source DB restore unsuccessful today. ETL job not run for this DB."</li>
<li dir="auto"><code>STATUS</code>: 'Failure'</li>
</ul>
</li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Business Rule</strong>: ETL synchronization will NOT proceed for databases without successful restoration today.</p>
<hr>
<h4 data-heading="**Phase 2: Job Preparation**" dir="auto"><strong>Phase 2: Job Preparation</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Initialize and prepare the ETL environment for synchronization.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ul>
<li dir="auto"><strong>Calls</strong>: <code>SP_ETL_SC_Prepare_Job</code></li>
<li dir="auto"><strong>Error Handling</strong>: Wrapped in TRY-CATCH block (errors suppressed to allow continuation)</li>
<li dir="auto"><strong>Preparation Tasks</strong> (performed by called procedure):
<ul>
<li dir="auto">Create views for versioned DBs if it didn't created successfully from the the create version view step.</li>
<li dir="auto">Trim any additional empty spaces or lines from the fieldsMapping and valuesMapping.</li>
</ul>
</li>
</ul>
<hr>
<h4 data-heading="**Phase 3: Entity Combination Selection**" dir="auto"><strong>Phase 3: Entity Combination Selection</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Generate a distinct list of source-destination entity mappings to be synchronized.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Query Source</strong>: <code>dbo.fieldsMapping</code> table</li>
<li dir="auto"><strong>Filtering Criteria</strong>:
<ul>
<li dir="auto"><code>destEntity = @DestEntity</code> OR <code>@DestEntity</code> is NULL</li>
<li dir="auto"><code>sourceDB = @SourceDB</code> OR <code>@SourceDB</code> is NULL</li>
<li dir="auto"><code>sourceEntityGroup = @SourceEntityGroup</code> OR <code>@SourceEntityGroup</code> is NULL</li>
<li dir="auto"><code>sourceDB IN (SELECT Mapping_DB_Name FROM #AllowedSourceDBs)</code> <em>(critical safety filter)</em></li>
<li dir="auto"><code>destEntity IS NOT NULL</code></li>
</ul>
</li>
<li dir="auto"><strong>Grouping</strong>: Distinct combinations of:
<ul>
<li dir="auto"><code>destEntity</code></li>
<li dir="auto"><code>sourceDB</code></li>
<li dir="auto"><code>sourceEntityGroup</code></li>
</ul>
</li>
<li dir="auto"><strong>Result Storage</strong>: <code>#SelectedDestEntities</code> temp table with:
<ul>
<li dir="auto"><code>LoopCounter</code>: Sequential row number for iteration</li>
<li dir="auto">Entity combination fields</li>
<li dir="auto">Ordered by <code>destEntity</code>, <code>sourceDB</code>, <code>sourceEntityGroup</code></li>
</ul>
</li>
<li dir="auto"><strong>Debugging Output</strong>:
<ul>
<li dir="auto">Prints total entity count: <code>@MaxCount</code></li>
<li dir="auto">Selects all records from <code>#SelectedDestEntities</code></li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Business Rule</strong>: Only entities from successfully restored databases are included.</p>
<hr>
<h4 data-heading="**Phase 4: Sequential Entity Synchronization**" dir="auto"><strong>Phase 4: Sequential Entity Synchronization</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Iterate through each entity combination and execute synchronization.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Loop Structure</strong>: <code>WHILE (@Counter &lt;= @MaxCount)</code>
<ul>
<li dir="auto">Starts at 1, increments after each iteration</li>
<li dir="auto">Processes entities sequentially (not in parallel)</li>
</ul>
</li>
<li dir="auto"><strong>Current Entity Extraction</strong>:
<ul>
<li dir="auto">Retrieves <code>@CurrDestEntity</code>, <code>@CurrSourceDB</code>, <code>@CurrSourceEntityGroup</code> from <code>#SelectedDestEntities</code> by <code>LoopCounter</code></li>
</ul>
</li>
<li dir="auto"><strong>Debugging Output</strong>:
<ul>
<li dir="auto">Prints: <code>"Processing Entity [destEntity] from Source DB [sourceDB] and Source Entity Group [sourceEntityGroup]"</code></li>
</ul>
</li>
<li dir="auto"><strong>Synchronization Execution</strong>:
<ul>
<li dir="auto"><strong>Calls</strong>: <code>SP_ETL_SC_Sync_Entity</code> with current entity parameters and <code>@JobID</code></li>
<li dir="auto"><strong>Error Handling</strong>: Wrapped in TRY-CATCH block</li>
</ul>
</li>
<li dir="auto"><strong>Error Logging</strong> (on failure):
<ul>
<li dir="auto">Captures error details:
<ul>
<li dir="auto"><code>ERROR_MESSAGE()</code>: Full error description</li>
<li dir="auto"><code>ERROR_SEVERITY()</code>: SQL Server error severity level</li>
<li dir="auto"><code>ERROR_STATE()</code>: Error state number</li>
<li dir="auto"><code>ERROR_LINE()</code>: Line number where error occurred</li>
</ul>
</li>
<li dir="auto">Inserts failure record into <code>OMAP_ETL.dbo.ETL_Logs</code>:
<ul>
<li dir="auto"><code>SourceDB</code>, <code>DestEntity</code>, <code>SourceEntityGroup</code>, <code>JobID</code></li>
<li dir="auto"><code>ErrorMessage</code>: Captured error text</li>
<li dir="auto"><code>STATUS</code>: 'Failure'</li>
</ul>
</li>
<li dir="auto">Prints error message for immediate visibility</li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Business Rule</strong>: Individual entity synchronization failures do not stop the overall job—remaining entities continue processing.</p>
<hr>
<h3 data-heading="**Data Flow Diagram**" dir="auto"><strong>Data Flow Diagram</strong></h3>
<div class="mermaid"><svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="0 0 554.4299926757812 3053.390625" height="3053.390625" class="flowchart" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="554.4299926757812" id="m9fc014d68cbef62f"><style>#m9fc014d68cbef62f{font-family:var(--font-mermaid);font-size:16px;fill:#333;}#m9fc014d68cbef62f .error-icon{fill:#552222;}#m9fc014d68cbef62f .error-text{fill:#552222;stroke:#552222;}#m9fc014d68cbef62f .edge-thickness-normal{stroke-width:1px;}#m9fc014d68cbef62f .edge-thickness-thick{stroke-width:3.5px;}#m9fc014d68cbef62f .edge-pattern-solid{stroke-dasharray:0;}#m9fc014d68cbef62f .edge-thickness-invisible{stroke-width:0;fill:none;}#m9fc014d68cbef62f .edge-pattern-dashed{stroke-dasharray:3;}#m9fc014d68cbef62f .edge-pattern-dotted{stroke-dasharray:2;}#m9fc014d68cbef62f .marker{fill:#333333;stroke:#333333;}#m9fc014d68cbef62f .marker.cross{stroke:#333333;}#m9fc014d68cbef62f svg{font-family:var(--font-mermaid);font-size:16px;}#m9fc014d68cbef62f p{margin:0;}#m9fc014d68cbef62f .label{font-family:var(--font-mermaid);color:#333;}#m9fc014d68cbef62f .cluster-label text{fill:#333;}#m9fc014d68cbef62f .cluster-label span{color:#333;}#m9fc014d68cbef62f .cluster-label span p{background-color:transparent;}#m9fc014d68cbef62f .label text,#m9fc014d68cbef62f span{fill:#333;color:#333;}#m9fc014d68cbef62f .node rect,#m9fc014d68cbef62f .node circle,#m9fc014d68cbef62f .node ellipse,#m9fc014d68cbef62f .node polygon,#m9fc014d68cbef62f .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#m9fc014d68cbef62f .rough-node .label text,#m9fc014d68cbef62f .node .label text,#m9fc014d68cbef62f .image-shape .label,#m9fc014d68cbef62f .icon-shape .label{text-anchor:middle;}#m9fc014d68cbef62f .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#m9fc014d68cbef62f .rough-node .label,#m9fc014d68cbef62f .node .label,#m9fc014d68cbef62f .image-shape .label,#m9fc014d68cbef62f .icon-shape .label{text-align:center;}#m9fc014d68cbef62f .node.clickable{cursor:pointer;}#m9fc014d68cbef62f .root .anchor path{fill:#333333!important;stroke-width:0;stroke:#333333;}#m9fc014d68cbef62f .arrowheadPath{fill:#333333;}#m9fc014d68cbef62f .edgePath .path{stroke:#333333;stroke-width:2.0px;}#m9fc014d68cbef62f .flowchart-link{stroke:#333333;fill:none;}#m9fc014d68cbef62f .edgeLabel{background-color:rgba(232,232,232, 0.8);text-align:center;}#m9fc014d68cbef62f .edgeLabel p{background-color:rgba(232,232,232, 0.8);}#m9fc014d68cbef62f .edgeLabel rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m9fc014d68cbef62f .labelBkg{background-color:rgba(232, 232, 232, 0.5);}#m9fc014d68cbef62f .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#m9fc014d68cbef62f .cluster text{fill:#333;}#m9fc014d68cbef62f .cluster span{color:#333;}#m9fc014d68cbef62f div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:var(--font-mermaid);font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#m9fc014d68cbef62f .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#m9fc014d68cbef62f rect.text{fill:none;stroke-width:0;}#m9fc014d68cbef62f .icon-shape,#m9fc014d68cbef62f .image-shape{background-color:rgba(232,232,232, 0.8);text-align:center;}#m9fc014d68cbef62f .icon-shape p,#m9fc014d68cbef62f .image-shape p{background-color:rgba(232,232,232, 0.8);padding:2px;}#m9fc014d68cbef62f .icon-shape rect,#m9fc014d68cbef62f .image-shape rect{opacity:0.5;background-color:rgba(232,232,232, 0.8);fill:rgba(232,232,232, 0.8);}#m9fc014d68cbef62f :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style><g><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="5" viewBox="0 0 10 10" class="marker flowchart-v2" id="m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"></path></marker><marker orient="auto" markerHeight="8" markerWidth="8" markerUnits="userSpaceOnUse" refY="5" refX="4.5" viewBox="0 0 10 10" class="marker flowchart-v2" id="m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart-v2" id="m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart-v2" id="m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"></circle></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart-v2" id="m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"></path></marker><g class="root"><g class="clusters"></g><g class="edgePaths"><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Start_GetServer_0" d="M298.93,119L298.93,123.167C298.93,127.333,298.93,135.667,298.93,143.333C298.93,151,298.93,158,298.93,161.5L298.93,165"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_GetServer_CheckRestore_1" d="M298.93,247L298.93,251.167C298.93,255.333,298.93,263.667,299,271.417C299.07,279.167,299.211,286.334,299.281,289.917L299.351,293.501"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CheckRestore_BuildAllowed_2" d="M299.43,474.641L299.346,478.724C299.263,482.807,299.096,490.974,299.013,498.557C298.93,506.141,298.93,513.141,298.93,516.641L298.93,520.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_BuildAllowed_LogFailed_3" d="M298.93,626.141L298.93,630.307C298.93,634.474,298.93,642.807,298.93,650.474C298.93,658.141,298.93,665.141,298.93,668.641L298.93,672.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LogFailed_Prepare_4" d="M298.93,778.141L298.93,782.307C298.93,786.474,298.93,794.807,298.93,802.474C298.93,810.141,298.93,817.141,298.93,820.641L298.93,824.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Prepare_Query_5" d="M298.93,930.141L298.93,934.307C298.93,938.474,298.93,946.807,298.93,954.474C298.93,962.141,298.93,969.141,298.93,972.641L298.93,976.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Query_Group_6" d="M298.93,1106.141L298.93,1110.307C298.93,1114.474,298.93,1122.807,298.93,1130.474C298.93,1138.141,298.93,1145.141,298.93,1148.641L298.93,1152.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Group_TempTable_7" d="M298.93,1258.141L298.93,1262.307C298.93,1266.474,298.93,1274.807,298.93,1282.474C298.93,1290.141,298.93,1297.141,298.93,1300.641L298.93,1304.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_TempTable_SetMax_8" d="M298.93,1410.141L298.93,1414.307C298.93,1418.474,298.93,1426.807,298.93,1434.474C298.93,1442.141,298.93,1449.141,298.93,1452.641L298.93,1456.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SetMax_InitCounter_9" d="M298.93,1538.141L298.93,1542.307C298.93,1546.474,298.93,1554.807,298.93,1562.474C298.93,1570.141,298.93,1577.141,298.93,1580.641L298.93,1584.141"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_InitCounter_LoopCheck_10" d="M298.93,1642.141L298.93,1646.307C298.93,1650.474,298.93,1658.807,299,1666.557C299.07,1674.308,299.211,1681.474,299.281,1685.058L299.351,1688.641"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LoopCheck_Complete_11" d="M225.747,1870.755L199.633,1889.119C173.519,1907.483,121.291,1944.21,95.177,1975.324C69.063,2006.438,69.063,2031.938,69.063,2044.688L69.063,2057.438"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LoopCheck_GetCurrent_12" d="M299.43,1944.438L299.346,1950.521C299.263,1956.604,299.096,1968.771,299.013,1980.354C298.93,1991.938,298.93,2002.938,298.93,2008.438L298.93,2013.938"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_GetCurrent_PrintDebug_13" d="M298.93,2143.938L298.93,2148.104C298.93,2152.271,298.93,2160.604,298.93,2168.271C298.93,2175.938,298.93,2182.938,298.93,2186.438L298.93,2189.938"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_PrintDebug_TrySync_14" d="M298.93,2247.938L298.93,2252.104C298.93,2256.271,298.93,2264.604,298.93,2272.271C298.93,2279.938,298.93,2286.938,298.93,2290.438L298.93,2293.938"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_TrySync_SyncSuccess_15" d="M298.93,2375.938L298.93,2380.104C298.93,2384.271,298.93,2392.604,299,2400.354C299.07,2408.104,299.211,2415.271,299.281,2418.855L299.351,2422.438"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SyncSuccess_Increment_16" d="M272.558,2515.019L263.203,2525.581C253.848,2536.143,235.139,2557.267,225.784,2588.495C216.43,2619.724,216.43,2661.057,216.43,2702.391C216.43,2743.724,216.43,2785.057,216.43,2818.391C216.43,2851.724,216.43,2877.057,216.43,2900.391C216.43,2923.724,216.43,2945.057,229.015,2959.69C241.6,2974.323,266.771,2982.256,279.356,2986.222L291.942,2990.188"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_SyncSuccess_CatchError_17" d="M326.302,2515.019L335.49,2525.581C344.678,2536.143,363.054,2557.267,372.242,2573.329C381.43,2589.391,381.43,2600.391,381.43,2605.891L381.43,2611.391"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_CatchError_LogError_18" d="M381.43,2789.391L381.43,2795.557C381.43,2801.724,381.43,2814.057,381.43,2825.724C381.43,2837.391,381.43,2848.391,381.43,2853.891L381.43,2859.391"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_LogError_Increment_19" d="M381.43,2941.391L381.43,2945.557C381.43,2949.724,381.43,2958.057,381.43,2965.724C381.43,2973.391,381.43,2980.391,381.43,2983.891L381.43,2987.391"></path><path marker-end="url(#m9fc014d68cbef62f-m9fc014d68cbef62f_flowchart-v2-pointEnd)" style="" class="edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link" id="L_Increment_LoopCheck_20" d="M467.103,2991.391L480.324,2987.224C493.545,2983.057,519.987,2974.724,533.209,2959.891C546.43,2945.057,546.43,2923.724,546.43,2900.391C546.43,2877.057,546.43,2851.724,546.43,2818.391C546.43,2785.057,546.43,2743.724,546.43,2702.391C546.43,2661.057,546.43,2619.724,546.43,2583.27C546.43,2546.815,546.43,2515.24,546.43,2485.664C546.43,2456.089,546.43,2428.513,546.43,2404.059C546.43,2379.604,546.43,2358.271,546.43,2336.938C546.43,2315.604,546.43,2294.271,546.43,2274.938C546.43,2255.604,546.43,2238.271,546.43,2220.938C546.43,2203.604,546.43,2186.271,546.43,2162.938C546.43,2139.604,546.43,2110.271,546.43,2078.938C546.43,2047.604,546.43,2014.271,518.474,1979.233C490.519,1944.194,434.609,1907.451,406.654,1889.08L378.698,1870.708"></path></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(69.0625, 1980.9375)" class="edgeLabel"><g transform="translate(-10.671875, -12)" class="label"><foreignObject height="24" width="21.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>No</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1980.9375)" class="edgeLabel"><g transform="translate(-11.296875, -12)" class="label"><foreignObject height="24" width="22.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>Yes</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g transform="translate(216.4296875, 2826.390625)" class="edgeLabel"><g transform="translate(-11.296875, -12)" class="label"><foreignObject height="24" width="22.59375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>Yes</p></span></div></foreignObject></g></g><g transform="translate(381.4296875, 2578.390625)" class="edgeLabel"><g transform="translate(-10.671875, -12)" class="label"><foreignObject height="24" width="21.34375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"><p>No</p></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" class="labelBkg" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(298.9296875, 63.5)" id="flowchart-Start-360" class="node default"><rect height="111" width="242.75" y="-55.5" x="-121.375" ry="55.5" rx="55.5" style="fill:#e1f5e1 !important" class="basic label-container"></rect><g transform="translate(-100, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>SP_ETL_SC_Run_Job<br>@SourceDB, @SourceEntityGroup<br>@DestEntity, @JobID</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 208)" id="flowchart-GetServer-361" class="node default"><rect height="78" width="237.125" y="-39" x="-118.5625" style="" class="basic label-container"></rect><g transform="translate(-88.5625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="177.125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Get Current Server Name<br>@@SERVERNAME</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 385.5703125)" id="flowchart-CheckRestore-363" class="node default"><polygon style="fill:#fff4e1 !important" transform="translate(-88.5703125,88.5703125)" class="label-container" points="88.5703125,0 177.140625,-88.5703125 88.5703125,-177.140625 0,-88.5703125"></polygon><g transform="translate(-49.5703125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="99.140625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Query Today's<br>Restore Logs</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 575.140625)" id="flowchart-BuildAllowed-365" class="node default"><rect height="102" width="259.171875" y="-51" x="-129.5859375" style="fill:#e1f0ff !important" class="basic label-container"></rect><g transform="translate(-99.5859375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="199.171875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Build #AllowedSourceDBs<br>Status = 'Success'<br>+ DBMappingMetaData join</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 727.140625)" id="flowchart-LogFailed-367" class="node default"><rect height="102" width="214.71875" y="-51" x="-107.359375" style="fill:#ffe1e1 !important" class="basic label-container"></rect><g transform="translate(-77.359375, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="154.71875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Log Failure for<br>Unsuccessful Restores<br>to ETL_Logs</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 879.140625)" id="flowchart-Prepare-369" class="node default"><rect height="102" width="260" y="-51" x="-130" style="" class="basic label-container"></rect><g transform="translate(-100, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Execute SP_ETL_SC_Prepare_Job<br>TRY-CATCH wrapper</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1043.140625)" id="flowchart-Query-371" class="node default"><rect height="126" width="260" y="-63" x="-130" style="" class="basic label-container"></rect><g transform="translate(-100, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Query fieldsMapping<br>Filter by parameters<br>Filter by #AllowedSourceDBs</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1207.140625)" id="flowchart-Group-373" class="node default"><rect height="102" width="204.390625" y="-51" x="-102.1953125" style="" class="basic label-container"></rect><g transform="translate(-72.1953125, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="144.390625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>GROUP BY<br>destEntity, sourceDB<br>sourceEntityGroup</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1359.140625)" id="flowchart-TempTable-375" class="node default"><rect height="102" width="260" y="-51" x="-130" style="" class="basic label-container"></rect><g transform="translate(-100, -36)" style="" class="label"><rect></rect><foreignObject height="72" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Store in #SelectedDestEntities<br>with LoopCounter</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1499.140625)" id="flowchart-SetMax-377" class="node default"><rect height="78" width="176.8125" y="-39" x="-88.40625" style="" class="basic label-container"></rect><g transform="translate(-58.40625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="116.8125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Set @MaxCount<br>Print Debug Info</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1615.140625)" id="flowchart-InitCounter-379" class="node default"><rect height="54" width="222.71875" y="-27" x="-111.359375" style="" class="basic label-container"></rect><g transform="translate(-81.359375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="162.71875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Initialize @Counter = 1</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 1818.0390625)" id="flowchart-LoopCheck-381" class="node default"><polygon transform="translate(-125.8984375,125.8984375)" class="label-container" points="125.8984375,0 251.796875,-125.8984375 125.8984375,-251.796875 0,-125.8984375"></polygon><g transform="translate(-98.8984375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="197.796875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>@Counter &lt;= @MaxCount?</p></span></div></foreignObject></g></g><g transform="translate(69.0625, 2080.9375)" id="flowchart-Complete-383" class="node default"><rect height="39" width="122.125" y="-19.5" x="-61.0625" ry="19.5" rx="19.5" style="fill:#e1f5e1 !important" class="basic label-container"></rect><g transform="translate(-48.6875, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="97.375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Job Complete</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 2080.9375)" id="flowchart-GetCurrent-385" class="node default"><rect height="126" width="237.609375" y="-63" x="-118.8046875" style="" class="basic label-container"></rect><g transform="translate(-88.8046875, -48)" style="" class="label"><rect></rect><foreignObject height="96" width="177.609375"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Get Current Entity<br>@CurrDestEntity<br>@CurrSourceDB<br>@CurrSourceEntityGroup</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 2220.9375)" id="flowchart-PrintDebug-387" class="node default"><rect height="54" width="239.46875" y="-27" x="-119.734375" style="" class="basic label-container"></rect><g transform="translate(-89.734375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="179.46875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Print Processing Message</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 2336.9375)" id="flowchart-TrySync-389" class="node default"><rect height="78" width="218.265625" y="-39" x="-109.1328125" style="" class="basic label-container"></rect><g transform="translate(-79.1328125, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="158.265625"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>TRY: Execute<br>SP_ETL_SC_Sync_Entity</p></span></div></foreignObject></g></g><g transform="translate(298.9296875, 2483.6640625)" id="flowchart-SyncSuccess-391" class="node default"><polygon transform="translate(-57.7265625,57.7265625)" class="label-container" points="57.7265625,0 115.453125,-57.7265625 57.7265625,-115.453125 0,-57.7265625"></polygon><g transform="translate(-30.7265625, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="61.453125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Success?</p></span></div></foreignObject></g></g><g transform="translate(381.4296875, 3018.390625)" id="flowchart-Increment-393" class="node default"><rect height="54" width="207.671875" y="-27" x="-103.8359375" style="" class="basic label-container"></rect><g transform="translate(-73.8359375, -12)" style="" class="label"><rect></rect><foreignObject height="24" width="147.671875"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Increment @Counter</p></span></div></foreignObject></g></g><g transform="translate(381.4296875, 2702.390625)" id="flowchart-CatchError-395" class="node default"><rect height="174" width="260" y="-87" x="-130" style="fill:#ffcccc !important" class="basic label-container"></rect><g transform="translate(-100, -72)" style="" class="label"><rect></rect><foreignObject height="144" width="200"><div style="display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>CATCH: Capture Error Details<br>ERROR_MESSAGE<br>ERROR_SEVERITY<br>ERROR_STATE<br>ERROR_LINE</p></span></div></foreignObject></g></g><g transform="translate(381.4296875, 2902.390625)" id="flowchart-LogError-397" class="node default"><rect height="78" width="237.3125" y="-39" x="-118.65625" style="" class="basic label-container"></rect><g transform="translate(-88.65625, -24)" style="" class="label"><rect></rect><foreignObject height="48" width="177.3125"><div style="display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel"><p>Insert Failure to ETL_Logs<br>Print Error Message</p></span></div></foreignObject></g></g></g></g></g>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div>
<hr>
<h3 data-heading="**Key Tables &amp; Relationships**" dir="auto"><strong>Key Tables &amp; Relationships</strong></h3>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner"><strong>Input Tables</strong></div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DBMappingMetaData</code></td>
<td>Maps SDE database names to mapping names</td>
<td><code>SDE_DB_Name</code>, <code>Mapping_DB_Name</code></td>
</tr>
<tr>
<td><code>ETL_Backup_Restore_Log</code></td>
<td>Tracks backup/restore operations</td>
<td><code>DBName</code>, <code>Status</code>, <code>Type</code>, <code>Date</code>, <code>DBInstance</code></td>
</tr>
<tr>
<td><code>fieldsMapping</code></td>
<td>Contains source-destination entity mappings</td>
<td><code>destEntity</code>, <code>sourceDB</code>, <code>sourceEntityGroup</code></td>
</tr>
</tbody>
</table>
</div></div>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner"><strong>Output Tables</strong></div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ETL_Logs</code></td>
<td>Records job execution results</td>
<td><code>SourceDB</code>, <code>DestEntity</code>, <code>SourceEntityGroup</code>, <code>JobID</code>, <code>ErrorMessage</code>, <code>STATUS</code></td>
</tr>
</tbody>
</table>
</div></div>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner"><strong>Temporary Tables</strong></div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Lifecycle</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>#AllowedSourceDBs</code></td>
<td>Databases with successful restoration today</td>
<td>Created in Phase 1, used in Phase 3</td>
</tr>
<tr>
<td><code>#SelectedDestEntities</code></td>
<td>Entity combinations to synchronize</td>
<td>Created in Phase 3, used in Phase 4</td>
</tr>
</tbody>
</table>
</div></div>
<hr>
<h2 data-heading="`SP_ETL_SC_Prepare_Job`" dir="auto"><code>SP_ETL_SC_Prepare_Job</code></h2>
<h3 data-heading="**Overview**" dir="auto"><strong>Overview</strong></h3>
<p dir="auto"><strong>SP_ETL_SC_Prepare_Job</strong> is a preparation stored procedure that initializes the ETL environment before synchronization jobs execute. It creates versioned views for databases with archiving/versioning enabled if not exist and performs comprehensive data cleansing on mapping tables to ensure data quality.</p>
<h3 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h3>
<p dir="auto">This procedure prepares the ETL workspace by: (1) dynamically creating versioned views (_evw suffix) for source entities in databases that use versioning or archiving, filtering for active records only, and (2) cleaning all mapping data by trimming whitespace and converting empty strings to NULL across all fields in <code>fieldsMapping</code> and <code>valuesMapping</code> tables.</p>
<h3 data-heading="**Parameters**" dir="auto"><strong>Parameters</strong></h3>
<p dir="auto"><strong>None</strong> - This procedure operates on all databases and entities defined in the metadata tables.</p>
<hr>
<h3 data-heading="**Process Flow**" dir="auto"><strong>Process Flow</strong></h3>
<h4 data-heading="**Phase 1: Versioned View Creation**" dir="auto"><strong>Phase 1: Versioned View Creation</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Create filtered views for source entities in databases that use versioning or archiving, ensuring ETL processes query only active records.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Metadata Loading</strong>:
<ul>
<li dir="auto">Loads databases requiring versioned views into <code>#TempMappingMetaData</code></li>
<li dir="auto">Source: <code>DBMappingMetaData</code> table</li>
<li dir="auto">Filter: <code>Entity_Name_Suffix IS NOT NULL</code> (identifies databases with versioning)</li>
<li dir="auto">Adds <code>LoopCounter</code> for sequential processing</li>
</ul>
</li>
<li dir="auto"><strong>Outer Loop - Process Each Database</strong>:
<ul>
<li dir="auto">Iterates through each database in <code>#TempMappingMetaData</code></li>
<li dir="auto">Extracts metadata for current database:
<ul>
<li dir="auto"><code>@CurrentDB</code>: Mapping database name (used in fieldsMapping)</li>
<li dir="auto"><code>@Current_SDE_DBName</code>: Physical SDE database name</li>
<li dir="auto"><code>@CurrentDBSchemaName</code>: Database schema name (typically 'dbo' or 'sde')</li>
<li dir="auto"><code>@CurrentDBEntitySuffix</code>: View suffix (e.g., '_evw')</li>
</ul>
</li>
</ul>
</li>
<li dir="auto"><strong>Entity Collection</strong>:
<ul>
<li dir="auto">Queries distinct <code>sourceEntity</code> values from <code>fieldsMapping</code> for current database</li>
<li dir="auto">Stores in temporary table <code>#TempCurrentDBEntities</code> with <code>LoopCounter</code></li>
</ul>
</li>
<li dir="auto"><strong>Inner Loop - Process Each Entity</strong>:
<ul>
<li dir="auto">For each source entity in current database:
<ul>
<li dir="auto">Constructs view name: <code>schema.entityName + suffix</code> (e.g., <code>dbo.cpPlot_evw</code>)</li>
<li dir="auto">Constructs base table name: <code>schema.entityName</code> (e.g., <code>dbo.cpPlot</code>)</li>
<li dir="auto">Checks if view already exists using <code>OBJECT_ID(viewName, 'V')</code></li>
<li dir="auto">If view does NOT exist, creates it with conditional filtering</li>
</ul>
</li>
</ul>
</li>
<li dir="auto"><strong>Versioned View Logic</strong>:
<ul>
<li dir="auto"><strong>Archive Detection</strong>: Checks if base table contains <code>gdb_to_date</code> column
<ul>
<li dir="auto"><code>gdb_to_date</code> column indicates ArcGIS versioning/archiving is enabled</li>
</ul>
</li>
<li dir="auto"><strong>Filter Construction</strong>:
<ul>
<li dir="auto"><strong>If <code>gdb_to_date</code> exists</strong>: Filters for active records only
<ul>
<li dir="auto"><code>WHERE gdb_to_date = CAST('9999-12-31' AS DATETIME)</code></li>
<li dir="auto">Date <code>9999-12-31</code> is ArcGIS convention for "current/active" records</li>
</ul>
</li>
<li dir="auto"><strong>If <code>gdb_to_date</code> does NOT exist</strong>: No filter applied (all records included)</li>
</ul>
</li>
<li dir="auto"><strong>View Creation</strong>: Executes dynamic SQL to create view in source database</li>
<li dir="auto"><strong>Debug Output</strong>: Prints CREATE VIEW statement if filtering is applied</li>
</ul>
</li>
<li dir="auto"><strong>Dynamic SQL Execution</strong>:
<ul>
<li dir="auto">Uses <code>sp_executesql</code> to execute view creation in the context of source database</li>
<li dir="auto">Switches database context using <code>USE [databaseName]</code></li>
<li dir="auto">Wrapped in nested TRY-CATCH blocks (inner and outer) to suppress errors</li>
</ul>
</li>
</ol>
<h5 data-heading="Error Handling:" dir="auto">Error Handling:</h5>
<ul>
<li dir="auto"><strong>Nested TRY-CATCH Structure</strong>:
<ul>
<li dir="auto"><strong>Outer</strong>: Catches errors in dynamic SQL construction</li>
<li dir="auto"><strong>Inner</strong>: Catches errors in view creation execution</li>
</ul>
</li>
<li dir="auto"><strong>Suppression Strategy</strong>: All errors silently caught and ignored
<ul>
<li dir="auto">Allows process to continue even if individual views fail</li>
<li dir="auto">Existing views are preserved (only creates if not exists)</li>
</ul>
</li>
</ul>
<h5 data-heading="View Creation Example:" dir="auto">View Creation Example:</h5>
<pre class="language-sql"><code class="language-sql is-loaded"><span class="token comment">-- For table with versioning (gdb_to_date exists)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> dbo<span class="token punctuation">.</span>cpPlot_evw <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dbo<span class="token punctuation">.</span>cpPlot 
<span class="token keyword">WHERE</span> gdb_to_date <span class="token operator">=</span> CAST<span class="token punctuation">(</span><span class="token string">'9999-12-31'</span> <span class="token keyword">AS</span> <span class="token keyword">DATETIME</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- For table without versioning (gdb_to_date does NOT exist)</span>
<span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> dbo<span class="token punctuation">.</span>building_evw <span class="token keyword">AS</span> 
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> dbo<span class="token punctuation">.</span>building<span class="token punctuation">;</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></button></pre>
<p dir="auto"><strong>Business Rule</strong>: Only active/current records (non-archived) are visible through versioned views used in ETL synchronization.</p>
<hr>
<h4 data-heading="**Phase 2: Fields And Values Mapping Data Cleansing**" dir="auto"><strong>Phase 2: Fields And Values Mapping Data Cleansing</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Standardize and clean all text and numeric fields in the <code>fieldsMapping</code> table.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Text Field Cleaning</strong>: Applies to text fields
<ul>
<li dir="auto">Removes leading/trailing characters: space, tab (<code>CHAR(9)</code>), newline (<code>CHAR(10)</code>), carriage return (<code>CHAR(13)</code>)</li>
<li dir="auto">Uses <code>TRIM(CHAR(10)+CHAR(13)+CHAR(9)+' ' FROM fieldName)</code></li>
<li dir="auto">Converts empty strings to NULL using <code>NULLIF(..., '')</code></li>
</ul>
</li>
<li dir="auto"><strong>Numeric Field Cleaning</strong>: Applies to numeric fields
<ul>
<li dir="auto">Converts empty strings to NULL: <code>NULLIF(fieldName, '')</code></li>
<li dir="auto">Fields: <code>sourceFieldLength</code>, <code>destFieldLength</code>, <code>source_SR_WKID</code></li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Business Rule</strong>: Ensures consistent NULL handling across all mapping fields, preventing empty string vs NULL comparison issues.</p>
<hr>
<h3 data-heading="**Key Tables &amp; Relationships**" dir="auto"><strong>Key Tables &amp; Relationships</strong></h3>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner"><strong>Input Tables</strong></div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Key Columns</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>DBMappingMetaData</code></td>
<td>Defines databases with versioning requirements</td>
<td><code>Mapping_DB_Name</code>, <code>SDE_DB_Name</code>, <code>SCHEMA_NAME</code>, <code>Entity_Name_Suffix</code></td>
</tr>
<tr>
<td><code>fieldsMapping</code></td>
<td>Source-destination field mappings (read &amp; updated)</td>
<td><code>sourceDB</code>, <code>sourceEntity</code>, all field columns</td>
</tr>
<tr>
<td><code>valuesMapping</code></td>
<td>Source-destination value mappings (updated)</td>
<td>All field columns</td>
</tr>
</tbody>
</table>
</div></div>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner"><strong>Output Tables</strong></div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Modification Type</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>fieldsMapping</code></td>
<td>Field mappings with cleaned data</td>
<td>UPDATE (all text/numeric fields)</td>
</tr>
<tr>
<td><code>valuesMapping</code></td>
<td>Value mappings with cleaned data</td>
<td>UPDATE (all text/numeric fields)</td>
</tr>
<tr>
<td><strong>Source Database Views</strong></td>
<td>Versioned entity views (e.g., <code>cpPlot_evw</code>)</td>
<td>CREATE (in source SDE databases)</td>
</tr>
</tbody>
</table>
</div></div>
<div data-callout-metadata="" data-callout-fold="" data-callout="tip" class="callout"><div class="callout-title" dir="auto"><div class="callout-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-flame"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></div><div class="callout-title-inner"><strong>Temporary Tables</strong></div></div><div class="callout-content">
<table>
<thead>
<tr>
<th>Table</th>
<th>Purpose</th>
<th>Lifecycle</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>#TempMappingMetaData</code></td>
<td>Databases requiring versioned views</td>
<td>Created in Phase 1, dropped automatically</td>
</tr>
<tr>
<td><code>#TempCurrentDBEntities</code></td>
<td>Entities for current database</td>
<td>Created/dropped per database iteration</td>
</tr>
</tbody>
</table>
</div></div>
<hr>
<h2 data-heading="`SP_ETL_SC_Check_Restore_Status`" dir="auto"><code>SP_ETL_SC_Check_Restore_Status</code></h2>
<h3 data-heading="**Overview**" dir="auto"><strong>Overview</strong></h3>
<p dir="auto"><strong>SP_ETL_SC_Check_Restore_Status</strong> is a validation 0stored procedure that verifies the success or failure of daily database restore operations. It uses a marker table approach (<code>dumpTable</code>) to detect restore status and logs results to track restore history across both servers in an Always On availability group configuration.</p>
<h3 data-heading="**Purpose**" dir="auto"><strong>Purpose</strong></h3>
<p dir="auto">This procedure validates database restore integrity by checking for the presence of a marker table (<code>dumpTable</code>) in each restored database. The table's presence indicates restore failure (old data persisted), while its absence indicates restore success (database was replaced with fresh backup). It ensures only successfully restored databases are available for ETL synchronization.</p>
<h3 data-heading="**Parameters**" dir="auto"><strong>Parameters</strong></h3>
<p dir="auto"><strong>None</strong> - This procedure operates on all databases defined in <code>DBMappingMetaData</code> where <code>CheckRestoreStatus = 1</code>.</p>
<hr>
<h3 data-heading="**Process Flow**" dir="auto"><strong>Process Flow</strong></h3>
<h4 data-heading="**Phase 1: Availability Group Role Verification**" dir="auto"><strong>Phase 1: Availability Group Role Verification</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Ensure the procedure only executes on the primary replica in an Always On availability group to prevent duplicate logging.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Query Availability Group State</strong>:
<ul>
<li dir="auto">Queries <code>sys.dm_hadr_availability_replica_states</code> (dynamic management view)</li>
<li dir="auto">Joins with <code>sys.availability_replicas</code> to get replica details</li>
<li dir="auto">Filters for local replica (<code>is_local = 1</code>)</li>
</ul>
</li>
<li dir="auto"><strong>Role Check</strong>:
<ul>
<li dir="auto">Sets <code>@isPrimary = 1</code> if <code>role_desc = 'PRIMARY'</code></li>
<li dir="auto">Sets <code>@isPrimary = 0</code> for secondary replicas</li>
</ul>
</li>
<li dir="auto"><strong>Early Exit for Secondary Replicas</strong>:
<ul>
<li dir="auto">If <code>@isPrimary = 0</code> (or NULL), prints message and returns immediately</li>
<li dir="auto">Message: "This is not the primary replica."</li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Business Rule</strong>: Restore status checks only run on the primary replica to avoid duplicate log entries in the shared ETL database.</p>
<hr>
<h4 data-heading="**Phase 2: Database Restore Validation**" dir="auto"><strong>Phase 2: Database Restore Validation</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Check each database marked for restore validation and determine if today's restore succeeded or failed.</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto">
<p><strong>Metadata Collection</strong>:</p>
<ul>
<li dir="auto">Creates cursor from <code>DBMappingMetaData</code> table</li>
<li dir="auto">Filters:
<ul>
<li dir="auto"><code>SDE_DB_Name IS NOT NULL</code></li>
<li dir="auto"><code>Schema_Name IS NOT NULL</code></li>
<li dir="auto"><code>CheckRestoreStatus = 1</code> (only databases requiring restore validation)</li>
</ul>
</li>
<li dir="auto">Retrieves distinct <code>SDE_DB_Name</code> and <code>Schema_Name</code> combinations</li>
</ul>
</li>
<li dir="auto">
<p><strong>Generate Unique Log ID</strong>:</p>
<ul>
<li dir="auto">Calculates <code>@ObjectID</code> for each database check</li>
<li dir="auto">Formula: <code>MAX(OBJECTID) + 1</code> from <code>ETL_Backup_Restore_Log</code></li>
<li dir="auto">Ensures unique identifiers across all log entries</li>
</ul>
</li>
<li dir="auto">
<p><strong>Marker Table Detection</strong> (for each database):</p>
<ul>
<li dir="auto">Constructs dynamic SQL to check for <code>dumpTable</code> existence</li>
<li dir="auto">Queries <code>sys.tables</code> and <code>sys.schemas</code> in target database</li>
<li dir="auto">Sets <code>@TableExists = 1</code> if table found, <code>0</code> if not found</li>
</ul>
</li>
<li dir="auto">
<p><strong>Restore Status Determination</strong>: </p>
<p><strong>Scenario A: dumpTable EXISTS</strong> (Restore FAILED)</p>
<ul>
<li dir="auto"><strong>Logic</strong>: If the marker table from yesterday still exists, the restore did not complete successfully (old database persisted)</li>
<li dir="auto"><strong>Action</strong>:
<ul>
<li dir="auto">Sets <code>@Status = 'Failed'</code></li>
<li dir="auto">Logs failure to <code>ETL_Backup_Restore_Log</code></li>
<li dir="auto">Prints: "Database: [name] - Restore FAILED (dumpTable exists)"</li>
</ul>
</li>
<li dir="auto"><strong>No table creation</strong>: Leaves existing dumpTable in place</li>
</ul>
<p> <strong>Scenario B: dumpTable DOES NOT EXIST</strong> (Restore SUCCEEDED)</p>
<ul>
<li dir="auto"><strong>Logic</strong>: Marker table is absent, indicating database was successfully replaced with fresh backup</li>
<li dir="auto"><strong>Action</strong>:
<ul>
<li dir="auto">Sets <code>@Status = 'Success'</code></li>
<li dir="auto">Logs success to <code>ETL_Backup_Restore_Log</code></li>
<li dir="auto"><strong>Creates new dumpTable</strong> as marker for tomorrow's check</li>
<li dir="auto">Inserts default row with <code>RestoreDate = GETDATE()</code></li>
<li dir="auto">Prints: "Database: [name] - Restore SUCCESS (dumpTable created)"</li>
</ul>
</li>
</ul>
</li>
<li dir="auto">
<p><strong>Error Handling</strong>:</p>
<ul>
<li dir="auto">Wrapped in TRY-CATCH for each database</li>
<li dir="auto">On error:
<ul>
<li dir="auto">Logs error message to <code>ETL_Backup_Restore_Log</code></li>
<li dir="auto">Status: <code>'Error: ' + ERROR_MESSAGE()</code></li>
<li dir="auto">Prints error details</li>
<li dir="auto"><strong>Continues to next database</strong> (does not halt process)</li>
</ul>
</li>
</ul>
</li>
<li dir="auto">
<p><strong>Cursor Management</strong>:</p>
<ul>
<li dir="auto">Fetches next database from cursor after processing current one</li>
<li dir="auto">Closes and deallocates cursor after loop completes</li>
</ul>
</li>
</ol>
<h5 data-heading="Marker Table Structure:" dir="auto">Marker Table Structure:</h5>
<pre class="language-sql"><code class="language-sql is-loaded"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">[</span>DatabaseName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>SchemaName<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token punctuation">[</span>dumpTable<span class="token punctuation">]</span>
<span class="token punctuation">(</span>
    RestoreDate <span class="token keyword">DATETIME</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> GETDATE<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token comment">-- Single row inserted with current timestamp</span>
</code><button class="copy-code-button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-copy"><rect x="8" y="8" width="14" height="14" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path><style>
:root {
  --default-font: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Microsoft YaHei Light", sans-serif;
  --font-monospace: 'Source Code Pro', monospace;
  --background-primary: #ffffff;
  --background-modifier-border: #ddd;
  --text-accent: #705dcf;
  --text-accent-hover: #7a6ae6;
  --text-normal: #2e3338;
  --background-secondary: #f2f3f5;
  --background-secondary-alt: #e3e5e8;
  --text-muted: #888888;
}</style>"<marker id="mermaid_arrowhead" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path></marker>"</svg></button></pre>
<p dir="auto"><strong>Business Rule</strong>: The dumpTable serves as a flag - its presence after restore indicates the restore failed to replace the database.</p>
<hr>
<h4 data-heading="**Phase 3: Local Database Status Logging**" dir="auto"><strong>Phase 3: Local Database Status Logging</strong></h4>
<p dir="auto"><strong>Purpose</strong>: Record success status for databases that don't require restore validation (local databases).</p>
<h5 data-heading="Key Operations:" dir="auto">Key Operations:</h5>
<ol>
<li dir="auto"><strong>Query Local Databases</strong>:
<ul>
<li dir="auto">Selects from <code>DBMappingMetaData</code> where <code>CheckRestoreStatus = 0</code></li>
<li dir="auto">Identifies databases like Khazaen and MuscatAirport that reside locally on the ETL server</li>
</ul>
</li>
<li dir="auto"><strong>Bulk Insert Success Records</strong>:
<ul>
<li dir="auto">Status: <code>'Success'</code> (no actual restore performed)</li>
<li dir="auto">Type: <code>'Restore'</code> (maintains consistency with log structure)</li>
<li dir="auto">Date: <code>GETDATE()</code></li>
<li dir="auto">ObjectID: Sequential increments from current max</li>
<li dir="auto">DBInstance: <code>@@SERVERNAME</code></li>
</ul>
</li>
<li dir="auto"><strong>Completion Message</strong>:
<ul>
<li dir="auto">Prints: "Restore status check completed."</li>
</ul>
</li>
</ol>
<p dir="auto"><strong>Business Rule</strong>: Local databases always receive success status since they don't undergo backup/restore operations.</p>
    </body>
</html>